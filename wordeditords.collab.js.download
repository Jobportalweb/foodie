(globalThis.dullscriptWebpackJsonp=globalThis.dullscriptWebpackJsonp||[]).push([[6],{65645:function(ia,Ua,v){var ya=v(59529),ja=v(34622),oa=v(78830);const z=(0,oa.b)("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),D=(0,oa.d)(z),d=(0,oa.b)("Common.ICoauthorGalleryTelemetry"),t=(0,oa.d)(d),k=(0,oa.b)("Common.App.CoauthTelemetry.GuestCoauthTelemetry"),r=(0,oa.d)(k),x=(0,oa.b)("Common.App.CoauthTelemetry.CoauthTelemetry"),u=(0,oa.d)(x);var w=v(47928);const C=(0,oa.b)("Common.App.CoauthTelemetry.ICoauthorPositionFinder"),
B=(0,oa.d)(C);var G=v(6443);const H=(0,oa.b)("Common.IPeoplesWell");var I=v(11512),M=v(18499);class J{constructor(Jb,Wc){this.Cqb=null;this.Qka=()=>{J.wZh(this.Cqb.rwb())&&(this.Cqb.Iwg(this.Qka),this.oTk.IsRealCoauthSession=!0)};this.ZTc=Jb;this.oTk=Wc}init(){this.ZTc.continueWith(()=>{this.Cqb=this.ZTc.result;this.Cqb.rjc(this.Qka)})}static wZh(Jb){let Wc=null;for(const Md of Jb)if(Md)if(Jb=Md.isAnonymous||!Md.email?Md.clientId:Md.email.toUpperCase(),!Wc)Wc=Jb;else if(Wc!==Jb)return!0;return!1}}
(0,ja.a)(J,"CoauthTelemetry",null,[1815]);var O=v(23335),K=v(37307),R=v(8693),E;(function(Jb){Jb[Jb.Glq=0]="badStatePreventedTelemetry";Jb[Jb.notImplemented=1]="notImplemented";Jb[Jb.WXr=2]="renderHandled";Jb[Jb.XXr=3]="renderHandledWithVeto"})(E||(E={}));(0,ja.b)("CoauthorGalleryTelemetryEndResult",E);var X=v(16149),U=v(50612),Q=v(21513),la=v(54638);class h{constructor(Jb,Wc,Md,Mb,pe,td,Xd,jh,Th){this.rGh=this.sjh=this.wH=null;this.Vte=()=>{this.Qka()};this.rjg=()=>{var he=this.Zr.Iv("AppInitStatus_interactivityReady");
O.ULS.shipAssertTag(42259235,325,!!this.MTd);const Id=this.MTd-he;he={InteractiveTime:he};he.ReactRenderComplete=this.MTd;he.HadTabSwitch=this.JIb();he.IsModernGallery=this.NXc;O.ULS.sendTraceTag(594883104,325,20,U.a.toJSON(he));this.NXc?(O.ULS.sendTraceTag(42062997,325,15,Id.toString()),this.DSd.JY(this.k1p(Id)?3:2)):O.ULS.sendTraceTag(594883103,325,15,Id.toString())};this.lca=Jb;this.DSd=new K.a;this.ta=Md;this.TQe=Wc;this.qca=Mb;this.Zr=pe;this.c7e=td;this.mqb=Xd;this.vyk=jh;this.ksh=this.fsh=
!1;this.MTd=0;this.qjh=1;this.JIb=Th;this.NXc=this.ta.$("PeoplesWellExtraButtonInfoIsEnabled");this.oca=(0,R.a)(String,ya.AFrameworkApplication.Hc.Application)||""}get X3j(){return this.DSd.task}init(){la.Task.WAA.call(null,this.mqb,this.TQe,this.c7e).continueWith(()=>{this.wH=this.mqb.result;this.sjh=this.TQe.result;this.rGh=this.c7e.result;la.Task.WAA.call(null,this.TQe.result.Klc,this.c7e.result.J7j).continueWith(()=>{this.qjh=this.sjh.Klc.result;this.MTd=this.rGh.J7j.result;this.wH.rjc(this.Vte);
this.wH.rwb().length&&this.Qka()})})}Qka(){this.vyk(this.wH.rwb())?(this.wH.Iwg(this.Vte),this.Tho(this.fsh)):this.DSd.JY(1);this.fsh=!0}Tho(Jb){this.ksh?this.X3j.continueWith(()=>{O.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",E[this.X3j.result])}):(this.ksh=!0,this.DDo(0===this.qjh&&!Jb))}DDo(Jb){Jb?this.qca.nh(4,this.rjg):this.DSd.JY(1)}k1p(Jb){const Wc=Jb>this.ta.Ab("CoauthorGalleryTimeToRenderDurationMs",1E4);var Md="Word"===this.oca;const Mb=
"PowerPoint"===this.oca;if(this.JIb())return O.ULS.sendTraceTag(50455714,325,50,Wc.toString()),!1;Md&&X.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",Q.b.FailureBased,"wordcollabrel",null);Wc&&(Md&&X.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",!1,!0,null),Md=ya.AFrameworkApplication.J.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientCoauthorGalleryRenderLatencyQoSError"),Mb&&Md&&Jb<this.ta.Ab("CoauthorGalleryTimeToRenderCutoffThresholdMs",
3E4)&&X.Health.instance.recordQosError("CoauthorGalleryTimeToRenderDurationIsTooLong",["CoauthGalleryExperienceDegraded"],!1,!0,!0,!1,null),O.ULS.sendTraceTag(42062998,325,15,Jb.toString()));return Wc}}(0,ja.a)(h,"CoauthorGalleryTelemetry",null,[1813]);class W{constructor(Jb){this.wH=null;this.TDd={};this.WOd={};this.IPc=null;this.Qka=()=>{this.yek()};this.dHl=(Wc,Md)=>Wc.Q2a>Md.Q2a?1:Wc.Q2a<Md.Q2a?-1:0;this.mqb=Jb}Ace(Jb){const Wc=new K.a;this.init().continueWith(()=>{Jb in this.TDd?Wc.JY(this.TDd[Jb]):
this.WOd[Jb]=Wc});return Wc.task}init(){if(this.IPc)return this.IPc.task;this.IPc=new K.a;this.mqb.continueWith(()=>{this.wH=this.mqb.result;this.wH.rjc(this.Qka);this.yek();this.IPc.setResult(null)});return this.IPc.task}yek(){const Jb=this.wH.rwb();Jb.sort(this.dHl);this.TDd={};for(let Wc=0;Wc<Jb.length&&Jb[Wc]&&Jb[Wc].Q2a;Wc++)this.u8k(this.TDd,Jb[Wc].clientId,Wc)}u8k(Jb,Wc,Md){Jb[Wc]=Md;Wc in this.WOd&&(this.WOd[Wc].JY(Md),delete this.WOd[Wc])}}(0,ja.a)(W,"CoauthorPositionFinder",null,[1816]);
var ba=v(12611),ma=v(64829),qa=v(61077),ea=v(6439),Ga=v(41370);class da{constructor(){this.oNa=null;this.NKc=Array(32)}xor(Jb){if(!Jb)throw Error.argumentNull("Guid argument cannot be null");const Wc=new da,Md=new Sys.StringBuilder;for(let Mb=0;Mb<Jb.NKc.length;Mb++){const pe=this.NKc[Mb]^Jb.NKc[Mb];Wc.NKc[Mb]=pe;Md.append(pe.toString(16));7!==Mb&&11!==Mb&&15!==Mb&&19!==Mb||Md.append("-")}Wc.oNa=Ga.a.Ed(Md.toString());return Wc}toString(){return this.oNa.toString()}equals(Jb){if(!Jb)throw Error.argumentNull("Guid argument cannot be null");
return this.oNa.equals(Jb.oNa)}static fromString(Jb){if(!Jb)throw Error.argumentNull("String input cannot be null");const Wc=new da;Wc.oNa=Ga.a.Ed(Jb);const Md=Wc.oNa.toString();let Mb=0;for(let td=0;td<Md.length;td++){var pe=Jb.charAt(td);if(da.oCn(pe))pe=da.efn(pe,Jb.charCodeAt(td)),Wc.NKc[Mb++]=pe;else if(!da.GBn(pe))throw Error.argument("String contains characters not valid in Guids");}return Wc}static oCn(Jb){return"0"<=Jb&&"9">=Jb||"A"<=Jb&&"F">=Jb||"a"<=Jb&&"f">=Jb}static GBn(Jb){return"{"===
Jb||"}"===Jb||"-"===Jb}static efn(Jb,Wc){if("0"<=Jb&&"9">=Jb)return Wc-48;if("A"<=Jb&&"F">=Jb)return Wc-65+10;if("a"<=Jb&&"f">=Jb)return Wc-97+10;throw Error.argument("Char is not valid hex digit");}}(0,ja.a)(da,"Guid",null,[]);var ra=v(51862);class Ka{constructor(Jb,Wc,Md,Mb){this.Cqb=null;this.Clh=this.GCh=!1;this.Hzh=0;this.Qka=()=>{this.LEl(this.Cqb.rwb())};this.ZTc=Jb;this.icf=Wc;this.ta=Md;this.ofc=Mb;this.Rxk=ya.AFrameworkApplication.JHc||ya.AFrameworkApplication.Caa;this.TAh=new ba.a(ma.a.Xg())}get hyf(){return this.ta.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",
!1)}init(){this.ZTc.continueWith(()=>{this.Cqb=this.ZTc.result;this.Cqb.rjc(this.Qka)})}LEl(Jb){var Wc=0;const Md=new qa.a(ma.a.Xg());for(const Mb of Jb)if(Mb&&Mb.isAnonymous){ra.a.Wb("70eb6120;2gfeb930");if(Md.fb(Mb.userName))Md.K(Mb.userName).add(Mb.clientId);else{let pe;Md.add(Mb.userName,(pe=new ea.a,pe.add(Mb.clientId),pe))}Mb.clientId!==this.ofc?(Wc++,2<=Wc&&!this.GCh&&this.lZn()):!this.Clh&&this.hyf&&"Guest"===Mb.userName&&(O.ULS.sendTraceTag(509726851,302,50,"User was assigned 'Guest' name"),
this.Clh=!0)}if(this.hyf&&this.Hzh!==Wc){O.ULS.sendTraceTag(512553562,302,50,"Total guests updated to: {0}",Wc+(this.Rxk?1:0));this.Hzh=Wc;for(const Mb of Md.keys)2<=Md.K(Mb).count&&(Jb=this.gDm(Md.K(Mb)),this.TAh.contains(Jb)||(Wc={},Wc.guestsWithSameName=Md.K(Mb).count,Wc.identifier=Jb,O.ULS.sendTraceTag(526394833,302,50,"Duplicate guest friendly name detected: {0}",Wc),this.TAh.add(Jb)))}}lZn(){O.ULS.sendTraceTag(525112603,302,50,"Multiple guests simultaneously coauthoring");this.GCh=!0;this.hyf&&
this.icf&&this.icf.continueWith(()=>{window.setTimeout(()=>{this.icf.result.logActivity("MultipleGuestsCoauthoring",null)},15E3)})}gDm(Jb){if(!Jb||1>=Jb.count)return"";let Wc=da.fromString(Jb.K(0));for(let Md=1;Md<Jb.count;Md++)Wc=Wc.xor(da.fromString(Jb.K(Md)));return Wc.toString()}}(0,ja.a)(Ka,"GuestCoauthTelemetry",null,[]);var Pa=v(2953);class Da{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=!1}}(0,ja.a)(Da,"PL",null,[]);var Ra=v(6855);class Ba{constructor(){this.ct=
this.vt=this.d=0}static VSj(Jb,Wc,Md){const Mb=new Ba;Mb.d=Jb;Mb.vt=Wc;Mb.ct=Md;return Ra.c(Mb)}}(0,ja.a)(Ba,"VD",null,[]);class Ia{constructor(Jb,Wc,Md,Mb,pe,td,Xd,jh,Th){this.ki=0;this.fgj=this.MKh=!1;this._id=Jb;this.yMh=Wc;this.yw=Md;this.p4e=Mb;this.Zcf=pe;this.sQb=td;this.FJb=Xd;this.UAk=jh;this.JIb=Th;this.oca=(0,R.a)(String,ya.AFrameworkApplication.Hc.Application)||""}G9b(Jb){la.Task.WAA(this.yMh,this.p4e,this.Zcf).continueWith(()=>{if(this.p4e.result<=this.Zcf.result)Jb.JY(!1);else{this.ki=
this.yMh.result;var Wc=this.yw-this.ki,Md=new Da;Md.id=this._id;Md.et=this.yw;Md.st=this.ki;Md.d=this.yw-this.ki;Md.mp=this.p4e.result;Md.tp=this.Zcf.result;Md.ct=this.rxm(this.UAk);Md.vc=this.JIb();var Mb=Ra.c(Md),pe="Word"===this.oca,td="PowerPoint"===this.oca,Xd="Excel"===this.oca;O.ULS.sendTraceTag(42078597,302,15,Mb);if(pe){const jh=new Map;jh.set("data",Mb);X.Health.instance.recordKpiUsage("PresenceExperienceDegraded",Q.b.FailureBased,"wordcollabrel",jh)}Wc>this.sQb.value&&!this.MKh&&!Md.vc&&
(this.MKh=!0,Jb.JY(!0),Md={h3:!0,extendedProperties:new Map},Md.extendedProperties.set("data",Mb),pe&&X.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",!1,!0,Md),Wc<this.FJb.value&&(O.ULS.sendTraceTag(42078598,302,15,Ba.VSj(Wc,this.sQb.value,this.FJb.value)),Wc=ya.AFrameworkApplication.J.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientThumbnailPresenceRenderLatencyQoSError"),this.fgj=ya.AFrameworkApplication.J.$("ExcelPresenceRenderLatencyQoSError"),
td&&Wc||Xd&&this.fgj))&&(Md.h3=!1,X.Health.instance.recordQosError("PresenceRenderDurationIsTooLong",["PresenceExperienceDegraded"],!1,!0,!0,!1,Md));Jb.task.isCompleted||Jb.JY(!1)}})}rxm(Jb){switch(Jb){case 2:return"NonWac";case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}}}(0,ja.a)(Ia,"PresenceLatencyActivityLogger",null,[]);class ta{constructor(Jb,Wc,Md){this.bih=this.njh=this.xDd=this.SDd=this.Z$b=0;this._id=Jb;this.sQb=Wc;this.FJb=Md;this.oca=(0,R.a)(String,ya.AFrameworkApplication.Hc.Application)||
""}get JWh(){return this.Z$b}set JWh(Jb){this.Z$b=Jb;this.Nqf()}get i9h(){return this.SDd}set i9h(Jb){this.SDd=Jb;this.Nqf()}get W4h(){return this.xDd}set W4h(Jb){this.xDd=Jb;this.Nqf()}get j9h(){return 0!==this.njh}get X4h(){return 0!==this.bih}Nqf(){!this.j9h&&this.Z$b&&this.SDd&&(this.njh=this.G9b(this.SDd,"CoauthGalleryLightupDurationTooLong"));!this.X4h&&this.Z$b&&this.xDd&&(this.bih=this.G9b(this.xDd,"CanvasPresenceLightupDurationTooLong"))}G9b(Jb,Wc){const Md=Jb-this.Z$b;var Mb=new Da;Mb.id=
this._id;Mb.et=Jb;Mb.st=this.Z$b;Mb.d=Md;var pe=Ra.c(Mb);Jb="Word"===this.oca;Mb="CanvasPresenceLightupDurationTooLong"===Wc?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";"CanvasPresenceLightupDurationTooLong"===Wc?O.ULS.sendTraceTag(572289499,302,15,pe):O.ULS.sendTraceTag(571524118,302,15,pe);if(Jb){var td=new Map;td.set("data",pe);X.Health.instance.recordKpiUsage(Mb,Q.b.FailureBased,"wordcollabrel",td)}return Md>this.sQb.value?(td=Object.assign({},{h3:!0,extendedProperties:new Map}),
td.extendedProperties.set("data",pe),pe=Md<this.FJb.value,td.extendedProperties.set("cash",pe?"true":"false"),Jb&&X.Health.instance.recordKpiFailure(Mb,Wc,!1,!0,td),O.ULS.sendTraceTag(572289500,302,15,Ba.VSj(Md,this.sQb.value,this.FJb.value)),pe?2:1):3}}(0,ja.a)(ta,"PresenceLightupLatencyLogger",null,[]);var Ca=v(87488);class za{constructor(Jb,Wc,Md,Mb,pe,td,Xd,jh=null,Th=null,he=null){this.sHh={};this.SQe={};this.syh=new ea.a;this.bDd=this.JPc=this.wH=this.Di=null;this.xMh=this.wMh=0;this.Umo=(Id,
Xk)=>{if(!this.bhh&&2===Xk.newState){var mh=this.RFi();mh.continueWith(()=>{var Rl=mh.result;Rl=Date.now()-Rl;const rk={};rk.clientId=this.Slj;rk.bootTime=Rl;this.bhh=!0;this.Di.gH(15,rk)})}};this.Ifo=(Id,Xk)=>{if(15===Xk.type){Id=Date.now();Xk=Xk.KC;var mh=Xk.bootTime;this.yOf(Xk.clientId).JWh=Id-mh}};this.Vte=()=>{this.Qka()};this.sQb=new Pa.a(()=>jh.vS("PresenceBootLatencyThreshold",1E4));this.FJb=new Pa.a(()=>jh.vS("PresenceBootLatencyCutoffThreshold",6E4));this.G1k=new Pa.a(()=>jh.vS("PresenceLightupLatencyThreshold",
2E3));this.cDk=new Pa.a(()=>jh.vS("PresenceLightupLatencyCutoffThreshold",1E4));this.qca=Mb;this.xTk=pe;this.rjh=Jb;this.FJh=Wc;this.mqb=Md;this.Zr=td;this.ofc=Th;this.JIb=Xd;this.Bdc=he;this.bhh=!1;this.init()}U5c(Jb,Wc,Md=null,Mb=0){Md&&(O.ULS.shipAssertTag(42274970,302,!this.ofc||this.ofc===Md,"_myClientId is already set and you are trying to update it to something different"),this.ofc=Md);const pe=new K.a;this.init().continueWith(()=>{this.Flo(Jb);this.wam(pe,Jb,Wc,Mb)})}get Slj(){return this.ofc||
"{"+ya.AFrameworkApplication.userSessionId+"}"}init(){if(this.JPc)return this.JPc.task;this.JPc=new K.a;this.JIb()&&O.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.rjh.continueWith(()=>{const Jb=this.rjh.result,Wc=Jb.Klc,Md=Jb.T7n;Md.continueWith(()=>{Wc.continueWith(()=>{this.Bdc&&this.Bdc.addQosPillar(Ca.a[Ca.a.RealTimeCoauth]);this.AIg(Wc.result,Md.result);this.JPc.setResult(null)})})});this.FJh.continueWith(()=>{this.Di=this.FJh.result;this.Di.D5(this.Umo);this.Di.XR(this.Ifo)});
this.mqb.continueWith(()=>{this.wH=this.mqb.result;this.wH.rjc(this.Vte);0<this.wH.rwb().length&&this.Qka()});return this.JPc.task}RFi(){this.bDd||(this.bDd=new K.a,this.qca.nh(4,()=>{this.bDd.JY(this.Zr.Iv("AppInitStatus_interactivityReady"))}));return this.bDd.task}Qka(){const Jb=Date.now();var Wc=this.wH.rwb();const Md=new ea.a;for(const Mb of Wc)this.syh.contains(Mb.clientId)||(this.syh.add(Mb.clientId),Md.add(Mb.clientId));if(0<Md.count)for(const Mb of Md)Wc=this.yOf(Mb),Wc.j9h||(Wc.i9h=Jb)}Flo(Jb){Jb=
this.yOf(Jb);Jb.X4h||(Jb.W4h=Date.now())}yOf(Jb){return Jb in this.SQe?this.SQe[Jb]:this.SQe[Jb]=new ta(Jb,this.G1k,this.cDk)}AIg(Jb,Wc=0){this.wMh=Jb;this.xMh=Wc?Wc:(new Date).getTime()}wam(Jb,Wc,Md,Mb){Md=Md?Md.getTime():(new Date).getTime();Wc in this.sHh?Jb.Tsa():(Mb=new Ia(Wc,this.x_m(),Md,this.Ace(this.Slj),this.Ace(Wc),this.sQb,this.FJb,Mb,this.JIb),this.sHh[Wc]=Mb,Mb.G9b(Jb))}x_m(){return 1===this.wMh?la.Task.z$(this.xMh):this.RFi()}Ace(Jb){return this.xTk.Ace(Jb)}}(0,ja.a)(za,"PresenceBootTelemetry",
null,[1817]);var pa=v(25894),sa=v(8904),Aa=v(92027),ka=v(62038),ha=v(72143);class mb{get name(){return"Common.App.CoauthTelemetry"}configure(Jb){Jb.register(J,"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").fa().jd(()=>new J(ha.a.Xs((0,oa.f)(M.a)),ya.AFrameworkApplication.Rf));Jb.register(h,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").fa().jd(()=>new h(ya.AFrameworkApplication.oa,ha.a.Xs((0,oa.f)(I.a)),
ya.AFrameworkApplication.J,pa.a.get_instance(),Aa.a.instance,ha.a.Xs((0,oa.f)(H)),ha.a.Xs((0,oa.f)(M.a)),J.wZh,()=>this.D1h()));Jb.register(za,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").fa().jd(()=>new za(ha.a.Xs((0,oa.f)(I.a)),ha.a.Xs((0,oa.f)(G.a)),ha.a.Xs((0,oa.f)(M.a)),pa.a.get_instance(),(0,oa.a)(B),Aa.a.instance,()=>this.D1h(),ya.AFrameworkApplication.J,null,X.Health.instance));Jb.register(W,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").fa().jd(()=>
new W(ha.a.Xs((0,oa.f)(M.a))));Jb.register(Ka,"Common.App.CoauthTelemetry.GuestCoauthTelemetry").fa().jd(()=>new Ka(ha.a.Xs((0,oa.f)(M.a)),ha.a.Xs((0,oa.f)(w.a)),ya.AFrameworkApplication.J,"{"+ya.AFrameworkApplication.userSessionId+"}"))}async initializeAsync(){ya.AFrameworkApplication.J.gm(()=>{(0,oa.a)(u).init();(0,oa.a)(r).init();ya.AFrameworkApplication.J.$("CoauthorGalleryTelemetryIsEnabled")&&(0,oa.a)(t).init();ya.AFrameworkApplication.J.$("CashTelemetryIsEnabled")&&((0,oa.a)(D),(0,oa.a)(B))})}dispose(){}D1h(){return ka.a.bSb&&
Aa.a.instance.CK("UserActions")?0<Aa.a.instance.Iv("UserActions").VisiToggled:!1}static main(){sa.a.instance.Vk(new mb)}}(0,ja.a)(mb,"CoauthTelemetryPackage",null,[5,1]);const na=(0,oa.b)("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager"),va=(0,oa.d)(na),Cb=(0,oa.b)("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"),wb=(0,oa.d)(Cb);var gb=v(82009);class Wa extends Sys.EventArgs{constructor(){super()}}(0,ja.a)(Wa,"RtcHostNotificationEventArgs",
Sys.EventArgs,[]);var vb;(function(Jb){Jb[Jb.BUq=0]="notYetStarted";Jb[Jb.cwr=1]="polling";Jb[Jb.tTs=2]="subscribed";Jb[Jb.zol=3]="blocked";Jb[Jb.zvr=4]="permanentlyStopped"})(vb||(vb={}));(0,ja.b)("RtcHostNotificationSubscriptionState",vb);var Za=v(59474),Sa=v(49934),ub=v(52172),ab=v(76701);class Ya{constructor(Jb,Wc,Md,Mb,pe,td,Xd,jh,Th){this.ji=!1;this.dU=this.lgc=this.Nna=this.r$a=null;this.oBg=()=>{this.r$a=null;if(this.F8i){O.ULS.sendTraceTag(573100181,502,50,"HostNotifications: Send event when connected.  Current state: {0}",
vb[this.GFc]);let he=null;this.W9e&&this.W9e.length&&(he={},he.etts=this.W9e);this.lgc.gH(14,he,!0);this.MQj(this.oWk)}else this.trb.event(3)};this.gLp=()=>{this.Nna=null;2===this.GFc&&(this.trb.event(1),O.ULS.shipAssertTag(573100185,502,!!this.r$a,"Missing task to ensure that we re-subscribe."))};this.hO=()=>{this.T8m()};this.LV=(he,Id)=>{if(13===Id.type&&(he=Id.KC,O.ULS.sendTraceTag(573100183,502,50,"HostNotifications: Subscription status: {0}",{SerializableHostNotificationSubscription:he,DurationBeforeExpirationToResubscribeInSec:this.dRd}),
Id=he.cts,!this.TNp(Id))){if(he.sb){var Xk=2;this.K6o(he.cts)}else Xk=1,this.GWc=Ya.gNe,this.Nna&&(this.pb.Lf(this.Nna),this.Nna=null);this.trb.event(Xk);this.r$a?this.pb.E7(this.r$a,1E3*Id):this.MQj(Id)}};this.Ono=(he,Id)=>{he=Id.newState;const Xk=Id.fBj,mh={};mh.NewState=vb[he];mh.PreviousState=vb[Xk];mh.PreviousStateHits=Id.gBj;mh.PreviousStateTransitionTime=Id.hBj.toISOString();mh.IsSubscribed=this.g9i;this.GWc!==Ya.gNe&&(mh.SubscriptionExpiringTime=this.GWc.toISOString());O.ULS.sendTraceTag(572346515,
502,4===he?15:50,"HostNotificationChanged: {0}",mh);this.na.raiseEvent("HN",new Wa(Xk,he))};this.GWc=Ya.gNe;this.na=new ub.a;this.trb=new Sa.a(0);this.trb.fWh(this.Ono);this.oWk=Jb;this.dRd=Wc;this.nWk=Md;this.W9e=Mb;this.pb=pe;this.sk=td;Xd.execute(he=>{this.ji||(this.lgc=he,this.lgc.XR(this.LV),this.start())});jh.execute(he=>{this.ji||(this.dU=he,(0,ab.a)()?he.fEa(this.hO):he.eEa(this.hO))});this.JTd=Th}get GFc(){return this.trb.currentState}get F8i(){return!this.sk||this.sk.M2a}get g9i(){return 2===
this.GFc&&this.JTd()<this.GWc}start(){0!==this.GFc?O.ULS.sendTraceTag(573100178,502,15,"HostNotifications: Tried starting poll when in state {0}",vb[this.GFc]):(this.trb.event(1),this.oBg(null))}MQj(Jb){this.r$a=Za.a.zwa(1E3*Jb,this.oBg,this.dRd,192,"RtcHostNotificationSubscribe");this.pb.vb(this.r$a)}K6o(Jb){Jb=1E3*(Jb+this.nWk);const Wc=this.JTd().getTime()+Jb;this.GWc=new Date(Wc);Jb-=this.dRd;this.Nna?this.pb.E7(this.Nna,Jb):(this.Nna=Za.a.zwa(Jb,this.gLp,this.dRd/2,194,"RtcHostNotificationTransitionToPolling"),
this.pb.vb(this.Nna))}T8m(){3===this.GFc&&this.F8i&&(this.trb.event(this.g9i?2:1),this.oBg(null))}TNp(Jb){if(!isNaN(Jb)&&isFinite(Jb)&&0<Jb)return!1;this.k4j(!1);return!0}k4j(Jb){this.r$a&&(this.pb.Lf(this.r$a),this.r$a=null);this.Nna&&(this.pb.Lf(this.Nna),this.Nna=null);this.lgc&&(this.lgc.NIa(this.LV),this.lgc=null);this.dU&&((0,ab.a)()?this.dU.g5b(this.hO):this.dU.f5b(this.hO),this.dU=null);Jb||this.trb.event(4)}dispose(){this.ji||(this.ji=!0,this.k4j(!0),this.Nna&&(this.pb.Lf(this.Nna),this.Nna=
null))}}Ya.gNe=new Date(0);(0,ja.a)(Ya,"RtcHostNotificationSubscriptionManager",null,[1818,33]);var jb=v(11218);class kb{constructor(){this.eh=this.ji=!1}get name(){return"RtcHostNotificationSubscription"}configure(Jb){Jb.register(Ya,"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").fa().jd(()=>{const Wc=ya.AFrameworkApplication.J;return new Ya(Wc.Ab("RtcHostNotificationRetryIntervalIdeallyInSeconds",
1800),Wc.Ab("RtcHostNotificationRetryIntervalBufferInSeconds",120),Wc.Ab("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.LXm(Wc),ya.AFrameworkApplication.Ib,jb.a.instance,(0,oa.f)(G.a),(0,oa.f)(gb.a),()=>new Date)})}async initializeAsync(){ya.AFrameworkApplication.J.gm(()=>{!this.ji&&ya.AFrameworkApplication.J.$("RtcHostNotificationEnabled")&&(this.eh=!0,(0,oa.a)(wb))})}dispose(){this.ji||(this.ji=!0,this.eh&&(0,oa.a)(va).dispose())}LXm(Jb){return Jb.Rq("RtcEventTypesToSubscribe")?Jb.ks("RtcEventTypesToSubscribe"):
null}static main(){sa.a.instance.Vk(new kb)}}(0,ja.a)(kb,"RtcHostNotificationSubscriptionPackage",null,[5,1]);var hb=v(6475),Bb=v(60436);class cc{constructor(Jb,Wc,Md,Mb,pe,td,Xd,jh,Th,he,Id,Xk){this.clientId=Jb;this.SkypeChatThreadId=Md;this.chatThreadDiscoveryUri=Mb;this.inChat=pe;this.localCobaltSessionId=Wc;this.capabilities=td;this.email=Xd;this.isReadOnly=jh;this.userName=Th;this.isAnonymous=he;this.presenceStatus=Id;this.dssLineageId=Xk}}(0,ja.a)(cc,"SerializablePresenceUserData",null,[]);
class rc extends hb.a{constructor(Jb,Wc,Md,Mb,pe=null,td=null,Xd=null,jh=null,Th=null,he=!1,Id=!1,Xk=!1,mh=null,Rl=null){super(Jb,Wc,Md,Mb,td,Xd,jh,Th,he,Id,Xk);this.localCobaltSessionId=pe;this.presenceStatus=mh;this.dssLineageId=Rl}getData(){return new cc(this.clientId,this.localCobaltSessionId,this.q0c,this.chatThreadDiscoveryUri,this.inChat,this.capabilities.capabilities,this.email,this.isReadOnly,this.userName,this.isAnonymous,this.presenceStatus,this.dssLineageId)}Bce(Jb){return(Jb=Jb.value)?
Jb.user:null}clone(){return new rc(this.clientId,this.userName,this.color,this.capabilities.clone(),this.localCobaltSessionId,this.q0c,this.email,this.client,this.chatThreadDiscoveryUri,this.isAnonymous,this.inChat,this.isReadOnly,this.presenceStatus,this.dssLineageId)}static pTb(Jb){return Jb.clientId?new rc(Jb.clientId,Jb.userName,null,new Bb.a(void 0===Jb.capabilities?0:Jb.capabilities),Jb.localCobaltSessionId,Jb.SkypeChatThreadId,Jb.email,null,Jb.chatThreadDiscoveryUri,Jb.isAnonymous,Jb.inChat,
Jb.isReadOnly,Jb.presenceStatus,Jb.dssLineageId):null}static Pei(Jb,Wc,Md,Mb=null,pe=null,td=null,Xd=null,jh=null,Th=!1,he=!1,Id=!1,Xk=null,mh=null){return Jb?new rc(Jb,Wc,null,new Bb.a(void 0===Md?0:Md),Mb,pe,td,Xd,jh,Id,Th,he,Xk,mh):null}}(0,ja.a)(rc,"PresenceUser",hb.a,[210,211,205]);class sb extends rc{constructor(){super();this.iBc=this.qjd=null}wOm(){const Jb=ya.AFrameworkApplication.userName,Wc=ya.AFrameworkApplication.J.ya("UserPrincipalName"),Md=this.qjd?this.qjd.localCobaltSessionId:null,
Mb=ya.AFrameworkApplication.JHc||ya.AFrameworkApplication.Caa,pe=this.iBc?this.iBc.getStatus():null;return new rc(this.clientId,Jb,this.color,this.capabilities,Md,this.q0c,Wc,this.client,this.chatThreadDiscoveryUri,Mb,this.inChat,this.isReadOnly,pe,this.qjd?this.qjd.Daa:null)}}(0,ja.a)(sb,"MyPresenceUser",rc,[204,205]);var qb=v(97865);const tb=(0,oa.d)(qb.a),yb=(0,oa.d)(H);var $b=v(46832);const ac=(0,oa.b)("WordEditor.Presence.IWordPresenceCpFactory");var ob=v(22198),Db=v(51994),ec=v(3199),Ic=v(42207),
fd=v(67910);class sc{constructor(Jb,Wc,Md,Mb,pe){this.Zd=Jb;this._clientId=Wc;this.fEk=pe;this.iIk=Md||(()=>null);this.jIk=Mb||(()=>null)}get id(){return this.Zd.id}get KVd(){return this.Zd.KVd}get OVd(){return this.Zd.OVd}get NVd(){return this.Zd.NVd}get MVd(){return this.Zd.MVd}get LVd(){return this.Zd.LVd}get PVd(){return this.Zd.PVd}get ogf(){return this.Zd.ogf}get eFc(){return this.Zd.eFc}get SDe(){return this.Zd.SDe}get kqe(){return this.Zd.kqe}get clientId(){return this._clientId}get VXb(){return this.iIk}get gQa(){return this.jIk}get R4l(){return this.fEk}static createInstance(Jb,
Wc,Md,Mb,pe=!1){return new sc(Jb,Wc,Md,Mb,pe)}}(0,ja.a)(sc,"PeoplesWellSettings",null,[]);var pc=v(2266),Oc=v(79762);const jd=(0,oa.d)(Oc.a);var Wd=v(80925),se=v(17213),Zb=v(7413),Cc=v(86815),ed=v(67795),le=v(78372),Yb=v(61902),bc=v(41860),pd=v(12619);class Vb extends le.a{constructor(){super();this.JoinTimeInMS=0;this.IsAnonymous=!1;this.ImageUrl=null;this.CanJump=this.ActiveStatus=!1;this.CoauthorPresenceDescription=this.Upn=null}get ControlType(){return 5}}(0,ja.a)(Vb,"PeopleButtonProps",le.a,
[]);var zc=v(33703),$c=v(29550);class rd{constructor(Jb){this.Dzd=new $c.a;this.fyf=null;this.clientId=Jb}Plp(Jb){this.nTo();this.adp(Jb);for(const Wc of Jb)Wc.clientId!==this.clientId&&this.XUh(Wc)}get dRg(){const Jb=[];for(const Wc of this.Dzd.values){const Md=this.JRj(Wc);Array.add(Jb,Md)}return Jb}get QBb(){return this.Dzd.count}tif(Jb,Wc){Jb=Jb.toUpperCase();let Md;({value:Md}=this.Dzd.qc(Jb)).returnValue||(Md=[],this.Dzd.W(Jb,Md));Array.add(Md,Wc)}nTo(){this.Dzd=new $c.a}adp(Jb){for(const Wc of Jb)if(Wc.clientId===
this.clientId){this.fyf=Wc;break}}}(0,ja.a)(rd,"UserTracker",null,[1658]);class fc extends rd{constructor(Jb,Wc){super(Jb);this.kIk=Wc}XUh(Jb){Jb.isAnonymous||!Jb.email?this.tif(Jb.clientId,Jb):this.fyf&&ma.a.Xg().equals(this.fyf.email,Jb.email)||this.tif(Jb.email,Jb)}JRj(Jb){let Wc=new Date(0),Md=0<Jb.length?Jb[0]:null;for(const Mb of Jb)(Jb=this.kIk(Mb.clientId))&&Wc.getTime()<Jb.fxc.getTime()&&(Wc=Jb.fxc,Md=Mb);return Md}}(0,ja.a)(fc,"UniqueUserTracker",rd,[]);class Sc extends rd{constructor(Jb){super(Jb)}XUh(Jb){this.tif(Jb.clientId,
Jb)}JRj(Jb){return Jb[0]}}(0,ja.a)(Sc,"UserInstanceTracker",rd,[]);const qc=(Jb,Wc,Md)=>Md?new fc(Jb,Wc):new Sc(Jb);var gd=v(11329),Oe=v(46966),Re=v(45622),sd=v(56637);class Gc{constructor(Jb,Wc=null,Md=null){this.wH=null;this.ddf=new K.a;this.Jfo=(Mb,pe,td,Xd,jh)=>{this.ddf.JY(jh.RenderTime);return 32};this.Zd=Jb;this.QAc=Wc;Md&&Md.continueWith(()=>{this.wH=Md.result;this.wH.rjc((0,ed.a)(this,this.Qka,"onUsersUpdated"));this.Eqd()});new hb.a(this.settings.clientId,"Anonymous user","#cccccc",new Bb.a(7));
this.f2f=this.P0e=!0;this.IXe=this.b7e=!1;this.aKa=qc(this.settings.clientId,this.settings.gQa,Jb.R4l)}get settings(){return this.Zd}get mxn(){return ya.AFrameworkApplication.J?ya.AFrameworkApplication.J.$("ColorPresenceHashIsEnabled"):!1}get hxn(){return ya.AFrameworkApplication.J?ya.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled"):!1}Zzm(){let Jb,Wc,Md,Mb;var pe=this.$zm();this.aKa.QBb?1===this.aKa.QBb?(Jb=!0,Wc=this.settings.eFc.cluster,Md=this.settings.eFc.E3d,Mb=this.aKa.dRg[0].color):
(Jb=!0,Wc=this.settings.kqe.cluster,Md=this.settings.kqe.E3d,Mb=""):(Jb=!1,Mb=Md=Wc="");const td=pe[0];pe=pe.slice(1);return{Pqo:td,Qqo:pe,Kqo:Jb,mXq:Wc,Mqo:Md,Lqo:Mb}}$zm(){if(2<=this.aKa.QBb)return[String.format((0,sd.a)("PeoplesWellStateNumberOfOtherPeopleEditingHere"),this.aKa.QBb)];if(1===this.aKa.QBb){const Jb=this.aKa.dRg[0],Wc=this.settings.gQa(Jb.clientId);return Wc&&2===Wc.status?[(0,sd.a)("PeoplesWellStateUserIsInactive"),Jb.userName]:[Jb.isReadOnly?(0,sd.a)("PeoplesWellStateUserIsAlsoViewing"):
(0,sd.a)("PeoplesWellStateUserIsAlsoEditing"),Jb.userName]}return[(0,sd.a)("PeoplesWellStateYouAreAllByYourself")]}F4m(Jb){return this.G4m(Jb)}x4h(Jb,Wc,Md){return Wc?this.Ovl(Wc)?(Jb=this.settings.gQa(Jb))&&2===Jb.status?!1:!0:(Md&&O.ULS.sendTraceTag(4482394,325,50,"User has presence data but app can't use it"),!1):(Md&&O.ULS.sendTraceTag(4482393,325,50,"User does not have any presence data"),!1)}C_m(Jb){return Jb.isReadOnly?(0,sd.a)("PeoplesWellUserStatusIsViewingOffline"):(0,sd.a)("PeoplesWellUserStatusLocationUnknown")}G4m(Jb){if(!Jb.capabilities.q1a(1))return this.C_m(Jb);
const Wc=Jb.isReadOnly,Md=this.settings.gQa(Jb.clientId);Jb=this.settings.VXb(Jb.clientId);if(!Md)return(0,sd.a)("PeoplesWellUserStatusLocationUnknown");switch(Md.status){case 1:return Jb?1!==ya.AFrameworkApplication?.qa?.ib?.hl&&Wc?(0,sd.a)("PeoplesWellUserStatusIsViewingOnline"):this.qLl(Jb)||(0,sd.a)("PeoplesWellUserStatusLocationUnknown"):(0,sd.a)("PeoplesWellUserStatusLocationUnknown");case 2:return(0,sd.a)("PeoplesWellUserStatusIsInactive");default:return(0,sd.a)("PeoplesWellUserStatusLocationUnknown")}}vJm(Jb){if(this.QAc.gAb)return ya.AFrameworkApplication.J?.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseXhrForProfilePicturesInPeoplesWellIsEnabled",
!1)?Jb.Gpd||"":this.QAc.nub(Jb.email,"O365",ya.AFrameworkApplication.Hj,0)}r4m(Jb){Jb=this.settings.gQa(Jb.clientId);return!Jb||Jb&&1===Jb.status?!0:!1}s4m(Jb){var Wc=String.format("buttonPeoplesWellUser-{0}",Jb.clientId),Md=Jb.clientId,Mb=this.F4m(Jb);const pe=Jb.userName,td=Jb.color;var Xd=Object,jh=Xd.assign,Th=new Vb,he=this.settings.PVd.toString(),Id=this.settings.SDe.cluster,Xk=this.settings.SDe.E3d,mh=this.xCi(),Rl=Jb.isAnonymous,rk;if(rk=[pe],rk.length){var nf=new Sys.StringBuilder("STRARRY@");
for(const Pf of rk)nf.append(Pf?Pf.length:0),nf.append(","),nf.append(Pf),nf.append(",");rk=nf.toString().slice(0,-1)}else rk=null;Wc=jh.call(Xd,Th,{Id:Wc,Command:he,LabelText:"{0}",Image32by32:Id,Image32by32Class:Xk,MenuItemId:Md,CommandValueId:Md,Alt:pe,DisplayMode:mh,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word",Description:Mb,ImageBackColor:td,IsAnonymous:Rl,LabelTextUserGeneratedPlaceholderReplacements:rk,Upn:Jb.email,CoauthorPresenceDescription:this.Exm(Jb)});
ya.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled")&&this.QAc&&(Md=this.vJm(Jb),Mb=this.r4m(Jb),Wc.ImageUrl=Md,Wc.ActiveStatus=Mb,Wc.JoinTimeInMS=Jb.Q2a,Jb=this.x4h(Jb.clientId,this.settings.VXb(Jb.clientId),!1),Wc.CanJump=Jb,""===Md&&O.ULS.sendTraceTag(40969413,302,50,"ImageURL collection failed"));return Wc}DHm(){return Object.assign(new le.a,{Id:"BasicChat",Command:"2288458806",LabelText:(0,sd.a)("StartGroupChat"),LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word"})}xCi(){return this.mxn?
"Initials":"Menu32"}t4m(Jb){const Wc=[];for(const Md of Jb)Jb=this.s4m(Md),Array.add(Wc,Jb);return Wc}Wie(){return 0<this.aKa.QBb}NGo(Jb){if(!this.P0e)return!0;this.f2f||(Jb[Oe.a.Visible]=!0);const {Pqo:Wc,Qqo:Md,Kqo:Mb,Mqo:pe,Lqo:td}=this.Zzm();Jb[Oe.a.LabelText]=Wc;Md&&Md.length&&(Jb[Oe.a.LabelTextUserGeneratedPlaceholderReplacements]=Md);Jb[Oe.a.ImageIsVisible]=Mb;Jb[Oe.a.Image16by16Class]=pe;Jb[Oe.a.ImageBackColor]=td;this.P0e=!1;return!0}Mxo(Jb){if(0>=this.aKa.QBb)return!1;var Wc=this.eyp(this.aKa.dRg),
Md=this.t4m(Wc);Wc=Object.assign(new bc.a,{Id:"menuCoauthors",MaxWidth:"220px",MenuSectionList:[]});Md=Object.assign(new pd.a,{Id:"msCoauthors",ControlsId:"msCoauthorsControls",DisplayMode:this.xCi(),ControlList:Md});ya.AFrameworkApplication.J.$("WordEditorDisplayPeoplesWellLabelIsEnabled")&&this.QAc&&(Md.Title=(0,sd.a)("PeoplesWellFlyoutLabel"),Md.TitleId="menuCoauthorsTitle",Md.Theme="Light");Array.add(Wc.MenuSectionList,Md);ya.AFrameworkApplication.J.$("DocChatIsEnabled")&&ya.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled")&&
ya.AFrameworkApplication.qa&&ya.AFrameworkApplication.qa.ib.ut&&(Md=[],Array.add(Md,this.DHm()),Md=Object.assign(new pd.a,{Id:"msGroupChat",ControlsId:"msGroupChatControl",ControlList:Md}),Array.add(Wc.MenuSectionList,Md));ya.AFrameworkApplication.qa&&ya.AFrameworkApplication.qa.ib.ut?Jb.MenuItems=Wc:Jb.PopulationXML=Yb.k(Wc);return!0}aRg(Jb){O.ULS.sendTraceTag(4482395,325,50,"PeoplesWell: Received user button click");Jb=Jb.MenuItemId;if(!Jb)return!1;const Wc=this.settings.VXb(Jb);if(!this.x4h(Jb,
Wc,!0))return!1;this.jOn(Wc);return!0}vNo(){const Jb=this.Usm();this.aKa.Plp(Jb);this.f2f&&1<=this.aKa.QBb&&(O.ULS.sendTraceTag(6092429,325,50,"PeoplesWell: User is no longer forever alone."),this.f2f=!1);this.P0e=!0;if(ya.AFrameworkApplication.J?.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseXhrForProfilePicturesInPeoplesWellIsEnabled",!1)){const Wc=[];for(const Md of Jb)Wc.push(this.Cfp(Md));Promise.allSettled(Wc).then(Md=>{const Mb=[];Md.forEach(pe=>{"fulfilled"!==pe.status&&Mb.push(pe?.reason)});
0<Mb.length&&O.ULS.sendTraceTag(506569233,325,10,`Failed to set some people profile picture url, reasons: ${Mb.join(", ")}`);this.wNo()})}}Qka(){this.IXe||(window.setTimeout(()=>{this.Eqd();this.IXe=!1},3E3),this.IXe=!0)}Usm(){let Jb;Jb=this.Tsm()||[];for(const Wc of Jb)this.l5o(Wc);return Jb}l5o(Jb){Jb.clientId||(Jb.clientId=Ga.a.create().toString());Jb.userName||(Jb.userName="Anonymous user");Jb.capabilities||(Jb.capabilities=new Bb.a);Jb.color||(Jb.color="#cccccc");Jb.Q2a||(Jb.Q2a=0)}eyp(Jb){const Wc=
[];Array.addRange(Wc,Jb);Wc.sort(Gc.vqo);return Wc}YQo(){ya.AFrameworkApplication.J.$("CoauthorGalleryTelemetryIsEnabled")&&!this.b7e&&(ya.AFrameworkApplication.oa.vX(Re.a.t9h)&&ya.AFrameworkApplication.J.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DoNotRegisterCoauthorsRenderedMultiplTimes")||ya.AFrameworkApplication.oa.pa(Re.a.t9h,gd.a.frame,this.Jfo,96));this.ZQo();this.b7e=!0;this.Eqd()}get J7j(){return this.ddf.task}Eqd(){if(!this.b7e&&(this.ddf.JY((new Date).getTime()),O.ULS.sendTraceTag(42567504,
325,50,"We are trying to render the coauthor gallery before we are ready to record the render time"),this.hxn))return;this.vNo();this.wNo()}Cfp(Jb){return!this.QAc.gAb||Jb.Gpd?Promise.resolve(Jb):this.QAc.kpc(Jb.email,"O365",ya.AFrameworkApplication.Hj,0).then(Wc=>{Jb.Gpd=Wc;return Jb}).catch(()=>{Jb.Gpd="";return Jb})}dispose(){this.wH&&(this.wH.Iwg((0,ed.a)(this,this.Qka,"onUsersUpdated")),this.wH=null)}static vqo(Jb,Wc){return Jb.capabilities.q1a(1)&&!Wc.capabilities.q1a(1)?-1:!Jb.capabilities.q1a(1)&&
Wc.capabilities.q1a(1)?1:!Jb.isReadOnly&&Wc.isReadOnly?-1:Jb.isReadOnly&&!Wc.isReadOnly?1:zc.a.localeCompare(Jb.userName,Wc.userName)}Exm(Jb){this.settings?.VXb(Jb.clientId);this.settings?.gQa(Jb.clientId)}}(0,ja.a)(Gc,"APeoplesWell",null,[639,33]);const xc=()=>!0;class yc extends Gc{constructor(Jb,Wc,Md=null,Mb=null){super(Jb,Md,Mb);this.gyn=(pe,td,Xd,jh,Th)=>this.$eb(Xd,Th,()=>this.Wie(),xc);this.OGo=(pe,td,Xd,jh,Th)=>this.$eb(Xd,Th,he=>this.NGo(he),xc);this.Nxo=(pe,td,Xd,jh,Th)=>this.$eb(Xd,Th,
xc,he=>this.Mxo(he));this.LFl=(pe,td,Xd,jh,Th)=>this.$eb(Xd,Th,xc,xc);this.KFl=(pe,td,Xd,jh,Th)=>this.$eb(Xd,Th,xc,xc);this.h_p=(pe,td,Xd,jh,Th)=>this.$eb(Xd,Th,xc,he=>this.aRg(he));this.vvo=(pe,td,Xd,jh,Th)=>this.$eb(Xd,Th,xc,()=>{this.Eqd();return!0});this.ga=Wc}$eb(Jb,Wc,Md,Mb){let pe=!1;switch(Jb){case 1:pe=Md(Wc);break;case 2:pe=Mb(Wc)}return pe?32:8}ZQo(){this.ga.ra(this.settings.KVd,1,this.gyn);this.ga.pa(this.settings.OVd,1,this.OGo,96);this.ga.pa(this.settings.MVd,1,this.LFl,96);this.ga.pa(this.settings.LVd,
1,this.KFl,96);this.ga.pa(this.settings.NVd,1,this.Nxo,96);this.ga.ra(this.settings.PVd,1,this.h_p);this.ga.pa(this.settings.ogf,1,this.vvo,96)}}(0,ja.a)(yc,"ABox4PeoplesWell",Gc,[]);var dd=v(13691),Kc=v(26267),ud=v(34150),Tc=v(79461),Ed=v(32686);class od{static isSupported(Jb){for(let Wc=0;Wc<od.i5j.length;Wc++)if(Jb===od.i5j[Wc])return!0;return!1}}od.i5j=[1];(0,ja.a)(od,"RTTDataVersion",null,[]);var Lc=v(7240);const ge=Jb=>{if("number"!==typeof Jb.RK||"number"!==typeof Jb.DK)return!1;let Wc,Md=
!1,Mb=!1,pe=!1;switch(Jb.RK){case 0:Mb=Wc=!0;break;case 1:pe=Md=Mb=Wc=!0;break;case 2:if(null!=Jb.PE&&"number"!==typeof Jb.PE)return!1;Wc=!0;break;case 4:Wc=!0;break;case 3:Mb=Wc=!0;break;case 5:Md=Wc=!0;break;default:return!1}return Wc&&("number"!==typeof Jb.PS||"number"!==typeof Jb.TS)||Mb&&("object"!==typeof Jb.OS||!Jb.OS||!Lc.a(Jb.OS))||Md&&("number"!==typeof Jb.PE||"number"!==typeof Jb.TE)||pe&&("object"!==typeof Jb.OE||!Jb.OE||!Lc.a(Jb.OE))?!1:!0};var pf=v(38439);const Ff=Jb=>{let Wc="";if("number"!==
typeof Jb.I)return{returnValue:!1,qqa:"Invalid PacketId Type"};if("number"!==typeof Jb.O)return{returnValue:!1,qqa:"Invalid Operation Type"};if("string"!==typeof Jb.A)return{returnValue:!1,qqa:"Invalid ClientId Type"};if("object"!==typeof Jb.AN)return{returnValue:!1,qqa:"Invalid Anchor Object Type"};if(!Jb.AN)return{returnValue:!1,qqa:"Null AnchorObject"};if(!ge(Jb.AN)){let Md;try{Md=Ra.c(Jb.AN)}catch(Mb){pf.a.trackExceptionTag(505995299,Mb),Md=String.format("Failed to JSON-serialize payload : {0}",
Mb)}8E3<Md.length&&(Md=String.format("Payload exceeds maximum length: {0} > {1}, not logging",Md.length,8E3));Wc="Invalid AnchorObject: "+Md+", Client: "+Jb.C;return{returnValue:!1,qqa:Wc}}return!Jb.O&&Jb.AN.RK?(Wc="Invalid RangeKind:"+Jb.AN.RK+" for Caret",{returnValue:!1,qqa:Wc}):2===Jb.O&&("number"!==typeof Jb.TF||"undefined"!==typeof Jb.TX&&"string"!==typeof Jb.TX||1!==Jb.AN.RK&&Jb.AN.RK)?{returnValue:!1,qqa:"Invalid TypingData"}:3!==Jb.O||"object"===typeof Jb.AP&&Jb.AP&&"number"===typeof Jb.AP.TFA&&
"number"===typeof Jb.AP.PN&&"number"===typeof Jb.AP.TN&&2===Jb.AN.RK?6!==Jb.O||"object"===typeof Jb.MP&&Jb.MP&&"number"===typeof Jb.MP.PM&&"number"===typeof Jb.MP.TM&&5===Jb.AN.RK?4!==Jb.O||"object"===typeof Jb.SP&&Jb.SP&&"number"===typeof Jb.SP.PA&&"number"===typeof Jb.SP.TA&&"number"===typeof Jb.SP.PB&&"number"===typeof Jb.SP.TBS&&3===Jb.AN.RK&&(Jb.AN.PS===Jb.SP.PA||Jb.AN.PS===Jb.SP.PB)?7!==Jb.O||"object"===typeof Jb.SPS&&Jb.SPS&&"string"===typeof Jb.SPS.SF&&"boolean"===typeof Jb.SPS.SL?null!=Jb.ISS&&
"number"!==typeof Jb.ISS?{returnValue:!1,qqa:"invalid StrictlySequentialId"}:{returnValue:!0,qqa:Wc}:{returnValue:!1,qqa:"Invalid SymbolData"}:{returnValue:!1,qqa:"Invalid SplitParaData"}:{returnValue:!1,qqa:"Invalid RemoveParaData"}:{returnValue:!1,qqa:"Invalid AddParaData"}};var kg=v(96371);class We{constructor(Jb,Wc=null,Md=null){this.c8=this.jng=this.HLg=null;null!=Jb&&(this.HLg=Jb);null!=Wc&&(this.jng=Wc);null!=Md&&(this.c8=Md)}}(0,ja.a)(We,"AddParaData",null,[]);class zf{constructor(Jb=null,
Wc=null){this.jGc=this.ing=null;null!=Jb&&(this.ing=Jb);null!=Wc&&(this.jGc=Wc)}}(0,ja.a)(zf,"MergeRemoveParaData",null,[]);class Wi{constructor(Jb,Wc,Md,Mb,pe,td,Xd=null,jh=null,Th=null,he=null,Id=null,Xk=null,mh=0,Rl=null){this.Pwd=this.text=this.q8b=this.G7b=this.Nkd=this.ejc=this.dta=null;this.packetId=Jb;this.client=Md;this.operationType=Mb;this.clientId=Wc.toLowerCase();this.IZ=pe;this.version=mh;td&&(this.dta=td);null!=Xd&&(this.q8b=Xd);null!=jh&&(this.text=jh);Th&&(this.ejc=Th);he&&(this.Nkd=
he);Id&&(this.G7b=Id);Xk&&(this.Pwd=Xk);this.strictlySequentialId=Rl}}(0,ja.a)(Wi,"RTTData",null,[]);class Zf{constructor(Jb=null,Wc=null,Md=null,Mb=null){this.GLg=this.hng=this.DLg=this.gng=null;null!=Jb&&(this.gng=Jb);null!=Wc&&(this.DLg=Wc);null!=Md&&(this.hng=Md);null!=Mb&&(this.GLg=Mb)}}(0,ja.a)(Zf,"SplitParaData",null,[]);class Me{constructor(Jb=null,Wc=null){this.hKg=this.gKg=null;Jb&&(this.gKg=Jb);null!=Wc&&(this.hKg=Wc)}}(0,ja.a)(Me,"SymbolData",null,[]);class Ub{constructor(Jb,Wc=null,Md=
null){null!=Jb&&(this.TFA=Jb);null!=Wc&&(this.PN=Wc);null!=Md&&(this.TN=Md)}}(0,ja.a)(Ub,"SerializableAddParaDataV1",null,[]);class Wb{constructor(Jb=null,Wc=null){null!=Jb&&(this.PM=Jb);null!=Wc&&(this.TM=Wc)}}(0,ja.a)(Wb,"SerializableMergeRemoveParaDataV1",null,[]);class kd{}(0,ja.a)(kd,"SerializableRTTDataV1",null,[]);class Dd{constructor(Jb=null,Wc=null,Md=null,Mb=null){null!=Jb&&(this.PA=Jb);null!=Wc&&(this.TA=Wc);null!=Md&&(this.PB=Md);null!=Mb&&(this.TBS=Mb)}}(0,ja.a)(Dd,"SerializableSplitParaDataV1",
null,[]);class Be{constructor(Jb=null,Wc=null){Jb&&(this.SF=Jb);null!=Wc&&(this.SL=Wc)}}(0,ja.a)(Be,"SerializableSymbolDataV1",null,[]);const Mf=Jb=>{var Wc;if(!({qqa:Wc}=Ff(Jb)).returnValue)return O.ULS.sendTraceTag(9188759,302,15,"Failed to parse RTT packet, InvalidFieldInfo {0}",Wc),null;let Md=Wc=null,Mb=null,pe=null,td=null,Xd=null,jh=null,Th=null;Jb.WD&&(Wc=Jb.WD);null!=Jb.TF&&(Md=Jb.TF);null!=Jb.TX&&(Mb=Jb.TX);Jb.AP&&(pe=new We(Jb.AP.TFA,Jb.AP.PN,Jb.AP.TN));Jb.MP&&(td=new zf(Jb.MP.PM,Jb.MP.TM));
Jb.SP&&(Xd=new Zf(Jb.SP.PA,Jb.SP.TA,Jb.SP.PB,Jb.SP.TBS));Jb.SPS&&(jh=new Me(Jb.SPS.SF,Jb.SPS.SL));null!=Jb.ISS&&(Th=Jb.ISS);return new Wi(Jb.I,Jb.A,Jb.C,Jb.O,kg.a(Jb.AN),Wc,Md,Mb,pe,td,Xd,jh,1,Th)},re=Jb=>{let Wc=Jb;if("number"===typeof Wc.V){if(1===Wc.V)return Mf(Jb);O.ULS.sendTraceTag(9188758,302,15,"Unsupported Version");return null}let Md=0,Mb=null;for(let pe=0;pe<Jb.length;pe++)Wc=Jb[pe],od.isSupported(Wc.V)&&Wc.V>Md&&(Md=Wc.V,Mb=Jb[pe]);return 1===Md?Mf(Mb):null},yg=Jb=>{if(Jb){const Wc=new kd;
Wc.I=Jb.packetId;Wc.V=1;Wc.A=Jb.clientId;Wc.C=Jb.client;Wc.O=Jb.operationType;Wc.AN=kg.c(Jb.IZ);Jb.dta&&(Wc.WD=Jb.dta);null!=Jb.q8b&&(Wc.TF=Jb.q8b);null!=Jb.text&&0<Jb.text.length&&(Wc.TX=Jb.text);Jb.ejc&&(Wc.AP=new Ub(Jb.ejc.HLg,Jb.ejc.jng,Jb.ejc.c8));Jb.Nkd&&(Wc.MP=new Wb(Jb.Nkd.ing,Jb.Nkd.jGc));Jb.G7b&&(Wc.SP=new Dd(Jb.G7b.gng,Jb.G7b.DLg,Jb.G7b.hng,Jb.G7b.GLg));Jb.Pwd&&(Wc.SPS=new Be(Jb.Pwd.gKg,Jb.Pwd.hKg));Wc.ISS=Jb.strictlySequentialId;Jb=Wc}else Jb=null;return Jb};var ii=v(59385);class Ai{constructor(Jb,
Wc,Md,Mb,pe,td,Xd,jh,Th,he){this.LocalCobaltSessionId=Jb;this.SkypeChatThreadId=Wc;this.ChatThreadDiscoveryUri=Md;this.InChat=Mb;this.Capabilities=pe;this.Email=td;this.UserName=Xd;this.IsAnonymous=jh;this.PresenceStatus=Th;this.DssLineageId=he}}(0,ja.a)(Ai,"SerializableWacData",null,[]);class uc{constructor(){this.uSd=this.tSd=0}mPm(){this.uSd===Number.MAX_VALUE&&(this.uSd=0);this.uSd++;return this.uSd}lPm(){this.tSd===Number.MAX_VALUE&&(this.tSd=0);this.tSd++;return this.tSd}static get instance(){return uc.OYk}}
uc.OYk=new uc;(0,ja.a)(uc,"StrictlySequentialIdGenerator",null,[1807]);var Xc=v(19170);class Bd{constructor(Jb,Wc,Md,Mb,pe,td,Xd,jh=0,Th=0){this.Que=Jb;this.kc=Wc;this.textOffset=Mb;this.pNg=pe;this.Xco=td;this.T3p=Xd;this.shapeId=jh;this.dryDeletion=Th;this.Uza=Md;this.P3=Xd.create(this,Mb,pe,td)}get paragraphId(){return this.RNb?this.RNb:this.Que.T0a(this.kc)}Nzc(){this.RNb||(this.RNb=this.paragraphId,this.P3.Nzc())}isValid(){return 0<=this.P3.cp&&!!this.paragraphId&&!this.paragraphId.equals(ii.a.nil)}clone(){return new Bd(this.Que,
this.kc,this.Uza,this.textOffset,this.pNg,this.Xco,this.T3p,this.shapeId,this.dryDeletion)}}(0,ja.a)(Bd,"WordPresenceSelectionBoundary",null,[209,207]);class ae{constructor(Jb,Wc){this.lm=Jb;this.Szb=(this.Jda=Wc)&&Jb!==Wc;this.Szb||(this.Jda=void 0)}Lzb(){return!!this.Jda}get rjk(){return this.lm.kc}get M3p(){return this.Jda.kc}clone(){return new ae(this.lm.clone(),this.Szb?this.Jda.clone():void 0)}Nzc(){this.lm.Nzc();this.Szb&&this.Jda.Nzc()}isValid(){return 0<=this.lm.P3.cp&&(!this.Szb||0<=this.Jda.P3.cp)}getData(){const Jb=
this.lm.P3.a$b;let Wc=null,Md=null,Mb=null;return!Jb||this.Szb&&(Wc=this.Jda.kc,Md=this.Jda.Uza,Mb=this.Jda.P3.a$b,!Mb)?null:new Xc.a(0,this.rjk,this.lm.Uza,Jb,Wc,Md,Mb,0,this.lm.shapeId)}static pTb(Jb,Wc,Md,Mb,pe){if(!Wc)return null;const td=new Bd(Wc,parseInt(Jb.$3a),Jb.blb,Jb.cY,Md,Mb,pe,Jb.shapeId);let Xd;ya.AFrameworkApplication.J&&ya.AFrameworkApplication.J.getBooleanFeatureGate("Microsoft.Office.WordOnline.IsPresenceSelectionRangeEnabled",!1)&&(ya.AFrameworkApplication.R_||ya.AFrameworkApplication.J.getBooleanFeatureGate("Microsoft.Office.Shared.IsLiveMeetingSessionOverrideEnabled",
!1))&&!ya.AFrameworkApplication.Kya&&!ya.AFrameworkApplication.J.getBooleanFeatureGate("Microsoft.Office.Shared.IsLiveMeetingPresenterOverrideEnabled",!1)&&Jb.Oza&&Jb.pGb&&Jb.A3&&(Xd=new Bd(Wc,parseInt(Jb.Oza),Jb.pGb,Jb.A3,Md,Mb,pe,Jb.shapeId));return new ae(td,Xd)}}(0,ja.a)(ae,"WordPresenceSelection",null,[208,207,1804]);class qe{constructor(Jb,Wc,Md){this.H5a=this.U_=this.YRc=!1;this.eqb=Jb;this.ew=Md;this.user=Wc}get selection(){return this.ew}get nyc(){return this.YRc}set nyc(Jb){(this.YRc=Jb)&&
this.selection.Nzc()}GRf(){const Jb=uc.instance.lPm();return new Wi(this.eqb,this.user.clientId,1,0,this.selection?this.selection.getData():null,new Ai(this.user.localCobaltSessionId,this.user.q0c,this.user.chatThreadDiscoveryUri,this.user.inChat,this.user.capabilities.capabilities,this.user.email,this.user.userName,this.user.isAnonymous,this.user.presenceStatus,this.user.dssLineageId),void 0,void 0,void 0,void 0,void 0,void 0,void 0,Jb)}AEi(){return this.user.clientId+(this.selection?this.selection.lm.paragraphId.toString():
ii.a.nil.toString())}isValid(){const Jb=!!this.user&&this.user.isValid(),Wc=!this.selection||this.selection.isValid();return Jb&&Wc}clone(){const Jb=new qe;Jb.eqb=this.eqb;Jb.YRc=this.YRc;Jb.user=this.user?this.user.clone():null;Jb.ew=this.selection?this.selection.clone():null;Jb.U_=this.U_;Jb.H5a=this.H5a;return Jb}static ewf(Jb,Wc,Md,Mb,pe){if(!Jb||!Wc)return null;if(Jb.operationType)return O.ULS.sendTraceTag(7685324,302,15,"Presence packet is of unexpected operationType {0}",Jb.operationType),
null;let td;td=null!=Jb.dta?rc.Pei(Jb.clientId,Jb.dta.UserName,Jb.dta.Capabilities,Jb.dta.LocalCobaltSessionId,Jb.dta.SkypeChatThreadId,Jb.dta.Email,Jb.client,Jb.dta.ChatThreadDiscoveryUri,Jb.dta.InChat,!1,Jb.dta.IsAnonymous,Jb.dta.PresenceStatus,Jb.dta.DssLineageId):rc.Pei(Jb.clientId,null,0,void 0,void 0,void 0,Jb.client);return new qe(Jb.packetId,td,ae.pTb(Jb.IZ,Wc,Md,Mb,pe))}}(0,ja.a)(qe,"WordPresenceInfo",null,[206,207]);class tf extends yc{constructor(Jb,Wc,Md,Mb,pe,td,Xd,jh,Th,he,Id,Xk,mh,
Rl,rk){super(Jb,td,Rl,Wc);this.$jg=(nf,Pf)=>{"emergencyView"!==Pf&&"connected"!==Pf||this.Eqd()};this.uAk=Md;this.BWk=Mb;this.KUk=pe;this.Ha=Xd;tf.vz=jh;this.jP=Th;this.Ic=he;this.Spb=Id;this.Rff=Xk;this.xta=mh;rk.execute(nf=>{this.$Sc=nf;this.$Sc.PVh(this.$jg)})}aRg(Jb){this.xta.zaj(Jb.CommandValueId);return super.aRg(Jb)}jOn(Jb){let Wc;({lqg:Wc}=this.t4f(Jb)).returnValue&&(this.BWk(Wc.selection.lm.paragraphId,Wc.selection.lm.P3.cp),ya.AFrameworkApplication.J.$("WordEditorMoveIpToUserLocationIsEnabled")&&
(Jb=tf.ZYm(Wc),null!=Jb?(O.ULS.sendTraceTag(20764574,325,50,"Attempting to move IP to the editing location of the selected user"),this.Ha.HOa(Jb),se.FocusManager.OY()&&se.FocusManager.instance().Pf(Zb.a.kn)):O.ULS.sendTraceTag(20764575,325,50,"IP will not be moved since the selection is either null or undefined")),Jb=new Za.a(2,1,0,()=>{this.ga.Za(761503246,2,Wc)}),Cc.TaskManager.instance.vb(Jb))}bKi(Jb){return Jb?(Jb=qe.ewf(re(Jb),this.jP,this.Ic,this.Spb,this.Rff.instance))&&Jb.isValid()&&Jb.selection?
Jb:null:null}Ovl(Jb){return this.iHn(Jb)?this.ewl(Jb)?!0:(O.ULS.sendTraceTag(41236613,325,50,"Cannot jump to user location because paragraph has not been loaded yet"),!1):(O.ULS.sendTraceTag(41236612,325,50,"Cannot jump to user location because presence is not valid"),!1)}iHn(Jb){return!!this.bKi(Jb)}t4f(Jb){Jb=this.bKi(Jb);return{returnValue:!!Jb,lqg:Jb}}ewl(Jb){let Wc;return({lqg:Wc}=this.t4f(Jb)).returnValue?this.uAk(Wc.selection.lm.paragraphId,Wc.selection.lm.P3.cp):!1}Tsm(){if(!this.wH||"emergencyView"===
this.$Sc?.$qe)return[];const Jb=[];for(const Wc of this.wH.rwb())Wc.userName?Jb.push(Wc):O.ULS.sendTraceTag(592229832,304,15,"The looked up RTC User has no name");return Jb}qLl(Jb){let Wc;return({lqg:Wc}=this.t4f(Jb)).returnValue&&Wc.user&&Wc.user.presenceStatus&&"0"!==Wc.user.presenceStatus?String.format(WacWordeditorStrings.PresenceStatusOnPage,Wc.user.presenceStatus):CommonUiStrings.PeoplesWellUserStatusLocationUnknown}wNo(){this.KUk(this.settings.id)}static createInstance(Jb,Wc,Md,Mb,pe,td,Xd,
jh){const Th=ec.a.ua().Ea,he=ya.AFrameworkApplication.oa,Id=Kc.a.instance,Xk=(0,oa.a)(jd);return new tf(Jb,Wc,mh=>Th.Mb.Sf?Th.Mb.Upf(mh,!0):!1,(mh,Rl)=>{Th.Mb.Sf&&Th.Mb.c6b(mh,Rl,!0,!0,!1,!1,Wd.a.uvo)},()=>{dd.a.lB.JH.Ryd()},he,Id,Th,Md,Mb,pe,td,Xk,Xd,jh)}static ZYm(Jb){const Wc=tf.vz.nc.ic.Ra(Jb.selection.lm.paragraphId);if(null==Wc)return O.ULS.sendTraceTag(20764576,325,15,"The node could not be obtained"),null;if(!ud.a.gb(Wc))return O.ULS.sendTraceTag(20764577,325,15,"The obtained node is not a paragraph node"),
null;Jb=Tc.a.fc(Wc,Jb.selection.lm.P3.cp);return new Ed.a([Jb],!0)}}tf.vz=null;(0,ja.a)(tf,"WordEditorPeoplesWell",yc,[]);class ng{constructor(){this.py=()=>{ya.AFrameworkApplication.pyj?ng.AAa.vF().continueWith(this.Gnd):O.ULS.sendTraceTag(23196872,325,50,"PeoplesWell control is explicitly disabled. Skipping initialization attempt")};this.Gnd=()=>{ng.Di=ng.AAa.vF().result;if(ng.Di){var Jb=()=>{const Wc=ec.a.ua().Ea;return Wc?Wc.nc?Wc.nc.ic:(O.ULS.sendTraceTag(23196876,325,15,"ActivePage is null"),
null):(O.ULS.sendTraceTag(23196875,325,15,"Workspace is null"),null)};Ic.a.mGa().continueWith(()=>{const Wc=Ic.a.mGa().result.Rk,Md=fd.a.fTm(ya.AFrameworkApplication.Yt,ya.AFrameworkApplication.Yt,ya.AFrameworkApplication.Yt,ya.AFrameworkApplication.Yt),Mb=ng.Di.l4o,pe=sc.createInstance(Md,Wc,td=>Mb.VXb(td),td=>Mb.gQa(td),ya.AFrameworkApplication.J.$("WordEditorPresenceDedupeMultipleCoauthorInstances"));pc.a.instance.ia("RealtimePresenceUI.WordEditorPeoplesWell",()=>tf.createInstance(pe,ha.a.Xs((0,oa.f)(M.a)),
(0,oa.h)(Db.a),(0,oa.h)(ob.a),Jb,(0,oa.f)(ac),(0,oa.a)($b.a),pc.a.instance.Rc("WordEditor.WordEditorOfflineManagerV3"))).as("Common.IPeoplesWell").fa();ng._instance=(0,oa.a)(yb);ng._instance.YQo();O.ULS.sendTraceTag(23196877,325,50,"PeoplesWellControl is fully initialized")})}else O.ULS.sendTraceTag(23196873,325,15,"Can't initialize the PeoplesWell control because can't get a handle to RtcProxy")}}get name(){return"WordEditor.PeoplesWellControl"}configure(){}init(){ya.AFrameworkApplication.J.gm(this.py)}dispose(){ng._instance&&
(ng._instance.dispose(),ng._instance=null)}static get AAa(){return null!=ng.M$g?ng.M$g:ng.M$g=(0,oa.a)(tb)}}ng._instance=null;ng.Di=null;(0,ja.a)(ng,"WordEditorPeoplesWellControlPackage",null,[0,1]);const $f=(0,oa.b)("Common.App.Presence.AwayManager");var bj=v(20105),Yi=v(1369);const hh=(0,oa.b)("Common.IPresenceConverter"),kh=(0,oa.d)(hh),im=(0,oa.b)("Common.IPresenceUser"),eg=(0,oa.d)(im);var Zi=v(51046),jc=v(61157);const Nb=(0,oa.d)(ac);var bb=v(22876),Hg=v(25370);const Tf=(0,oa.b)("Box4.Presence.IMyPresenceUser"),
rg=(0,oa.d)(Tf);var ol=v(68561),$l=v(88848);const ih=(0,oa.b)("Box4.Presence.MyPresenceUser"),zj=(0,oa.d)(ih);var lg=v(43721);const gj=(0,oa.d)(M.a),$g=(0,oa.d)($f),Rg=(0,oa.b)("WordEditor.Presence.WordPresenceUpdateMonitor"),Ae=(0,oa.d)(Rg),Ak=(0,oa.b)("WordEditor.Presence.WordRtcProxyProvider"),Wl=(0,oa.d)(Ak);var wl=v(36130),Zm=v(98070);class Dk{constructor(Jb,Wc,Md,Mb,pe,td,Xd,jh,Th=!1){this.zmb=null;this.RVe=!0;this.M7e=this.rk=this.POe=null;this.na=new ub.a;this.omn=()=>{this.LR.result&&this.UGh.result&&
(this.rk=this.LR.result,this.M7e=this.UGh.result,this.rk.gEa(this.eY),this.POe=new Za.a(2,2,this.Egh,this.PRp,88),Dk.pb.vb(this.POe))};this.eY=(he,Id)=>{(this.RVe||this.nKo(Id.fma))&&Dk.pb.E7(this.POe,0)};this.PRp=he=>{var Id=this.rk.mqc();if(Id){var Xk=new Date,mh=!1;if(this.RVe){this.zmb=Id;this.RVe=!1;var Rl=this.zmb;for(var rk in Rl){Id=rk;var nf=Rl[rk];nf.fxc<Xk&&(Xk=nf.fxc);2===nf.status&&(mh=!0,this.M7e.vrd(Id))}mh&&this.xEj();Dk.pb.E7(he,this.ZHi(Xk))}else{nf=new ea.a;rk=!1;var Pf=this.zmb;
for(Rl in Pf){Pf=Rl;if(!(Pf in this.zmb)||this.hXa.clientId===Pf)continue;var bi=this.zmb[Pf];const Bi=Id[Pf];if(bi&&Bi){bi=bi.status;const Z=Bi.status;2===bi&&1===Z?(nf.add(Pf),O.ULS.sendTraceTag(38052609,392,50,Pf+" returned from away")):1===bi&&2===Z&&(rk=mh=!0,this.M7e.vrd(Pf),O.ULS.sendTraceTag(38052610,392,50,Pf+" went away"));1===Z&&Bi.fxc<Xk&&(Xk=Bi.fxc)}}this.zmb=Id;Dk.pb.E7(he,this.ZHi(Xk));(0<nf.count||mh)&&this.xEj();0<nf.count&&!this.XUk?(he=this.Dxm(nf),this.HIp(he)):he=new ea.a;(rk||
0<he.count)&&this.OTk(Re.a.W0d,2)}}};this.hXa=Jb;this.LR=Wc;this.UGh=Md;this.kUc=Mb;this.Egh=td;Dk.pb=pe;this.OTk=Xd;this.Uca=jh;this.XUk=Th;la.Task.WAA(Wc,Md).continueWith(this.omn)}Hcl(Jb){this.na.addHandler("u",Jb)}xEj(){this.na.raiseEvent("u",null,this)}nKo(Jb){for(const Md in Jb){var Wc=this.kUc.Bce({key:Md,value:Jb[Md]});if(Wc&&Wc.clientId&&(Wc=Wc.clientId.toLowerCase(),(Wc=this.zmb[Wc]||this.zmb[Wc.toUpperCase()])&&2===Wc.status))return!0}return!1}HIp(Jb){if(Jb.count)for(const Wc of Jb)Jb=
this.Uca.hS(String.format((0,sd.a)("EditorsToastArriving"),Wc),!1),Jb.image=5,Jb.sV="CoAuth_AuthorStatus_16x16x32",this.Uca.Uu(Jb)}Dxm(Jb){const Wc=this.rk.qwb(),Md=new ea.a;for(const Mb in Wc){const pe={key:Mb,value:Wc[Mb]};if(Jb.contains(pe.key)){const td=this.kUc.Bce(pe);td&&(Md.add(td.userName),Jb.remove(pe.key))}}Md.count||O.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");return Md}ZHi(Jb){const Wc=new Date;return Math.max(Jb.getTime()+this.Egh-Wc.getTime(),0)}}Dk.pb=null;
(0,ja.a)(Dk,"AwayManager",null,[]);var Dl=v(52325);class nm{constructor(Jb=0){this.updates=Jb}get qWf(){return 0!==this.updates}q1a(Jb){return!!(this.updates&Jb)}akb(Jb){this.updates|=Jb}toString(){if(this.q1a(0))return"none";const Jb=new ea.a;this.q1a(1)&&Jb.add("user(s) joined");this.q1a(2)&&Jb.add("user(s) disconnected");this.q1a(4)&&Jb.add("user(s) updated");return Jb.toArray().join(", ")}}(0,ja.a)(nm,"UserUpdateEvent",null,[]);var Ii=v(35916);class Eb{constructor(Jb,Wc,Md,Mb,pe=null){this.na=
new ub.a;this.ZO=this.Di=null;this.JCh=this.mDh=this.xm=!1;this.Ks=new $c.a;this.uQg=()=>{if(this.Di){var td=!1,Xd=this.Di.mqc();for(const Th in Xd){var jh=Xd[Th];const he=Th;this.users.fb(he)&&(jh=this.p9j(jh),td=this.users.K(he).MSb!==jh||td,this.users.K(he).MSb=jh)}td&&(td=new nm(4),this.bBe(td))}};this.ttj=(td,Xd)=>{2===Xd.newState&&(td=this.kcg(this.Di.qwb()),td.qWf&&this.bBe(td))};this.I2b=(td,Xd)=>{const jh=new nm;td=this.ZO.q8c();O.ULS.sendTraceTag(561894485,302,50,"editorstablemanager coauthors count is {0}, editorstableupdate old count of coauthors is {1}, editorstableupdate new count of coauthors is {2}",
td.length,Xd.sdo,Xd.kmj);const Th=new $c.a;for(var he of td){td=he.Id;const Id=this.nhi(td);this.tQg(jh,Id);Th.W(td,Id)}Xd.$7f?.forEach(Id=>{O.ULS.sendTraceTag(562415168,302,50,"{0} users in coauth gallery. User leaving the editor table: {1}",this.users.count,Id.Id);let Xk;({value:Xk}=this.users.qc(Id.Id)).returnValue?Xk?(this.users.remove(Id.Id),jh.akb(2),Th.W(Id.Id,Xk)):O.ULS.sendTraceTag(561287839,302,50,"Empty entry in PIP users: {0}",Id.Id):O.ULS.sendTraceTag(570426140,302,15,"Disconnected user not found: {0}",
Id.Id)});Xd=this.Di.qwb();for(const Id in Xd)he=this.kUc.Bce({key:Id,value:Xd[Id]}),Th.W(he.clientId,he);for(const Id of this.users)Th.fb(Id.value.clientId)||(O.ULS.sendTraceTag(561287840,302,15,"Coauth Gallery contains user not in Editors Table or RTC presence: {0}",Id.key),this.users.remove(Id.key),jh.akb(2));jh.qWf&&this.bBe(jh)};this.vtj=(td,Xd)=>{td=this.kcg(Xd.fma);for(const jh of Xd.x4c)this.users.fb(jh)&&(td.akb(2),this.users.K(jh).MSb=2);td.qWf&&this.bBe(td)};Jb.continueWith(()=>{this.Di=
Jb.result;this.Di.gEa(this.vtj);this.Di.D5(this.ttj);this.uQg(null,null)});Wc.continueWith(()=>{this.ZO=Wc.result;this.ZO.Lab(this.I2b)});pe&&pe.continueWith(()=>{pe.result.Hcl(this.uQg);this.uQg(null,null)});this.xMa=Md;this.kUc=Mb}get users(){return this.Ks}rjc(Jb){this.na.addHandler("UU",Jb)}Iwg(Jb){this.na.removeHandler("UU",Jb)}p9j(Jb){return 1===Jb.status?0:1}rwb(){this.users.count||(this.mDh||(Ii.b(42316242,302,50,"No users available at PeopleInfoProvider.GetAllUsers call"),this.mDh=!0),this.xyo());
const Jb=[];for(const Wc of this.users)Array.add(Jb,Wc.value);return Jb}xyo(){if(this.Di){var Jb=this.Di.qwb();this.kcg(Jb)}if(this.ZO){Jb=this.ZO.q8c();for(const Wc of Jb)Wc.Id&&(Jb=this.nhi(Wc.Id),this.tQg(new nm,Jb))}}hag(Jb){({value:Jb}=this.users.qc(Jb));return Jb}dispose(){this.xm||(this.Di&&(this.Di.S4a(this.vtj),this.Di.LIa(this.ttj)),this.ZO&&this.ZO.ZJj(this.I2b),this.xm=!0)}kcg(Jb){const Wc=new nm;if(!Jb)return Wc;for(const Mb in Jb){var Md=this.kUc.Bce({key:Mb,value:Jb[Mb]});Md&&(Md=Md.clone(),
this.tQg(Wc,Md))}return Wc}tQg(Jb,Wc){if(Wc){var Md=Wc.clientId,Mb=this.G1o(Wc);({value:Wc}=this.users.qc(Md)).returnValue?Wc.equals(Mb)||(Jb.akb(4),this.users.W(Md,Mb)):(O.ULS.sendTraceTag(562415169,302,50,"{0} users in coauth gallery. User joining: {1}",this.users.count,Md),Jb.akb(1),this.users.W(Md,Mb))}}nhi(Jb){return this.users.fb(Jb)?this.users.K(Jb):hb.a.zQl(Jb)}G1o(Jb){if(!Jb||!Jb.clientId||!this.ZO)return Jb;const Wc=Jb.clone();Wc.MSb=this.Cxm(Jb);if(Jb=this.ZO.m$d(Wc.clientId))Wc.isReadOnly=
Wc.isReadOnly||Jb.IsReadOnly?!0:!1,Wc.userName=this.F1o(Wc,Jb),Wc.capabilities=this.t6n(Wc.capabilities,Jb.Capabilities),Wc.email=Wc.email||Jb.SIPAddress||Jb.EmailAddress,Jb.JoinCoauthTime&&(Wc.Q2a=Jb.JoinCoauthTime);Wc.color=this.xMa.UXb(new Dl.a(Wc.email,void 0,Wc.userName,void 0,Wc.isAnonymous,Wc.clientId),3);return Wc}Cxm(Jb){if(!this.Di)return 2;if(Jb&&Jb.clientId){const Wc=this.Di.mqc();if(Jb.clientId in Wc)return this.p9j(Wc[Jb.clientId])}return 2}UGl(Jb,Wc){Wc.Name&&Jb.userName&&Wc.Name!==
Jb.userName&&!this.JCh&&(this.JCh=!0,Ii.b(42316243,302,15,"User names in EditorsTable and RTC don't match"))}t6n(Jb,Wc){Jb=Jb||new Bb.a;Wc&&(Wc.SupportsRealtimeChannel&&Jb.akb(1),Wc.SupportsRename&&Jb.akb(2),Wc.SupportsChat&&Jb.akb(4));return Jb}F1o(Jb,Wc){this.UGl(Jb,Wc);return Wc.Name||Jb.userName||(Jb.isAnonymous||Wc.IsAnonymous?(0,sd.a)("GuestUserName"):null)}bBe(Jb){O.ULS.sendTraceTag(42316245,302,100,"PeopleInfoProvider update detected: {0}",Jb.toString());this.na.raiseEvent("UU")}}(0,ja.a)(Eb,
"PeopleInfoProvider",null,[1026,33]);var Ec;(function(Jb){Jb[Jb.e$n=0]="multipleBrowsersImageClassName";Jb[Jb.svo=1]="peopleImageClassName";Jb[Jb.tvo=4]="peopleImageClusterPath";Jb[Jb.d$n=5]="multipleBrowserImageClusterPath";Jb[Jb.bZb=6]="imageDimension";Jb[Jb.rtl=8]="rtl";Jb[Jb.ZCb=9]="pointerInputManager";Jb[Jb.L5=10]="clickInputManager";Jb[Jb.vertical=11]="vertical";Jb[Jb.zIndex=12]="zIndex";Jb[Jb.eub=13]="contextMenuInputManager";Jb[Jb.gFq=14]="imageDomElement";Jb[Jb.Mfu=15]="useIdleTooltip";
Jb[Jb.v1p=16]="viewportBoundsCallback";Jb[Jb.zAq=17]="flipHorizontalDirection";Jb[Jb.qAq=18]="fixRemoveFadeOutElementCrash";Jb[Jb.zjn=19]="ignoreEventOnExpandedTooltip";Jb[Jb.Kun=20]="ipWidthAdjustForFlyout"})(Ec||(Ec={}));(0,ja.b)("PresenceTooltipSettingKeys",Ec);class md{constructor(){this.YO={}}get(Jb,Wc=null){Jb=Ec[Jb];return"number"===typeof Wc?(Wc=this.YO[Jb])?Number.parseInvariant(Wc.toString()):0:this.YO[Jb]}add(Jb,Wc){this.YO[Ec[Jb]]=Wc}RYa(Jb,Wc){Ec[Jb]in this.YO||(this.YO[Ec[Jb]]=Wc)}remove(Jb){delete this.YO[Ec[Jb]]}}
(0,ja.a)(md,"PresenceTooltipSettings",null,[]);class Jd extends ub.a{constructor(Jb){super();this._element=null;this.element=Jb}get element(){return this._element}set element(Jb){this._element=Jb}get visible(){return"visible"===this.element.style.visibility}set visible(Jb){this.element.style.visibility=Jb?"visible":"hidden"}get rtl(){return"rtl"===this.element.dir.toLowerCase()}set rtl(Jb){this.element.dir=Jb?"rtl":"ltr"}get zIndex(){return this.element.style.zIndex}set zIndex(Jb){this.element.style.zIndex=
String(Jb)}dispose(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element);this.element=null;super.dispose()}createElement(Jb){return this.element.ownerDocument.createElement(Jb)}ssa(){return!0}static Cgi(Jb){return"prControl"+(Jb?"Rtl":"")}}(0,ja.a)(Jd,"BasePresenceControl",ub.a,[33,1002]);class Ge extends Sys.EventArgs{constructor(Jb,Wc){super();this.type=Jb;this.Fp=Wc}}Ge.J_="InteractivityChanged";(0,ja.a)(Ge,"InteractivityChangedEventArgs",Sys.EventArgs,[]);
class Df{static xBm(Jb){return Df.yBm(Jb)}static yBm(Jb){const Wc=document.createElementNS(Df.YSg,"svg");Wc.setAttribute("viewBox",String.format(Df.uYl,Df.Vhk,Df.Uhk));Wc.appendChild(Df.y0m(Jb));return Wc}static y0m(Jb){const Wc=Df.Vhk/Jb,Md=2*Wc,Mb=Df.Uhk/2;Jb=(Jb-12-8)*Wc/2;const pe=document.createElementNS(Df.YSg,"g");Sys.UI.DomElement.addCssClass(pe,Df.tYl);for(let td=1;3>=td;td++)pe.appendChild(Df.hxm(td,Md,Jb+(6*td-2)*Wc,Mb));return pe}static hxm(Jb,Wc,Md,Mb){const pe=document.createElementNS(Df.YSg,
"circle");Sys.UI.DomElement.addCssClass(pe,String.format("{0}-{1}",Df.UAl,Jb));pe.setAttribute("cx",String.format("{0}",Md));pe.setAttribute("cy",String.format("{0}",Mb));pe.setAttribute("r",String.format("{0}",Wc));return pe}}Df.YSg="http://www.w3.org/2000/svg";Df.tYl="prDancingDots";Df.UAl="prAnimateCircle";Df.uYl="0 0 {0} {1}";Df.Uhk=40;Df.Vhk=120;(0,ja.a)(Df,"ModernPresenceTooltipDancingDots",null,[]);var Bg=v(61913),Xb=v(9376),li=v(7046),sf=v(15708),bh=v(58685),pi=v(40848);class eb extends Jd{constructor(Jb,
Wc){super(Jb);this.cQh=this.nob=this.DQe=this._img=this.XE=this.oz=this.Hg=null;this.UXa=Wc.get(8,!1);this.Vnb=Wc.get(6,0);this.d1k=Wc.get(15,!1);this.Zd=Wc;this.Moh=0;this.element=Jb;this.element.className=eb.lHf;this._span=document.createElement("span");this.element.appendChild(this._span);this.FEk=Df.xBm(Wc.get(6,0));this.BC(Wc);this._state=5}aRb(Jb){this.addHandler(Ge.J_,Jb)}b5b(Jb){this.removeHandler(Ge.J_,Jb)}get user(){return this.cQh}get state(){return this._state}dispose(){this.element&&
(this.Hg.Qb(li.a.click,this.element,(0,ed.a)(this,this.onClick,"onClick")),this.Hg.Qb(li.a.mJ,this.element,(0,ed.a)(this,this.ssa,"stopPropagationAndPreventDefaultBehavior")),this.oz.Qb(li.a.Rv,this.element,(0,ed.a)(this,this.KA,"onPointerDown")),this.oz.Qb(li.a.KJ,this.element,(0,ed.a)(this,this.GJ,"onPointerOut")),this.oz.Qb(li.a.nO,this.element,(0,ed.a)(this,this.KV,"onPointerOver")),this.XE.Qb(this.element,(0,ed.a)(this,this.ssa,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}BC(Jb){this.Hg=
Jb.get(10);this.Hg.Ua(li.a.click,this.element,(0,ed.a)(this,this.onClick,"onClick"));this.Hg.Ua(li.a.mJ,this.element,(0,ed.a)(this,this.ssa,"stopPropagationAndPreventDefaultBehavior"));this.oz=Jb.get(9);this.oz.Ua(li.a.nO,this.element,(0,ed.a)(this,this.KV,"onPointerOver"));this.oz.Ua(li.a.KJ,this.element,(0,ed.a)(this,this.GJ,"onPointerOut"));this.oz.Ua(li.a.Rv,this.element,(0,ed.a)(this,this.KA,"onPointerDown"));this.XE=Jb.get(13);this.XE.Ua(this.element,(0,ed.a)(this,this.ssa,"stopPropagationAndPreventDefaultBehavior"))}hide(Jb=
null,Wc=0,Md=0){this.d1k&&Jb?this.yup(Jb,Wc,Md):(3===this.state&&this.DIj(),this.visible=!1,this._state=5)}yup(Jb,Wc,Md=0){this.show(Jb,Wc,15,4,void 0,Md)}V_j(Jb,Wc,Md=!1,Mb=!1,pe=!1,td=0){this.show(Jb,Wc,20,Md?2:Mb?1:0,pe,td)}Stp(Jb,Wc,Md,Mb=!1,pe=0){this.show(Jb,Wc,Md+20,3,Mb,pe)}show(Jb,Wc,Md,Mb=3,pe=!1,td=0){!Jb||Mb===this.state&&this.Ndn(Wc,Md)||(this.B4k(Mb,pe,td),this.$na(Jb,Mb,td),this._state=Mb,4===td||0===td&&!this.UXa?this.element.style.left=Wc+"px":this.element.style.right=Wc+"px",this.element.style.top=
Md+"px",this.visible=!0)}$na(Jb,Wc,Md){this.cQh=Jb;pi.a.HH(this._span);bh.a.BCl(this._span);this._span.id="fly_"+Jb.clientId;this._span.style.backgroundColor=Jb.color;4!==Wc?(this._span.style.height=this.Vnb+"px",this._span.style.lineHeight=this.Vnb+"px",bh.a.P6b(this._span,"border-radius",this.Vnb+"px")):4===Md||0===Md&&!this.UXa?this._span.style.left="0px":this._span.style.right="0px";2!==Wc&&(4===Wc?pi.a.qL(this._span,""):1===Wc?this._span.appendChild(this.FEk):(this._span.setAttribute("dir","auto"),
Md=zc.a.SJm(Jb.userName),(!Jb.isAnonymous||ya.AFrameworkApplication.J.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1))&&Md||0!==Wc?(Jb=Jb.userName,0===Wc&&(Jb=Md,bh.a.P6b(this._span,"text-align","center")),pi.a.qL(this._span,Jb)):(this._img||(this._img=this.JNl()),this._span.appendChild(this._img),bh.a.P6b(this._span,"text-align","start"))))}onClick(Jb){if(0===this.state)return this.raiseEvent(Ge.J_,new Ge(1,Jb)),!0;3===this.state&&O.ULS.sendTraceTag(50436114,
302,50,"User clicked on presence pill.");return!1}GJ(Jb){3===this.state&&this.raiseEvent(Ge.J_,new Ge(3,Jb));return!1}KV(Jb){3!==Jb.Zf&&this.raiseEvent(Ge.J_,new Ge(2,Jb));return!1}KA(Jb){if(3!==Jb.Zf)return!0;this.raiseEvent(Ge.J_,new Ge(4,Jb));return!1}JNl(){const Jb=document.createElement("img");Jb.src=Bg.a.Ulc("doughperson_white_glyph.svg");Jb.setAttribute("Unselectable","on");sf.a.ju(Jb,sf.a.Gi,sf.a.jF);return Xb.a(this.Vnb,this.Vnb,null,null,eb.Mmm,"",!1,"",this.element.ownerDocument,Jb)}B4k(Jb,
Wc=!1,Md=0){if(!this.Wed(this.state)||!this.Wed(Jb))switch(Sys.UI.DomElement.removeCssClass(this.element,this.DQe),this.state){case 4:3===Jb?this.Bab(eb.mHf,eb.lvi):this.Wed(Jb)&&this.Bab(eb.kHf,eb.lvi);break;case 3:4===Jb?this.Bab(eb.pHf,eb.kvi):this.Wed(Jb)&&(Wc&&this.DIj(),this.Bab(eb.kHf,eb.kvi,Wc?eb.Lmm:""));break;case 0:case 1:case 2:4===Jb?this.Bab(eb.pHf,eb.nHf):3===Jb&&(Wc&&this.b6k(),this.Bab(eb.mHf,eb.nHf,Wc?eb.mvi:"",3===Md?eb.Pmm:eb.Nmm));break;default:4===Jb?this.Bab(eb.pHf):3===Jb?
this.Bab(eb.mHf):this.Wed(Jb)&&this.Bab(eb.kHf)}}Bab(...Jb){this.DQe=Jb.join(" ");Sys.UI.DomElement.addCssClass(this.element,this.DQe)}b6k(){this.Moh=window.setTimeout(()=>{this.element&&(this.nob=this.element.cloneNode(!0),this.element.parentNode.appendChild(this.nob),this.element.style.zIndex="2",this.nob.style.zIndex="1")},300)}DIj(){window.clearTimeout(this.Moh);this.nob&&(Sys.UI.DomElement.removeCssClass(this.nob,eb.nHf+" "+eb.mvi),Sys.UI.DomElement.addCssClass(this.nob,eb.Kmm),la.Task.delay(300).continueWith(()=>
{this.element&&this.element.parentNode===this.nob.parentNode&&this.element.parentNode.removeChild(this.nob)}),bh.a.dCc(this.element,"z-index"))}Wed(Jb){return 0===Jb||1===Jb||2===Jb}Ndn(Jb,Wc){const Md=bh.a.K3(this.element.style.top);return bh.a.K3(this.element.style.left)===Jb&&Md===Wc}Kxg(Jb){3===Jb&&bh.a.Dia(this.element,"left")?(Jb=bh.a.K3(this.element.style.left),bh.a.dCc(this.element,"left"),this.element.style.right=-1*Jb+"px"):4===Jb&&bh.a.Dia(this.element,"right")&&(Jb=bh.a.K3(this.element.style.right),
bh.a.dCc(this.element,"right"),this.element.style.left=-1*Jb+"px")}}eb.lHf="prModernFlyout UIFont";eb.pHf="flyoutIdle";eb.mHf="flyoutExpanded";eb.kHf="flyoutCollapsed";eb.lvi="flyoutFromIdle";eb.kvi="flyoutFromExpanded";eb.nHf="flyoutFromCollapsed";eb.mvi="flyoutStacked";eb.Lmm="flyoutFromStacked";eb.Kmm="flyoutFadeOut";eb.Mmm="cui-img-cont-float cui-img-20by20";eb.Nmm="flyoutLtrDir";eb.Pmm="flyoutRtlDir";(0,ja.a)(eb,"ModernPresenceTooltipFlyoutControl",Jd,[]);class Rb{constructor(Jb,Wc,Md=2,Mb=4){this.offsetTop=
Jb;this.offsetLeft=Wc;this.Qhk=Md;this.kVi=Mb}}(0,ja.a)(Rb,"FlyoutsPositioningInfo",null,[]);var Fc=v(54952);class Bc{constructor(Jb=!1,Wc=!1){this.zm=Jb;this.ZVe=Wc}lLm(Jb,Wc,Md,Mb,pe){var td=pe.y;const Xd=pe.height;var jh=this.xvm(Mb);const Th=jh+Wc;Md=Jb*Md+2*(Jb-1);1===Jb||this.Evl(jh,Md,td,Xd)?Jb=new Rb(0,0,2):(Jb=this.RGf(Th,Md,td,Xd),Jb.offsetTop-=jh);this.ZVe?Wc=new Rb(0,0,void 0,this.zm?4:3):(Mb=this.wvm(Mb),jh=Math.max(0,pe.x),pe=pe.width,td=Mb+Wc,(Wc=this.Hvl(Mb,jh,pe))||(Wc=this.xlm(Mb,
td,jh,pe)));return new Rb(Jb.offsetTop,Wc.offsetLeft,Jb.Qhk,Wc.kVi)}xvm(Jb){return Fc.a.jKf(Jb)}wvm(Jb){return this.zm?Fc.a.uzi(Jb)-Fc.a.vzi(Jb):Fc.a.iKf(Jb)}Evl(Jb,Wc,Md,Mb){return Jb+Wc<=Md+Mb}RGf(Jb,Wc,Md,Mb){let pe=1,td=Math.max(Md,Jb-Wc);Wc>Jb-Md&&(pe=2,td=Wc<Mb?Mb-Wc:Md);return new Rb(td,0,pe)}Hvl(Jb,Wc,Md){const Mb=this.Fvl(Jb,Wc);Jb=this.Gvl(Jb,Wc,Md);if(Mb||Jb)return new Rb(0,0,void 0,this.zm?Mb?3:4:Jb?4:3)}Gvl(Jb,Wc,Md){return Jb+150<=Wc+Md}Fvl(Jb,Wc){return Wc<=Jb-150}xlm(Jb,Wc,Md,Mb){Mb-
Wc>=Jb-Md?Jb=4:(Wc=Jb,Jb=3);return new Rb(0,Wc,void 0,Jb)}}(0,ja.a)(Bc,"ModernPresenceTooltipPositioner",null,[]);class Nd{constructor(Jb,Wc,Md,Mb,pe,td,Xd){this.oha=Jb;this._parent=Wc;this.tjh=Md;this.nBk=Mb;this.DJk=pe;this.Ghc=td;this.UXa=Xd;this._element=document.createElement("div");this.element.className="prTouchTarget"}get element(){return this._element}update(Jb,Wc){if(3!==Jb)if(5!==Jb&&this.oha&&this.oha.length){if(4===Jb){var Md=this.DJk;var Mb=(this.Ghc-Md)/2;this.element.style.height=
this.Ghc+"px";this.element.style.width=this.Ghc+"px";Jb=bh.a.K3(this.oha[0].element.style.top);Wc=bh.a.K3(this.UXa?this.oha[0].element.style.right:this.oha[0].element.style.left)}else Md=this.tjh,Mb=(this.Ghc-Md)/2,this.element.style.height=this.Ghc+"px",this.element.style.width=this.Ixm()+2*Mb+"px",Jb=bh.a.K3(this.oha[this.oha.length-1].element.style.top),Wc=this.Mul(this.oha[this.oha.length-1].element,Md,Wc);bh.a.P6b(this.element,"border-radius",this.Ghc+"px");this.element.style.top=Jb-Mb-Md+"px";
this.UXa?this.element.style.right=Wc-Mb+"px":this.element.style.left=Wc-Mb+"px";this.element.parentNode||this._parent.insertBefore(this.element,this._parent.firstChild)}else this.element.parentNode&&this.element.parentNode.removeChild(this.element)}Mul(Jb,Wc,Md){return this.UXa&&!Md?bh.a.K3(Jb.style.right):this.UXa||Md?this.UXa&&Md?-bh.a.K3(Jb.style.left)-Wc:-bh.a.K3(Jb.style.right)-Wc:bh.a.K3(Jb.style.left)}Ixm(){return this.oha&&this.oha.length?this.tjh+Math.min(this.oha.length-1,2)*this.nBk:0}}
(0,ja.a)(Nd,"ModernPresenceTooltipTarget",null,[]);var Ee=v(73357),df=v(24447);class dg extends Jd{constructor(Jb,Wc,Md){super(Jb);this.qgc=this.GWa=this.Qth=this.SKb=!1;this.Ks=[];this.L3a=(Mb,pe)=>{Mb=this.E8b;this.tol()||2!==pe.type&&(4!==pe.type||3===Mb)?4===pe.type&&3===Mb?(this.GWa&&(this.GWa=!1),this.ssf()):3!==pe.type||3!==Mb||this.SKb||(1<this.Bdb?(this.GWa=!0,la.Task.delay(250).continueWith(()=>{this.Mlc(!0);this.GWa=!1})):this.ssf()):(this.GWa&&(this.GWa=!1),3!==Mb&&(this.sri(),3===pe.Fp.Zf&&
this.ssf(2E3)));this.raiseEvent(Ge.J_,pe)};this.Bzc=Mb=>{3===Mb.Zf?this.L3a(this,new Ge(4,Mb)):Mb.eventName===li.a.nO?this.L3a(this,new Ge(2,Mb)):Mb.eventName===li.a.KJ&&this.L3a(this,new Ge(3,Mb));return!1};this.fJd={};this.Zd=Md;this.zm=Md.get(8,!1);this.ysh=Md.get(15,!1);this.wDk=Md.get(12,0);this.atb=Md.get(6,0);this.orb=Wc;this.wQh=Md.get(16);this.ZVe=Md.get(17,!1);this.GJk=Md.get(19,!1);this.DTk=Md.get(20,!1);this.LLd=0;this.yTk=new Bc(this.zm,this.ZVe);this.GJc=this.gCi();this.aOb=!1;this.R$b=
[];this.vPc=[];this.element.id=dg.gwb();this.element.className=Jd.Cgi(this.zm);this.Gcb&&(this.zIndex=this.Gcb);this.rtl=this.zm;this.kCg(Wc);this.Aca=this.createElement("div");this.Aca.className="prFlyoutContainer";this.element.appendChild(this.Aca);this.oha=[];this.Oob=new Nd(this.x$,this.element,this.atb,4,6,32,this.zm);this.oz=Md.get(9);this.oz.Ua(li.a.Rv,this.Oob.element,this.Bzc);this.oz.Ua(li.a.nO,this.Oob.element,this.Bzc);this.oz.Ua(li.a.KJ,this.Oob.element,this.Bzc)}get Nve(){return df.a.clone(this.Ks)}get x$(){return this.oha}get Gcb(){return this.wDk}get Bdb(){return this.x$?
this.x$.length:0}get E8b(){return 0<this.Bdb?this.x$[0].state:5}get F1f(){return 3===this.E8b&&!this.SKb}aRb(Jb){this.addHandler(Ge.J_,Jb)}b5b(Jb){this.removeHandler(Ge.J_,Jb)}dispose(){if(this.F1f)this.aOb=!0;else{if(this.x$)for(const Jb of this.x$)Jb.b5b(this.L3a),wl.a.aG(Jb);this.oha=null;this.oz.Qb(li.a.Rv,this.Oob.element,this.Bzc);this.oz.Qb(li.a.nO,this.Oob.element,this.Bzc);this.oz.Qb(li.a.KJ,this.Oob.element,this.Bzc);super.dispose()}}WEc(){this.Mlc();this.visible=!0}svd(){this.visible=!0;
this.sri();this.SKb=!0}sGg(){this.svd()}hide(){this.eJj();this.mfb();this.Oob.update(this.E8b,this.qgc)}$na(Jb){const Wc=this.E8b,Md=this.SKb;Jb.clientId||(Jb.clientId=(dg.RPc++).toString());if(Jb.clientId in this.fJd){var Mb=this.yVb(Jb.clientId);if(0<=Mb){Mb=this.Ks[Mb];if(Mb.color===Jb.color&&Mb.userName===Jb.userName)return;this.wjb(Jb.clientId)}}this.hide();Mb=new eb(this.createElement("div"),this.Zd);Mb.aRb(this.L3a);this.Aca.insertBefore(Mb.element,this.Aca.firstChild);this.fJd[Jb.clientId]=
Mb;Array.add(this.Ks,Jb);Array.add(this.x$,Mb);this.ufk(Wc,Md);this.visible=!0}wjb(Jb){if(this.F1f)Array.add(this.vPc,Jb);else{var Wc=this.E8b,Md=this.SKb;this.hide();this.urd(Jb);this.ufk(Wc,Md)}}Ykj(Jb){const Wc=this.yVb(Jb);if(!(0>=Wc)){var Md=this.Ks[Wc];Jb=this.fJd[Jb];Array.removeAt(this.Ks,Wc);Array.insert(this.Ks,0,Md);Array.removeAt(this.x$,Wc);Array.insert(this.x$,0,Jb);this.Aca.removeChild(Jb.element);this.Aca.appendChild(Jb.element);this.Mlc()}}ufk(Jb,Wc){0>=this.Ks.length?this.hide():
3===Jb&&Wc?this.svd():this.WEc()}lEf(Jb){if(this.F1f&&this.GJk)return!1;Jb=dg.$Qf(Jb);if(this.Aca!==Jb&&pi.a.agb(this.Aca,Jb))return!0;for(const Wc of this.x$)if(pi.a.agb(Wc.element,Jb))return!0;return!1}position(Jb,Wc){this.element.style.top=Wc+"px";this.element.style.left=Jb+"px"}Mlc(Jb=!1){if(!Jb||this.GWa){this.Qth&&this.EWj(!0);var Wc=Math.min(3,this.Bdb)-1;Jb=0;var Md=1,Mb=0;this.qgc&&(Jb=this.GJc,Md=-1,Mb=-this.atb);for(let pe=this.Bdb-1;pe>Wc;pe--)this.x$[pe].V_j(this.Ks[pe],-4*Wc*Md+Mb,!0,
!1,!0,Jb);for(;0<=Wc;Wc--)this.x$[Wc].V_j(this.Ks[Wc],-4*Wc*Md+Mb,0<Wc,Array.contains(this.R$b,this.Ks[Wc].clientId),Wc!==this.LLd,Jb);this.LLd=0;this.Oob.update(0,this.qgc);this.zIndex=this.Gcb;this.SKb=!1;this.eJj(0);this.aOb&&this.dispose()}}sri(){this.Qth&&this.EWj(!1);this.zIndex=this.Gcb+1;const {offsetX:Jb,offsetY:Wc,jVi:Md}=this.bgp();for(let Mb=0;Mb<this.Bdb;Mb++)this.x$[Mb].Stp(this.Ks[Mb],Jb,Wc+(this.atb+2)*Mb,Mb!==this.LLd,Md)}mfb(){let Jb=0,Wc=0;this.qgc&&(Jb=this.GJc,Wc=-6);for(let Md=
0;Md<this.Bdb;Md++)this.x$[Md].hide(this.Ks[Md],Wc,Jb);this.zIndex=this.Gcb;this.visible=this.SKb=!1;this.aOb&&this.dispose()}ssf(Jb=0){Jb?(this.GWa=!0,la.Task.delay(Jb).continueWith(()=>{this.ysh?this.Ifn():this.Mlc(!0);this.GWa=!1})):this.ysh?this.hide():this.Mlc()}Ifn(){this.GWa&&this.hide()}tol(){if(ya.AFrameworkApplication.qa&&ya.AFrameworkApplication.qa.ib.Uya&&Ee.c()){const Jb=appChrome.selectors.getShyState();return Jb.isActive&&0!==Jb.state}return!1}kCg(Jb){this.element.style.width=Jb+"px";
this.element.style.height=this.atb+"px"}urd(Jb){this.aTo(Jb);Jb=this.yVb(Jb);if(!(0>Jb)){var Wc=this.Ks[Jb];Array.removeAt(this.Ks,Jb);delete this.fJd[Wc.clientId];Wc=this.x$[Jb];this.Aca.removeChild(Wc.element);this.Zd.get(18,!1)&&Wc.b5b(this.L3a);Array.removeAt(this.x$,Jb);Wc.dispose()}}eJj(Jb=5){if(this.vPc.length){this.visible&&this.mfb();for(let Wc=0;Wc<this.vPc.length;Wc++)this.urd(this.vPc[Wc]);Array.clear(this.vPc);0>=this.Ks.length||5===Jb?this.hide():0===Jb&&this.WEc()}}yVb(Jb){for(let Wc=
0;Wc<this.Ks.length;Wc++)if(this.Ks[Wc].clientId===Jb)return Wc;return-1}aTo(Jb){-1===this.yVb(Jb)?O.ULS.sendTraceTag(41706452,302,50,"Cannot remove active editor because client id is invalid"):Array.contains(this.R$b,Jb)&&(Array.remove(this.R$b,Jb),this.Ks[0].clientId===Jb&&0<this.R$b.length&&this.Ykj(this.R$b[this.R$b.length-1]),this.Ks[0].clientId===Jb&&1===this.E8b&&this.Mlc())}EWj(Jb){Jb?Sys.UI.DomElement.addCssClass(this.Aca,"prBackgroundSelection"):Sys.UI.DomElement.removeCssClass(this.Aca,
"prBackgroundSelection")}bgp(){let Jb,Wc;Wc=Jb=0;var Md=this.GJc;if(this.wQh){const Mb=this.wQh(this);if(!Mb)return{offsetX:Jb,offsetY:Wc,jVi:Md};const pe=4===this.E8b;Md=this.yTk.lLm(this.Bdb,pe?6:this.atb,this.atb,this.element,Mb);Wc=Md.offsetTop;this.LLd=this.JJm(Md.Qhk,Md.offsetTop);Md=Md.kVi;Md!==this.GJc&&(this.Kxg(Md),this.element.dir=3===Md?"rtl":"ltr",this.GJc=Md);Md!==this.gCi()?(Jb=this.DTk?-2:pe?-6:-this.atb,this.qgc=!0):this.qgc=!1}return{offsetX:Jb,offsetY:Wc,jVi:Md}}JJm(Jb,Wc){if(1===
Jb)return this.Bdb-1;Jb=Math.abs(Wc);return 0<Jb?Jb/(this.atb+2):0}Kxg(Jb){for(let Wc=0;Wc<this.Bdb;Wc++)this.x$[Wc].Kxg(Jb)}gCi(){return this.zm?3:4}static gwb(){return String.format("{0}-{1}","presencetooltip",dg.RPc++)}static $Qf(Jb){return Jb.ob.rawEvent.relatedTarget}}dg.RPc=0;(0,ja.a)(dg,"ModernPresenceTooltipControl",Jd,[1001,33]);var Sf=v(34331),sg=v(54677);class Eh{constructor(Jb){this.Zd=Jb;this.Zd.RYa(10,Sf.a.instance);this.Zd.RYa(9,Zm.a.instance);this.Zd.RYa(6,20);this.Zd.RYa(13,sg.a.instance);
this.Zd.RYa(17,!1)}Nvf(Jb,Wc=!1){this.Zd.RYa(15,Wc);return new dg(Jb,20,this.Zd)}}(0,ja.a)(Eh,"ModernPresenceTooltipFactory",null,[1003]);class oh extends Jd{constructor(Jb,Wc){super(Jb);this.Ks=null;this.UXa=Wc.get(8,!1);this.Vnb=Wc.get(6,0);this.element=Jb;this.element.className=oh.lHf;this._ul=this.createElement("ul");this.element.appendChild(this._ul);this.Hg=Wc.get(10);this.Hg.Ua(li.a.click,this.element,(0,ed.a)(this,this.onClick,"onClick"));this.oz=Wc.get(9);this.oz.Ua(li.a.KJ,this.element,
(0,ed.a)(this,this.GJ,"onPointerOut"));this.oz.Ua(li.a.Rv,this.element,(0,ed.a)(this,this.ssa,"stopPropagationAndPreventDefaultBehavior"));this.XE=Wc.get(13);this.XE.Ua(this.element,(0,ed.a)(this,this.ssa,"stopPropagationAndPreventDefaultBehavior"))}aRb(Jb){this.addHandler(Ge.J_,Jb)}b5b(Jb){this.removeHandler(Ge.J_,Jb)}get users(){return this.Ks}dispose(){this.element&&(this.Hg.Qb(li.a.click,this.element,(0,ed.a)(this,this.onClick,"onClick")),this.oz.Qb(li.a.Rv,this.element,(0,ed.a)(this,this.ssa,
"stopPropagationAndPreventDefaultBehavior")),this.oz.Qb(li.a.KJ,this.element,(0,ed.a)(this,this.GJ,"onPointerOut")),this.XE.Qb(this.element,(0,ed.a)(this,this.ssa,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}hide(){this.visible=!1}show(Jb,Wc,Md){this.hide();!Jb||0>=Jb.length||(this.UXa?this.element.style.right=Wc+"px":this.element.style.left=Wc+"px",this.element.style.top=Md+"px",this.w$k(Jb),this.visible=!0)}w$k(Jb){this.Ks=Jb;pi.a.HH(this._ul);for(let Wc=Jb.length-1;0<=Wc;Wc--)this.$na(Jb[Wc])}$na(Jb){const Wc=
document.createElement("li");Wc.style.backgroundColor=Jb.color;Wc.style.height=this.Vnb+"px";Wc.id="fly_"+Jb.clientId;Wc.style.lineHeight=this.Vnb+"px";pi.a.qL(Wc,Jb.userName);Wc.setAttribute("dir","auto");this._ul.appendChild(Wc)}onClick(){this.hide();return!1}GJ(Jb){this.raiseEvent(Ge.J_,new Ge(3,Jb));return!1}}oh.lHf="prFlyout UIFont";(0,ja.a)(oh,"PresenceTooltipFlyoutControl",Jd,[]);class Kk extends Jd{constructor(Jb,Wc,Md){super(Jb);this._img=null;this.Ks=[];this.element.className="prGlyph";
this.Zd=Wc;this.Ufc=this.Zd.get(9);this.fA=this.Zd.get(10);this.XE=this.Zd.get(13);this.Ihn();this.$na(Md);this.v_e=!1}get gib(){return this.Ks.length}get users(){return this.Ks}aRb(Jb){this.addHandler(Ge.J_,Jb)}b5b(Jb){this.removeHandler(Ge.J_,Jb)}dispose(){this.DPp();super.dispose()}$na(Jb){Array.add(this.Ks,Jb);2===this.gib?this.Zsa(!0):1===this.gib?this.Zsa(!1):this.Zsa(this.v_e)}wjb(Jb){this.Sim(Jb)&&(1<this.gib&&this.Zsa(!0),1===this.gib?this.Zsa(!1):1>this.gib&&this.hide())}show(){this.Zsa(2<=
this.gib);this.visible=!0}hide(){this.visible=!1}uJm(Jb){return Jb?this.yAi(0,5):this.yAi(1,4)}Sim(Jb){for(let Wc=0;Wc<this.gib;Wc++)if(this.Ks[Wc].clientId===Jb)return Jb=this.Ks[Wc],Array.removeAt(this.Ks,Wc),Jb;return null}Zsa(Jb){this.v_e!==Jb&&(this._img&&this.element.removeChild(this._img),this._img=this.uJm(Jb),this.element.appendChild(this._img),this.v_e=Jb);this._img.childNodes[0].style.backgroundColor=this.Ks[this.Ks.length-1].color}yAi(Jb,Wc){const Md=this.Zd.get(6,0),Mb=this.Zd.get(14);
return Xb.a(Md,Md,this.Zd.get(Jb),this.Zd.get(Wc),"cui-img-cont-float cui-img-16by16","",!1,"",this.element.ownerDocument,Mb?Mb.cloneNode(!0):null)}KV(Jb){3!==Jb.Zf&&this.raiseEvent(Ge.J_,new Ge(2,Jb));return!1}onClick(Jb){this.raiseEvent(Ge.J_,new Ge(1,Jb));return!0}GJ(Jb){3!==Jb.Zf&&this.raiseEvent(Ge.J_,new Ge(3,Jb));return!1}DPp(){this.element&&(this.Ufc.Qb(li.a.Rv,this.element,(0,ed.a)(this,this.ssa,"stopPropagationAndPreventDefaultBehavior")),this.Ufc.Qb(li.a.nO,this.element,(0,ed.a)(this,this.KV,
"onPointerOver")),this.Ufc.Qb(li.a.KJ,this.element,(0,ed.a)(this,this.GJ,"onPointerOut")),this.fA.Qb(li.a.mJ,this.element,(0,ed.a)(this,this.ssa,"stopPropagationAndPreventDefaultBehavior")),this.fA.Qb(li.a.click,this.element,(0,ed.a)(this,this.onClick,"onClick")),this.XE.Qb(this.element,(0,ed.a)(this,this.ssa,"stopPropagationAndPreventDefaultBehavior")))}Ihn(){this.element&&(this.Ufc.Ua(li.a.Rv,this.element,(0,ed.a)(this,this.ssa,"stopPropagationAndPreventDefaultBehavior")),this.Ufc.Ua(li.a.nO,this.element,
(0,ed.a)(this,this.KV,"onPointerOver")),this.Ufc.Ua(li.a.KJ,this.element,(0,ed.a)(this,this.GJ,"onPointerOut")),this.fA.Ua(li.a.mJ,this.element,(0,ed.a)(this,this.ssa,"stopPropagationAndPreventDefaultBehavior")),this.fA.Ua(li.a.click,this.element,(0,ed.a)(this,this.onClick,"onClick")),this.XE.Ua(this.element,(0,ed.a)(this,this.ssa,"stopPropagationAndPreventDefaultBehavior")))}}(0,ja.a)(Kk,"PresenceTooltipGlyph",Jd,[]);class jg extends Jd{constructor(Jb,Wc,Md){super(Jb);this.Ks=[];this.mP=[];this.kXa=
0;this.iWc=this.ndc=!1;this.Peh=null;this.L3a=(Mb,pe)=>{var td=(0,R.a)(Kk,Mb);td=td?this.Fti(td):-1;if(2===pe.type||1===pe.type&&-1!==td&&!this.tja[td].visible)this.Eve(Mb);else if(1===pe.type)this.mfb(),this.ndc=!1;else if(3===pe.type){if(this.lEf(pe.Fp))return;this.ndc||this.mfb()}this.raiseEvent(Ge.J_,pe)};this.gJd={};this.Zd=Md;this.zm=Md.get(8,!1);this.zua=Md.get(11,!1);Jb=Md.get(12,0);this.bZb=Md.get(6,0);this.orb=Wc;this.element.id=jg.gwb();this.element.className=Jd.Cgi(this.zm);Jb&&(this.zIndex=
Jb);this.rtl=this.zm;this.kCg(Wc);this.CLa=this.createElement("div");this.CLa.className=this.zua?"prContainerV":"prContainerHr";this.element.appendChild(this.CLa);this.Qph=Array(this.kXa);for(Wc=0;Wc<this.kXa;Wc++)this.tja[Wc]=new oh(this.createElement("div"),this.Zd),this.tja[Wc].aRb(this.L3a),this.element.appendChild(this.tja[Wc].element)}get Nve(){return df.a.clone(this.Ks)}get tja(){return this.Qph}get fSh(){return this.Peh}get bEe(){return this.bZb+2}get width(){return this.zua?this.bEe:this.orb}get height(){return this.zua?
this.orb:this.bEe}aRb(Jb){this.addHandler(Ge.J_,Jb)}b5b(Jb){this.removeHandler(Ge.J_,Jb)}dispose(){if(this.tja)for(const Jb of this.tja)Jb.b5b(this.L3a),wl.a.aG(Jb);wl.a.yzg(this.mP);this.mP=this.Qph=null;super.dispose()}WEc(){this.mfb();this.AGg();this.visible=!0;this.ndc=!1}svd(){!this.mP||1>this.mP.length||(this.mfb(),this.visible=!0,this.AGg(),this.Eve(this.mP[this.mP.length-1]),this.ndc=!0)}sGg(){if(this.mP&&!(1>this.mP.length)){this.visible=!0;this.AGg();var Jb=0;for(const Wc of this.mP)this.Eve(Wc,
Jb++);this.ndc=!1;this.iWc=!0}}hide(){this.visible=!1;this.mfb();for(let Jb=0;Jb<this.mP.length;Jb++)this.mP[Jb].hide();this.ndc=!1}q6h(){if(!this.iWc)return!1;let Jb=0;for(const Wc of this.tja)Wc.visible&&Jb++;return this.iWc=0<Jb&&(this.Ks.length<=this.kXa?Jb===this.Ks.length:Jb===this.kXa)}$na(Jb){if(!(0>=this.kXa)){Jb.clientId||(Jb.clientId=(jg.RPc++).toString());if(Jb.clientId in this.gJd){var Wc=this.yVb(Jb.clientId);if(0<=Wc){Wc=this.Ks[Wc];if(Wc.color===Jb.color&&Wc.userName===Jb.userName)return;
this.wjb(Jb.clientId)}}Wc=this.q6h();var Md=0;if(this.Ks.length<this.kXa){var Mb=new Kk(this.createElement("div"),this.Zd,Jb);Mb.aRb(this.L3a);this.zm&&!this.zua&&0<this.Ks.length?this.CLa.insertBefore(Mb.element,this.CLa.firstChild):(this.CLa.appendChild(Mb.element),Md=this.mP.length);Array.add(this.mP,Mb)}else this.zm&&!this.zua?Mb=this.mP[0]:(Md=this.mP.length-1,Mb=this.mP[Md]),Mb.$na(Jb);Mb.show();this.gJd[Jb.clientId]=Mb;Array.add(this.Ks,Jb);this.hdk(Mb,Md);Wc&&this.sGg()}}wjb(Jb){const Wc=
this.q6h();Wc&&this.mfb();this.urd(Jb);this.Ks.length>=this.kXa&&this.mP.length<this.kXa&&this.sKo();0>=this.Ks.length?this.hide():Wc&&this.sGg()}Ykj(){}urd(Jb){var Wc=this.yVb(Jb);0>Wc||(Jb=this.Ks[Wc],Array.removeAt(this.Ks,Wc),Wc=this.gJd[Jb.clientId],delete this.gJd[Jb.clientId],Wc.wjb(Jb.clientId),this.hdk(Wc),0>=Wc.gib&&(this.CLa.removeChild(Wc.element),Array.remove(this.mP,Wc),Wc.dispose()))}sKo(){var Jb=this.eRm();!Jb||1>=Jb.users.length||(Jb=Array.clone(this.Ks),Jb.forEach(Wc=>{this.urd(Wc.clientId)}),
Jb.forEach(Wc=>{this.$na(Wc)}))}yVb(Jb){for(let Wc=0;Wc<this.Ks.length;Wc++)if(this.Ks[Wc].clientId===Jb)return Wc;return-1}eRm(){return this.zm&&!this.zua?this.mP[0]:this.mP[this.mP.length-1]}position(Jb,Wc){this.element.style.top=Wc+"px";this.element.style.left=Jb+"px"}AGg(){for(let Jb=0;Jb<this.mP.length;Jb++)this.mP[Jb].show()}mfb(){for(let Jb=0;Jb<this.kXa;Jb++)this.tja[Jb].hide();this.iWc=!1}Eve(Jb,Wc=0){if(Jb)if(this.Peh=Jb,this.zua){const Md=this.bZb;if(1<Jb.users.length)this.tja[Wc].show(Jb.users,
Md,this.height-this.bZb);else{const Mb=this.CLa.children.length;for(let pe=0;pe<this.CLa.children.length;pe++)Jb.element===this.CLa.children[pe]&&this.tja[Wc].show(Jb.users,Md,this.height-(Mb-pe)*this.bEe+2)}}else this.tja[Wc].show(Jb.users,this.width,0)}lEf(Jb){Jb=jg.$Qf(Jb);let Wc=!1;for(const Md of this.tja)if(pi.a.agb(Md.element,Jb)){Wc=!0;break}return this.CLa!==Jb&&pi.a.agb(this.CLa,Jb)||Wc}hdk(Jb,Wc=0){const Md=this.Tun(Jb);Md&&0>=Jb.gib?this.tja[Wc].hide():Md?this.Eve(Jb):this.tja[Wc].hide()}Fti(Jb){let Wc=
0;for(const Md of this.mP){if(Jb===Md)return Wc;Wc++}return-1}Tun(Jb){const Wc=this.Fti(Jb);return!!this.fSh&&Jb===this.fSh&&-1!==Wc&&this.tja[Wc].visible}kCg(Jb){this.kXa=Jb===this.bZb?1:Math.floor(Jb/this.bEe);this.zua?(this.element.style.height=Jb+"px",this.element.style.width=this.bZb+"px"):(this.element.style.width=Jb+"px",this.element.style.height=this.bZb+"px")}static gwb(){return String.format("{0}-{1}","presencetooltip",jg.RPc++)}static $Qf(Jb){Jb=Jb.ob.rawEvent;return Jb.relatedTarget||
Jb.toElement}}jg.RPc=0;(0,ja.a)(jg,"PresenceTooltipControl",Jd,[1001,33]);class Gh{constructor(Jb){this.Zd=Jb;this.Zd.RYa(10,Sf.a.instance);this.Zd.RYa(9,Zm.a.instance);this.Zd.RYa(6,16);this.Zd.RYa(13,sg.a.instance)}Nvf(Jb){return new jg(Jb,16,this.Zd)}}(0,ja.a)(Gh,"PresenceTooltipFactory",null,[1003]);var Nh=v(36263),xf=v(41678),fj=v(81808),ch=v(69833),Ig=v(20297),Zg=v(49962),Fj=v(39538),Qe=v(79449),kc=v(71592);class Hd extends Sys.EventArgs{constructor(Jb,Wc){super();this.paragraphId=Jb;this.eRn=
Wc}}(0,ja.a)(Hd,"PresenceControlRenderedEventArgs",Sys.EventArgs,[]);class Ce extends Jd{constructor(Jb,Wc,Md,Mb,pe,td=null,Xd=null){super(null);this.bJd=this.Go=null;this.d8f=!1;this.qBa=0;this.Pr=Jb;this.iXc=Wc;this.oz=Md;this.hj=Mb;this.xta=pe;Ce.lLb=0;this.wXh=new $c.a;this.ANj=new $c.a;this.w9=td;this.ta=Xd;this.DGk=this.ta.Ab("PresenceIpRenderedFloodgateTimeLapseSec",30);this.s0k=this.ta.Ab("PresenceIpRenderedFloodgateTriggerThreshold",3);this.ynb=0}get Shb(){return ya.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled")}nal(Jb){this.addHandler("CR",
Jb)}XJj(Jb){this.removeHandler("CR",Jb)}gxe(){this.raiseEvent("CR",new Hd(this.Pr.selection.lm.paragraphId,this.d8f))}$cg(){if((0,kc.a)(dg,this.Go)){const Jb=(0,R.a)(dg,this.Go);Ce.lLb=0<Ce.lLb?Ce.lLb+1:Jb.Gcb+1;Jb.zIndex=Ce.lLb;this.element.style.zIndex=String(Ce.lLb)}}I0o(){if((0,kc.a)(dg,this.Go)){const Jb=(0,R.a)(dg,this.Go);Ce.lLb=Jb.Gcb;Jb.zIndex=Jb.Gcb;this.element.style.zIndex=String(Jb.Gcb)}}Cfj(){this.w9&&!this.GLp()&&this.w9.continueWith(()=>{this.w9.result.logActivity("PresenceIpRendered",
"PresenceIpRenderedFloodgateEnabled",this.DGk)&&this.ynb++})}GLp(){return this.ynb>=this.s0k}static Qej(){Ce.Bph||(Ce.Bph=!0,O.ULS.sendTraceTag(4006594,302,50,"First presence ip rendered on the page"))}static gwb(Jb){return Ce.njn+Jb.AEi()}}Ce.LAj="data-presence-control";Ce.Wvj="OverlayControlElementOwner";Ce.njn="ipId_";Ce.MAj="WacPresence";Ce.xro="PresenceIpPaddingDiv";Ce.Bph=!1;Ce.lLb=0;(0,ja.a)(Ce,"APresenceControl",Jd,[1287,33]);class ue{constructor(){this.rotation=this.height=this.width=this.top=
this.left=0;this.tkb=!1}}(0,ja.a)(ue,"PresenceImageControlStyle",null,[1288]);var Yf=v(21393),Bf=v(92022);class bf extends Ce{constructor(Jb,Wc,Md,Mb,pe,td=null,Xd=null){super(Jb,Wc,Md,Mb,pe,td,Xd);this.GJ=()=>{this.gkj();return!1};this.Mte=jh=>{this.Go&&3===jh.Zf&&(2!==this.qBa?(this.$cg(),this.w7b()):this.gkj());return!1}}wjb(Jb){this.Go&&this.Go.wjb(Jb)}l_p(){return this.Go?this.Go.Nve.length:0}updatePosition(Jb){if(this.element&&this.element.parentNode){var Wc=this.$Ei(Jb);if(Wc){var Md=Sys.UI.DomElement.getBounds(this.element.parentNode),
Mb,pe;({left:Md,top:Mb,height:pe,width:Wc}=this.fUm(Wc,Md,this.element.parentNode,this.hj.instance));this.element.style.top=Mb+"px";this.element.style.left=Md+"px";this.element.style.height=pe+"px";this.element.style.width=Wc+"px";Md=this.iFi(Jb);bh.a.pga(this.element,Md);Jb=this.LNf(Jb,this.Pr.selection.lm.shapeId);this.hXj(Md,Wc,this.isSelected(Jb),ya.AFrameworkApplication.isRtl);this.w7b()}}}jrd(){this.element&&(pi.a.AD(this.element),this.Go.wjb(this.Pr.user.clientId),this.gxe())}gai(Jb,Wc,Md,
Mb){Wc=new ue;if(!Mb||!Md)return Wc;Md=this.$Ei(Jb);if(!Md)return Wc;Wc.top=Md.y;Wc.left=Md.x;Wc.height=Md.height;Wc.width=Md.width;Wc.rotation=this.mXm(Jb);Wc.tkb=!0;return Wc}LKj(Jb,Wc,Md,Mb){Ce.Qej();this.bJd=Jb;if(Mb){const pe=this.LNf(Jb,this.Pr.selection.lm.shapeId);if(!pe)return;const td=!this.element;td&&this.Rvf(Wc.ownerDocument,Jb);td||!this.element.parentNode?pe.appendChild(this.element):this.element.parentNode!==pe&&(this.element.parentNode.removeChild(this.element),pe.appendChild(this.element));
this.Go.$na(this.Pr.user);this.element.style.borderColor=this.Pr.user.color;this.element.id=Ce.gwb(this.Pr);Md.tkb&&(this.element.style.height=Md.height+"px",this.element.style.top=Md.top+"px",this.element.style.left=Md.left+"px",this.element.style.width=Md.width+"px",bh.a.pga(this.element,Md.rotation),bh.a.pga(this.Go.element,-1*Md.rotation),this.hXj(Md.rotation,Md.width,this.isSelected(pe),ya.AFrameworkApplication.isRtl),this.w7b())}this.d8f=!Mb;this.gxe()}mXm(Jb){return this.element&&this.element.parentNode&&
this.ILi(bh.a.getTransform(this.element.parentNode))?this.ILi(bh.a.getTransform(this.element)):this.iFi(Jb)}ILi(Jb){return Jb&&-1<Jb.indexOf("deg")&&(Jb=parseInt(Jb.substring(Jb.indexOf("(")+1,Jb.indexOf("deg"))),!isNaN(Jb))?Jb:0}Eck(Jb){this.element.style.borderColor=this.Pr.user.color;this.element.id=Ce.gwb(this.Pr);this.updatePosition(Jb)}Rvf(Jb,Wc){this.element=Jb.createElement("div");this.element.setAttribute(Ce.LAj,!0);xf.a.Km(this.element,Ce.Wvj,this);this.element.className=bf.wAo;(Jb=Wc.La)&&
Jb.Q5&&(this.element.style.pointerEvents="none");this.element.dir=ya.AFrameworkApplication.isRtl?"rtl":"ltr";this.Go=this.iXc.Nvf(this.createElement("div"),!0);this.Go.$na(this.Pr.user);this.Go.hide();this.oz.Ua(li.a.KJ,this.Go.element,this.GJ);this.oz.Ua(li.a.Rv,this.Go.element,this.Mte);this.Go.element.classList.add(Ce.MAj);this.element.appendChild(this.Go.element)}fUm(Jb,Wc,Md,Mb){let pe=Jb.y,td=Jb.x,Xd=Jb.height;Jb=Jb.width;(1<Math.abs(Wc.width-Md.offsetWidth)||1<Math.abs(Wc.height-Md.offsetHeight))&&
Mb&&(pe=Math.round(pe/Mb.mj),td=Math.round(td/Mb.mj),Xd=Math.round(Xd/Mb.mj),Jb=Math.round(Jb/Mb.mj));return{left:td,top:pe,height:Xd,width:Jb}}isSelected(Jb){return Jb.classList.contains("Selected")}hXj(Jb,Wc,Md,Mb){this.Go.element.style.left="auto";this.Go.element.style.top="auto";this.Go.element.style.right="auto";this.Go.element.style.bottom="auto";Md=Md?Math.round(.5*bf.pBa)+bf.KJp:0;0<=Jb&&90>Jb||360===Jb?(this.Go.element.style.top=-.5*bf.pBa-Md+"px",Mb?this.Go.element.style.right=Wc-.5*bf.pBa+
"px":this.Go.element.style.left=Wc-.5*bf.pBa+"px"):90<=Jb&&180>Jb?(this.Go.element.style.left=-.5*bf.pBa-Md+"px",Mb?this.Go.element.style.bottom=-.5*bf.pBa+"px":this.Go.element.style.top=-.5*bf.pBa+"px"):180<=Jb&&270>Jb?(this.Go.element.style.bottom=-.5*bf.pBa-Md+"px",Mb?this.Go.element.style.left=Wc-.5*bf.pBa+"px":this.Go.element.style.right=Wc-.5*bf.pBa+"px"):(this.Go.element.style.right=-.5*bf.pBa-Md+"px",Mb?this.Go.element.style.top=-.5*bf.pBa+"px":this.Go.element.style.bottom=-.5*bf.pBa+"px")}gi(Jb,
Wc){const Md=this.Pae(Jb,Wc);return Md?Md.properties:(Jb=this.fFi(Jb,Wc))?Jb.properties:null}LNf(Jb,Wc){var Md=this.Pae(Jb,Wc);return Md&&(Md=Md.Tpa(Jb.ef,Jb))?Md.element:(Wc=this.fFi(Jb,Wc))?(0,R.a)(Qe.a,Wc).xi(Jb.Pb).htmlElement:null}Pae(Jb,Wc){Jb=Fj.h(Jb.La,5);for(const Md of Jb)if(Md.properties.getValue(ch.a.Swa)===Wc)return Md;return null}fFi(Jb,Wc){Jb=(0,Bf.c)(Jb.La);let Md=Jb.qb(6);for(;Md;){const Mb=Md.properties.getValue(ch.a.Swa);if(Zg.a.Ip(Md)&&Mb===Wc)return Md;Md=Jb.Ff(6)}return null}lJm(Jb){const Wc=
fj.a.Gf(Zg.a.HG(Jb),0);Jb=fj.a.Gf(Zg.a.XH(Jb),1);return{fta:Wc,afn:Jb}}iFi(Jb){Jb=this.gi(Jb,this.Pr.selection.lm.shapeId);return Zg.a.o6(Jb)}$Ei(Jb){var Wc=this.Pr.selection;if(!Wc||!Wc.lm.shapeId)return null;var Md=this.gi(Jb,Wc.lm.shapeId);const Mb=this.LNf(Jb,Wc.lm.shapeId);if(!Md||!Mb)return null;let pe=Jb=1,td;({fta:Wc,afn:td}=this.lJm(Md));(0,Yf.f)(Md)?(Md=Zg.a.Dxa(Md),Jb=fj.a.Gf(Md[Ig.a.left],0),pe=fj.a.Gf(Md[Ig.a.top],1)):Md.hasProperty(ch.a.Zka)?(Md=Md.getValue(ch.a.Zka),Jb+=fj.a.Gf(Md[Ig.a.left],
0),pe+=fj.a.Gf(Md[Ig.a.top],1)):(Jb+=0<Mb.offsetWidth?(Mb.offsetWidth-Wc)/2:2,pe+=0<Mb.offsetHeight?(Mb.offsetHeight-td)/2:2);return new Sys.UI.Bounds(Math.round(Jb),Math.round(pe),Math.round(Wc),Math.round(td))}gkj(){this.Go&&(this.Go.WEc(),this.qBa=1)}w7b(){for(const Jb of this.Go.Nve)if(Jb.clientId===this.Pr.user.clientId&&!Jb.equals(this.Pr.user)){this.Go.$na(this.Pr.user);break}if(this.Pr.H5a||2===this.qBa)this.Go.svd(),this.Pr.H5a=!1,this.Pr.U_=!0,this.qBa=2;this.Pr.U_&&1!==this.qBa||(this.Go.WEc(),
this.Pr.U_=!0,this.qBa=1)}}bf.wAo="WACImgPresenceHighlight";bf.pBa=20;bf.KJp=6;(0,ja.a)(bf,"PresenceImageControl",Ce,[]);var Jg=v(27640);class Lg{constructor(){this.height=this.top=this.left=this.r_i=0;this.tkb=!1;this.Wp=this.kg=null}}(0,ja.a)(Lg,"PresenceIpControlStyle",null,[1288]);var qh=v(66679),Qf=v(13345);class Cf extends Ce{constructor(Jb,Wc,Md,Mb,pe,td=null,Xd=null,jh=null){super(Jb,Wc,Md,Mb,pe,td,Xd);this.qWc=this.V8a=this.khc=null;this.KV=Th=>{!this.Go||this.Shb&&!this.Go.lEf(Th)||(this.$cg(),
this.AAe(Th));this.Eck(this.bJd);return!1};this.GJ=()=>{this.Go&&this.DX();return!1};this.Mte=Th=>{this.Go&&3===Th.Zf&&(2!==this.qBa?(this.$cg(),this.AAe(Th)):this.DX());return!1};this.wH=jh}Rvf(Jb){this.element=Jb.createElement("div");this.element.setAttribute(Ce.LAj,!0);xf.a.Km(this.element,Ce.Wvj,this);this.element.className=Ce.xro;this.element.dir=ya.AFrameworkApplication.isRtl?"rtl":"ltr";this.oz.Ua(li.a.nO,this.element,this.KV);this.Shb&&(this.oz.Ua(li.a.KJ,this.element,this.GJ),this.oz.Ua(li.a.Rv,
this.element,this.Mte));this.V8a=this.createElement("div");this.V8a.className=Cf.xAo;this.Shb||(this.qWc=this.createElement("div"),this.qWc.className=Cf.AAo,this.V8a.appendChild(this.qWc));this.Go=this.iXc.Nvf(this.createElement("div"),this.Shb);this.wH&&(this.Pr.user=this.wH.hag(this.Pr.user.clientId)||this.Pr.user);this.Go.$na(this.Pr.user);this.Go.hide();this.Go.element.classList.add(this.Shb?Ce.MAj:Cf.jvo);this.V8a.appendChild(this.Go.element);this.element.appendChild(this.V8a)}w0l(){this.khc&&
(Cc.TaskManager.instance.Lf(this.khc),this.khc=null)}w7b(Jb){for(var Wc of this.Go.Nve)if(Wc.clientId===this.Pr.user.clientId&&!Wc.equals(this.Pr.user)){this.Go.$na(this.Pr.user);break}Wc=!1;Cf.hZl===this.Pr.user.color?({value:Wc}=this.wXh.qc(this.Pr.user.clientId,!1),Wc||(this.wXh.W(this.Pr.user.clientId,!0),O.ULS.sendTraceTag(17954772,302,50,'{ "ClientID" : "'+this.Pr.user.clientId+'" , "Event" : "RenderGrayPawn"}'))):({value:Wc}=this.ANj.qc(this.Pr.user.clientId,!1),Wc||(this.ANj.W(this.Pr.user.clientId,
!0),O.ULS.sendTraceTag(17954773,302,50,'{ "ClientID" : "'+this.Pr.user.clientId+'" , "Event" : "RenderColoredPawn"}')));return Jb||this.Pr.H5a||2===this.qBa?(this.Cfj(),this.Go.svd(),this.Pr.H5a=!1,this.Pr.U_=!0,this.qBa=2,Cf.dIp):this.Pr.U_&&1!==this.qBa?0:(this.Cfj(),this.Go.WEc(),this.Pr.U_=!0,this.qBa=1,Cf.cIp)}AAe(Jb=null){this.w0l();const Wc=this.w7b(!!Jb);this.Shb&&Jb&&Jb.eventName===li.a.nO||this.u6o(Wc)}DX(){this.Go&&this.qBa&&(this.I0o(),this.Go.hide(),this.qBa=0)}u6o(Jb){this.khc=new Za.a(2,
1,Jb,()=>{this.khc=null;this.DX()},56);Cc.TaskManager.instance.vb(this.khc)}updatePosition(Jb){if(this.element&&this.element.parentNode){var Wc=this.WFi(Jb);if(Wc){Jb=Sys.UI.DomElement.getBounds(this.element.parentNode);Wc=new Sys.UI.Bounds(Wc.x-Jb.x,Wc.y-Jb.y,Cf.v_i,Wc.height);var {left:Md,top:Mb,height:pe}=this.iUm(Wc,Jb,this.element.parentNode,this.hj.instance);this.element.style.height=2*Cf.uAc+pe+"px";this.element.style.top=Mb-Cf.uAc+"px";this.element.style.left=Md-Cf.uAc+"px";this.V8a.style.height=
Math.max(Cf.Vjj,pe)+"px";this.AAe()}}}jrd(){this.element&&(pi.a.AD(this.element),this.gxe())}gai(Jb,Wc,Md,Mb,pe){const td=new Lg;if(!Mb||!Md)return td;Mb=this.WFi(Jb);if(!Mb)return td;var Xd=Md;Md=Jb;if(!Qf.a.Ri&&Jb.Gk){var jh=Jb.lb;Xd=Jb.ti.hsc(this.tBi());0>Xd&&0==Xd;if(Jb.lb.zya){if(!pi.a.agb(jh.editingElement,Jb.ti.vk.K(Xd))){Md=(0,qh.a)().Ec.rE(Jb.source);if(!Md)return td;Wc=Md.ti.vk.K(Xd)}}else Wc=Md.ti.vk.K(Xd);Xd=Wc.getBoundingClientRect()}Xd=new Sys.UI.Bounds(Mb.x-Xd.x,Mb.y-Xd.y,Cf.v_i,Mb.height);
Jb=Xd.y;Mb=Xd.x;Xd=Xd.height;jh=this.hj.instance;pe&&jh&&(pe=jh.mj,Jb=Math.round(Jb/pe),Mb=Math.round(Mb/pe),Xd=Math.round(Xd/pe));td.top=Jb-Cf.uAc;td.left=Mb-Cf.uAc;td.height=2*Cf.uAc+Xd;td.r_i=Math.max(Cf.Vjj,Xd);td.tkb=!0;td.kg=Wc;td.Wp=Md;return td}LKj(Jb,Wc,Md,Mb){Ce.Qej();this.bJd=Jb;Jb=Md.kg;Wc=Md.Wp;if(Jb&&Wc){if(Mb){const pe=!this.element;pe&&this.Rvf(Jb.ownerDocument);pe||!this.element.parentNode?Jb.appendChild(this.element):this.element.parentNode!==Jb&&(this.element.parentNode.removeChild(this.element),
Jb.appendChild(this.element));this.bJd=Wc;Jb=this.Pr.user.color;this.V8a.style.borderColor=Jb;this.Shb||(this.qWc.style.borderColor=Jb);this.element.id=Ce.gwb(this.Pr);Md.tkb&&(this.element.style.height=Md.height+"px",this.element.style.top=Md.top+"px",this.element.style.left=Md.left+"px",this.V8a.style.height=Md.r_i+"px",this.AAe())}this.d8f=!Mb;this.gxe()}else O.ULS.sendTraceTag(520950942,302,50,`Skip IpControl rendering due to paragraphElement is null:${!Jb} or paragraphViewElement is null:${!Wc}`)}dispose(){this.element&&
(this.jrd(),this.oz.Qb(li.a.nO,this.element,this.KV),this.Shb&&(this.oz.Qb(li.a.KJ,this.element,this.GJ),this.oz.Qb(li.a.Rv,this.element,this.Mte)),wl.a.aG(this.Go),this.element=this.Go=null);super.dispose()}Eck(Jb){const Wc=this.Pr.user.color;this.V8a.style.borderColor=Wc;this.Shb||(this.qWc.style.borderColor=Wc);this.element.id=Ce.gwb(this.Pr);this.updatePosition(Jb)}iUm(Jb,Wc,Md,Mb){let pe=Jb.y,td=Jb.x;Jb=Jb.height;(1<Math.abs(Wc.width-Md.offsetWidth)||1<Math.abs(Wc.height-Md.offsetHeight))&&Mb&&
(pe=Math.round(pe/Mb.mj),td=Math.round(td/Mb.mj),Jb=Math.round(Jb/Mb.mj));return{left:td,top:pe,height:Jb}}WFi(Jb){if(!this.Pr.selection)return null;let Wc;try{const Md=this.tBi();Wc=Jg.a.SW(Md,Jb,0<Md,!1,!1,!1)}catch(Md){pf.a.trackExceptionTag(506009683,Md),O.ULS.sendTraceTag(4301318,302,15,"Could not determine the bounds of IP: isYielding={0} message={1} stack={2}",Cc.TaskManager.instance.GF,Md.message,Md.stack),Wc=null}return Wc}tBi(){return this.Pr.selection.Lzb()?this.Pr.selection.Jda.P3.cp:
this.Pr.selection.lm.P3.cp}}Cf.jvo="WacPawn";Cf.v_i=2;Cf.cIp=7E3;Cf.dIp=2E3;Cf.uAc=5;Cf.xAo="presenceIp";Cf.AAo="PresenceSmallBox";Cf.Vjj=10;Cf.hZl="0xcccccc";(0,ja.a)(Cf,"PresenceIpControl",Ce,[]);class Sg{constructor(Jb,Wc,Md,Mb,pe=null,td=null,Xd=null){this.$Ed={};this.nMc={};this.Xih={};this.iXc=Jb;this.oz=Wc;this.Bv=Md;this.xta=Mb;this.w9=pe;this.ta=td;this.wH=Xd}get HXl(){return this.nMc}eUm(Jb){const Wc=!!this.ta&&this.ta.$("PeoplesWellExtraButtonInfoIsEnabled");return Jb.selection.lm.shapeId&&
Wc?this.jUm(Jb):this.kUm(Jb)}jUm(Jb){const Wc=Jb.selection.lm.shapeId.toString();this.Xih[Jb.user.clientId]=Wc;const Md=this.nMc[Wc];return Md?(Md.Pr=Jb,{returnValue:Md,uJe:!0}):{returnValue:this.nMc[Wc]=new bf(Jb,this.iXc,this.oz,this.Bv,this.xta,this.w9,this.ta),uJe:!1}}kUm(Jb){const Wc=Jb.user.clientId,Md=this.$Ed[Wc];return Md&&Md.Pr.user.equals(Jb.user)?(Md.Pr=Jb,{returnValue:Md,uJe:!0}):{returnValue:this.$Ed[Wc]=new Cf(Jb,this.iXc,this.oz,this.Bv,this.xta,this.w9,this.ta,this.wH),uJe:!1}}XFi(Jb){return this.$Ed[Jb]}hJm(Jb){return(Jb=
this.nMc[this.Xih[Jb]])&&!Jb.l_p()?Jb:null}Y4l(){var Jb=this.$Ed;for(const Wc in Jb)Jb[Wc].dispose();Jb=this.nMc;for(const Wc in Jb)Jb[Wc].dispose()}}(0,ja.a)(Sg,"PresenceControlProvider",null,[]);var Oh=v(5334);class Ep{constructor(){this.eqb=0}aIi(){this.eqb++;this.eqb===Number.MAX_VALUE&&(this.eqb=1);return this.eqb}static get instance(){return Ep.ATc}}Ep.ATc=new Ep;(0,ja.a)(Ep,"PacketIdGenerator",null,[1795]);class jk{constructor(Jb,Wc,Md){this.N6o=Jb;this.Ukn=Wc;this.tbj=Md}}(0,ja.a)(jk,"SuccessfulInboundReplicationCallbackData",
null,[]);class Hh{constructor(Jb,Wc,Md,Mb,pe,td,Xd){this.m4o=(jh,Th)=>{Th.type||(jh=this.Lq.Lni>=this.IEk,this.G_k&&jh?(jh=this.WWe())?jh.Fpi():O.ULS.sendTraceTag(19682513,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt."):this.VH())};this.Vno=jh=>{if(jh=(0,R.a)(jk,jh)){var Th=jh.Ukn.jj.toString(),he=this.WWe(),Id=he.Rw,Xk="";Id!==jh.tbj&&(O.ULS.sendTraceTag(19964236,500,50,"Time saved due to force inbound on update notification message = {0} ms",jh.N6o.toString()),
Xk=this.WOm(he,Id,jh.tbj));O.ULS.sendTraceTag(19964237,500,50,"Revisions: {0}, InboundDuration: {1}",Xk,Th)}else O.ULS.sendTraceTag(19964235,500,10,"The callback data was null")};this.i4o=Jb;this.WWe=Wc;this.Lq=Md;this.G_k=pe;this.IEk=td;this.tec=Mb;this.sq=Xd;this.i4o.XR(this.m4o)}VH(){const Jb=this.WWe();if(!Jb)O.ULS.sendTraceTag(19682514,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt.");else if(!this.tec()&&Jb.axc){let Wc=-1;null!=Jb&&(Wc=Jb.o5b());const Md=
this.sq.Df("Task","ShoulderTapInboundReplicationTimer");Jb.VH(this.Vno,null,new jk(Wc,Md,Jb.Rw))}}WOm(Jb,Wc,Md){const Mb=new Sys.StringBuilder;Jb=Jb.node.ic.lTa.Dsc(Wc);if(!Jb)return O.ULS.sendTraceTag(19964238,500,10,"The revision we got from the last replicator revisionId was null - {0}",{lastRevisionId:Wc}),"";for(Mb.append(Jb.id.Wt);Wc!==Md;){Mb.append(", ");Mb.append(Wc.Wt);Jb=Jb.Bp;if(!Jb)break;Wc=Jb.id}return Mb.toString()}}(0,ja.a)(Hh,"ContentNotificationManager",null,[]);class Xh extends Hh{constructor(Jb,
Wc,Md,Mb,pe,td,Xd){super(Jb,Wc,Md,Mb,pe,td,Xd)}static get AAa(){return null!=Xh.O$g?Xh.O$g:Xh.O$g=(0,oa.a)(tb)}static init(){if(ec.a.ua()){var Jb=ec.a.ua().Ea;Jb&&(Jb.sda(Xh.pmd),Jb=Jb.nc)&&(Xh.rQd=Jb.Xf,Xh.rQd&&Ic.a.mGa().continueWith(Xh.jig))}}static jig(){Xh.UDd=Ic.a.mGa().result;Xh.UDd&&Xh.UDd.In&&Xh.AAa.vF().continueWith(Xh.Gnd)}static Gnd(){Xh.Di=Xh.AAa.vF().result;if(Xh.Di){var Jb=ya.AFrameworkApplication.J,Wc=Jb.$("Box4ThrottleInboundRequests");Jb=Jb.Ab("Box4ThrottleInboundsAtUserCount",20);
Xh.rQd.bsc=()=>Xh.Di.sfa;Xh.RDd=Xh.RDd||new Xh(Xh.Di,()=>Xh.rQd,Xh.UDd,()=>ya.AFrameworkApplication.isShuttingDown,Wc,Jb,ec.a.ua().Ft);Xh.RDd.VH()}}static pmd(Jb){Xh.RDd||(Jb.aTa(Xh.pmd),Xh.init())}}Xh.RDd=null;Xh.Di=null;Xh.rQd=null;Xh.UDd=null;(0,ja.a)(Xh,"WordContentNotificationManager",Hh,[]);class ho{constructor(Jb,Wc,Md,Mb,pe,td){this.JEd=null;this.VGh=Jb;this.Ic=Md;this.Spb=Mb;this.WM=pe;this.Rh=td;this.a$b=Wc}clone(){return new ho(this.VGh,this.a$b.clone(),this.Ic,this.Spb,this.WM,this.Rh)}get cp(){if(null!=
this.JEd)return this.JEd;var Jb=this.VGh.paragraphId;if(Jb.equals(ii.a.nil))return 0;var Wc=this.Spb();if(!Wc)return 0;Jb=Wc.Ra(Jb);if(!Jb)return O.ULS.sendTraceTag(7685326,302,15,"Paragraph Node is null so returning a CP with value 0"),0;Wc=this.Ic.lTb(this.Ic.d4a(Jb.characterData,Jb.ma),this.a$b);if(this.WM){const Md=Tc.a.fc(Jb,Wc);this.Rh&&Jb.yu&&(Md.Ya=this.Rh.oPf(Jb,Wc,this.a$b.pOa));Wc=this.WM.uOa(Md,!0)}return Wc}Nzc(){null==this.JEd&&(this.JEd=this.cp)}equals(Jb){return Jb?this.a$b.isEqual(Jb.a$b,
!1,!1):!1}}(0,ja.a)(ho,"WordPresenceCp",null,[862,207,1969]);class ki{constructor(Jb,Wc){this.WM=Jb;this.Rh=Wc}create(Jb,Wc,Md,Mb){return new ho(Jb,Wc,Md,Mb,this.WM,this.Rh)}}(0,ja.a)(ki,"Factory",null,[1796]);class Vk extends Sys.EventArgs{constructor(Jb,Wc,Md){super();this.paragraphId=Jb;this.MJ=Wc;this.M_f=Md}}(0,ja.a)(Vk,"ParagraphChangedEventArg",Sys.EventArgs,[]);class Ij{constructor(Jb,Wc,Md,Mb,pe){this.paragraphId=Jb;this.cp=Wc;this.length=Md;this.shapeId=Mb;this.dryDeletion=pe}}(0,ja.a)(Ij,
"SerializablePresenceIpData",null,[]);class ik{constructor(Jb){this.cp=Jb}equals(Jb){return Jb?this.cp===Jb.cp:!1}clone(){return new ik(this.cp)}}(0,ja.a)(ik,"PresenceCp",null,[862,207]);class Ph{constructor(Jb,Wc,Md,Mb=0,pe=0){this.shapeId=Mb;this.dryDeletion=pe;Jb&&(this.paragraphId=ii.a.Ed(Jb));this.P3=new ik(Wc);this.Uza=Md}isValid(){return 0<=this.P3.cp&&!!this.paragraphId&&!this.paragraphId.equals(ii.a.nil)}clone(){return new Ph(this.paragraphId?.toString(),this.P3?.cp,this.Uza,this.shapeId,
this.dryDeletion)}}(0,ja.a)(Ph,"PresenceSelectionBoundary",null,[209,207]);class Pl{constructor(Jb,Wc,Md,Mb=0,pe=0){this.Jda=void 0;this.lm=new Ph(Jb,Wc,Md,Mb,pe)}isValid(){return 0<=this.lm.P3.cp&&!!this.lm.paragraphId&&!this.lm.paragraphId.equals(ii.a.nil)}Lzb(){return!!this.Jda}getData(){return new Ij(this.lm.paragraphId.toString(),this.lm.P3.cp,this.lm.Uza,this.lm.shapeId,this.lm.dryDeletion)}clone(){return new Pl(this.lm.paragraphId.toString(),this.lm.P3.cp,this.lm.Uza,this.lm.shapeId,this.lm.dryDeletion)}static pTb(Jb){return Jb.paragraphId&&
null!=Jb.cp&&null!=Jb.length?new Pl(Jb.paragraphId,Jb.cp,Jb.length,void 0,Jb.dryDeletion):null}}(0,ja.a)(Pl,"PresenceSelection",null,[208,207]);class Qi{constructor(Jb,Wc){this.ip=Jb;this.user=Wc}}(0,ja.a)(Qi,"SerializablePresenceData",null,[]);class zn{constructor(Jb,Wc){this.H5a=this.U_=this.nyc=!1;this.ew=Wc;this.user=Jb}get selection(){return this.ew}GRf(){return new Qi(this.selection?this.selection.getData():null,this.user.getData())}AEi(){return this.user.clientId+(this.ew?this.ew.lm.paragraphId.toString():
ii.a.nil.toString())}isValid(){const Jb=!!this.user&&this.user.isValid(),Wc=!this.selection||this.selection.isValid();return Jb&&Wc}clone(){const Jb=new zn;Jb.user=this.user?this.user.clone():null;Jb.ew=this.ew?this.ew.clone():null;Jb.U_=this.U_;Jb.nyc=this.nyc;Jb.H5a=this.H5a;return Jb}static pTb(Jb){return Jb?new zn(rc.pTb(Jb.user),Jb.ip?Pl.pTb(Jb.ip):null):null}}(0,ja.a)(zn,"PresenceInfo",null,[206,207]);class om extends ub.a{constructor(){super();this.KTc={};this.y7a={};this.vph=!1}get Cso(){return this.KTc}get V5i(){return!!ya.AFrameworkApplication.J&&
ya.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled")}aWh(Jb){this.addHandler("PPC",Jb)}wKj(Jb){this.removeHandler("PPC",Jb)}T$c(Jb){return Jb.selection.Lzb()?Jb.selection.Jda.paragraphId.toString():Jb.selection.lm.paragraphId.toString()}Lhf(Jb,Wc=!1){this.vph||(this.vph=!0,O.ULS.sendTraceTag(4289312,302,50,"First presence added to data manager"));var Md=({yAo:Mb}=this.hMn(Jb)).returnValue;if(Mb&&!Wc)(Md=this.y7a[Jb.user.clientId])&&0<=Md.length&&(Md[Md.length-1].selection.lm.Uza=Jb.selection.lm.Uza);
else{Md||this.kJj(Jb.user.clientId);this.V5i&&Md&&this.UUp(Jb);Wc=this.T$c(Jb);var Mb=Jb.user.clientId;var pe=this.KTc[Wc]||[],td=this.y7a[Mb]||[];td.length>=om.Sij&&(td=td.splice(-om.Eco,om.Sij));Md||pe.push(Mb);td.push(Jb);this.KTc[Wc]=pe;this.y7a[Mb]=td;Jb.selection.lm.paragraphId.equals(ii.a.nil)||this.Qsg(Jb.selection.Lzb()?Jb.selection.Jda.paragraphId:Jb.selection.lm.paragraphId,Jb,!0)}}hMn(Jb){var Wc=this.y7a[Jb.user.clientId];const Md=!Wc||0>=Wc.length?null:Wc[Wc.length-1],Mb=!!Md&&this.T$c(Md)===
this.T$c(Jb);Wc=Mb&&Md.selection.lm.P3.equals(Jb.selection.lm.P3)&&!Md.selection.Lzb()&&!Jb.selection.Lzb()&&Md.user.equals(Jb.user);this.V5i&&Wc&&Md.selection.lm.shapeId&&Jb.selection.lm.shapeId&&Md.selection.lm.shapeId!==Jb.selection.lm.shapeId&&(Wc=!1);return{returnValue:Mb,yAo:Wc}}UUp(Jb){const Wc=this.XXl(Jb);Wc&&Wc.selection.lm.shapeId&&(Jb.selection.lm.shapeId&&Jb.selection.lm.shapeId===Wc.selection.lm.shapeId||this.Qsg(Wc.selection.lm.paragraphId,Wc,!1))}XXl(Jb){Jb=this.y7a[Jb.user.clientId];
return!Jb||0>=Jb.length?null:Jb[Jb.length-1]}kJj(Jb){const Wc=this.y7a[Jb];if(Wc&&0<Wc.length){const Md=Wc[0].selection.lm.paragraphId,Mb=this.T$c(Wc[0]);delete this.y7a[Jb];this.SUo(Mb,Jb);Md.equals(ii.a.nil)||this.Qsg(Md,Wc[0],!1)}}rAi(Jb){return this.KTc[Jb]}u8c(Jb,Wc,Md,Mb=!1){const pe=[],td=this.rAi(Jb);if(!td)return pe;for(let Xd=0;Xd<td.length;Xd++){const jh=td[Xd],Th=this.y7a[jh];let he=!1;for(let Id=Th.length-1;0<=Id;Id--){const Xk=Th[Id];if(Mb){if(Xk.U_&&Xk.selection.lm.paragraphId.equals(ii.a.Ed(Jb))){he=
!0;pe.push(Xk);break}continue}const mh=Xk.selection.Lzb()?Xk.selection.Jda.Uza:Xk.selection.lm.Uza;if((0,kc.a)(zn,Xk)?mh===Wc:mh===Md){he=!0;Xk.nyc=!0;pe.push(Xk);this.y7a[jh]=Th.splice(Id,Th.length);break}}!he&&0<Th.length&&Th[0].nyc&&Th[0].selection.lm.paragraphId.equals(ii.a.Ed(Jb))&&pe.push(Th[0])}return pe}Ksm(Jb){if(!Jb||!Jb.xa||!Jb.xa.node)return null;Jb=this.u8c(Jb.xa.node.id.toString(),0,0,!0);Jb=this.J4m(Jb);Jb.sort((Wc,Md)=>{if(!(Wc&&Wc.userName&&Md&&Md.userName))return O.ULS.sendTraceTag(542165082,
302,15,"Missing presence user info for user in PresenceInfos"),0});return Jb}J4m(Jb){if(!Jb||!Jb.length)return[];const Wc=[],Md=new ba.a(ma.a.Xg());for(let Mb=0;Mb<Jb.length;Mb++){const pe=Jb[Mb].user;pe.isAnonymous&&Md.contains(pe.clientId)||!pe.isAnonymous&&pe.email&&Md.contains(pe.email)||(Wc.push(pe),Md.add(pe.isAnonymous?pe.clientId:pe.email))}return Wc}Qsg(Jb,Wc,Md){this.raiseEvent("PPC",new Vk(Jb,Wc,Md))}SUo(Jb,Wc){Array.remove(this.KTc[Jb],Wc)}}om.Sij=10;om.Eco=2;(0,ja.a)(om,"PresenceDataManager",
ub.a,[203]);class Hn extends om{constructor(Jb){super();this.VB=Jb}Lhf(Jb,Wc=!1){super.Lhf(Jb,Wc)}T$c(Jb){Jb=Jb.selection;return Jb.Lzb()?Jb.M3p.toString():Jb.rjk.toString()}rAi(Jb){Jb=this.VB.Ra(ii.a.Ed(Jb));if(!Jb)return null;Jb=Jb.la(ch.a.kc,0);return this.Cso[Jb.toString()]}}(0,ja.a)(Hn,"WordPresenceDataManager",om,[]);const gn=(0,oa.b)("WordEditor.Presence.WordPresenceManager"),$p=(0,oa.d)(gn),cp=(0,oa.b)("Common.IPresenceStatusProvider"),Lk=(0,oa.d)(cp),Yr=(0,oa.b)("Box4.Presence.PresenceControlProvider"),
lh=(0,oa.d)(Yr);var io=v(41549);const xl=(0,oa.b)("Box4.Presence.WordPresenceDataManager"),gg=(0,oa.d)(xl);var jm=v(64171),$m=v(86134),Go=v(76693),qn=v(38146),kr=v(90600),Fp=v(56418);class Eq{constructor(Jb,Wc,Md,Mb,pe,td,Xd,jh,Th,he,Id,Xk,mh,Rl,rk,nf,Pf,bi,Bi,Z,$a,zb,Qb,mc){this.uYa=Array(5);this._started=this.V$e=!1;this.J7e=null;this.tHh=new ba.a(ma.a.Xg());this.IOd={};this.t0e=!1;this.Qqj=()=>{this.V$e&&(this.TAg(),this.V$e=!1)};this.Eib=(gc,Zc)=>{this.LSj(Zc.Zn.currentSelection)};this.eY=(gc,
Zc)=>{gc=Zc.fma;for(var Yd in gc){const fe=gc[Yd];this.ta.$("CashTelemetryIsEnabled")&&this.U5c(fe,new Date,null);fe.selection?this.Dhf(fe):this.vrd(fe.user.clientId)}Zc=Zc.x4c;for(Yd=0;Yd<Zc.length;++Yd)this.g1l(Zc[Yd]);this.Eye()};this.vkg=(gc,Zc)=>{Zc.paragraphId?this.$Wp(Zc.paragraphId.toString(),Zc.eRn,this.IOd):O.ULS.shipAssertTag(8758481,302,!1,"null paraid")};this.NAj=(gc,Zc)=>{Zc.paragraphId&&(gc=this.GL.Ra(Zc.paragraphId))&&(((0,kc.a)(zn,Zc.MJ)?this.NWe(gc):this.OWe(gc))===(Zc.paragraphId===
Zc.MJ.selection.lm.paragraphId?Zc.MJ.selection.lm.Uza:Zc.MJ.selection.Jda.Uza)&&this.z6o(Zc.paragraphId),this.Xgg&&this.zAo(Zc))};this.Nq=Jb;this.Ha=Mb;this.wH=pe;this.kOb=td;this.b5=Th;this.HEk=he;this.Xfc=Id;this.GL=Md;this.NWe=mh;this.OWe=Rl;this.Swk=Xd;this.KEk=jh;this.hXa=rk;this.aF=nf;this.Sb=Pf;this.pb=bi;this.lOh=zb;this.EUk=mc;this.K7e=Z;this.ta=$a;this.nOd=Wc;Eq.pPd=new $c.a;for(Jb=0;Jb<this.nOd.length;Jb++)this.nOd[Jb].PQo(this);this.kOb.aWh(this.NAj);this.Nq.gEa(this.eY);this.Nq.Sxe(this)}get Xgg(){return!!this.ta&&
this.ta.$("PeoplesWellExtraButtonInfoIsEnabled")}get C8i(){return null!=this.D6g?this.D6g:this.D6g=(()=>!!this.ta&&this.ta.getBooleanFeatureGate("Microsoft.Office.WordOnline.IsPresenceSelectionRangeEnabled",!1)&&(ya.AFrameworkApplication.R_||this.ta.getBooleanFeatureGate("Microsoft.Office.Shared.IsLiveMeetingSessionOverrideEnabled",!1))&&(ya.AFrameworkApplication.Kya||this.ta.getBooleanFeatureGate("Microsoft.Office.Shared.IsLiveMeetingPresenterOverrideEnabled",!1)))()}B8i(Jb){return this.C8i&&!Jb.k5f()&&
!Jb.Nv&&!Jb.Xya&&!Jb.iRa}Eye(Jb=!1){this.lOh&&!Jb||this.FKj()}FKj(){const Jb=new ea.a,Wc=this.IOd;for(const Md in Wc)Jb.add(ii.a.Ed(Md));this.itm(Jb);this.IOd={}}TAg(){this.Ha.za&&this.LSj(this.Ha.za.currentSelection,!0)}LSj(Jb,Wc=!1){this.EUk||(this.GL.kk.W6||Wc?Jb?(Wc=this.lUl(Jb))?this.Nq.hBg(Wc):(this.Nq.hBg(null),O.ULS.sendTraceTag(4281418,302,50,"Not supported selection context {0}",Jb.xa.contextId)):this.Nq.hBg(null):this.V$e=!0)}lUl(Jb){let Wc=Jb;return this.Xgg&&Jb.Qhd||this.B8i(Jb)||(Wc=
kr.a.Ij(Jb,!0,!1),kr.a.Hm(Wc))?this.Z1h(Wc):null}Z1h(Jb){const Wc=Jb.xa.cpBegin,Md=Jb.xa.node.id;Jb=this.NWe(Jb.xa.node);return new Pl(Md.toString(),Wc,Jb)}U5c(Jb,Wc,Md){if(this.K7e)if(Jb&&Jb.user&&Jb.user.clientId){var Mb=Jb.user.clientId;this.tHh.contains(Mb)||(this.J7e?(this.J7e.U5c(Mb,Wc,null,Eq.tXm(Md||Jb.user.client)),this.tHh.add(Mb)):this.K7e.continueWith(()=>{this.J7e=this.K7e.result;this.U5c(Jb,Wc,Md)}))}else O.ULS.sendTraceTag(42262876,302,15,"invalid presence")}gUm(Jb){const Wc=new ea.a;
for(let Md=0;Md<Jb.length;Md++)Wc.add(this.z4m(Jb[Md]));return Wc}Dhf(Jb){var Wc=null;Jb&&Jb.user&&(Wc=Jb.user.client);Jb=Jb.clone();Jb.user=this.wH.hag(Jb.user.clientId)||Jb.user;this.ta.$("CashTelemetryIsEnabled")&&this.U5c(Jb,new Date,Wc);Jb.isValid()&&!Jb.user.isComplete()&&(Wc=Jb.user.clientId,Eq.pPd.fb(Wc)||this.LRi(Wc),this.MWp(Wc),Jb.user.userName=CommonUiStrings.AnonymousUserName);this.kOb.Lhf(Jb,!1)}MWp(Jb){const {value:Wc}=Eq.pPd.qc(Jb,!1);Wc||(Eq.pPd.W(Jb,!0),O.ULS.sendTraceTag(17954774,
302,50,'{ "ClientID" : "'+Jb+'" , "Event" : "CreateAnonymousGrayPawn"}'))}LRi(){}vrd(Jb){this.kOb.kJj(Jb)}g1l(Jb){this.vrd(Jb);const Wc=this.Xfc.XFi(Jb);Wc&&(Wc.XJj(this.vkg),Wc.dispose());this.Xgg&&(Jb=this.Xfc.hJm(Jb))&&(Jb.XJj(this.vkg),Jb.dispose())}jxb(Jb){if(12!==Jb.type||ya.AFrameworkApplication.Xpf&&!dd.a.Iw)return new ea.a;Jb=this.kOb.u8c(Jb.id.toString(),this.NWe(Jb),this.OWe(Jb));return 0>=Jb.length?new ea.a:this.gUm(Jb)}$Wp(Jb,Wc,Md){!Wc&&Jb in Md&&delete Md[Jb]}dispose(){this.stop();
this.kOb.wKj(this.NAj);this.Nq.S4a(this.eY);this.Nq.OOg(this);for(let Jb=0;Jb<this.nOd.length;Jb++)this.nOd[Jb].uQp(this);wl.a.yzg([this.Swk,this.KEk,this.Nq]);this.Xfc.Y4l()}z4m(Jb){let Wc=!1;Jb=({uJe:Wc}=this.Xfc.eUm(Jb)).returnValue;Wc||Jb.nal(this.vkg);return Jb}PPi(Jb){Jb=this.GL.Ra(Jb);if(!Jb)return this.uYa[0]||(O.ULS.sendTraceTag(4281420,302,50,"Could not find the node in object space"),this.uYa[0]=!0),null;if(!ud.a.gb(Jb))return this.uYa[1]||(O.ULS.sendTraceTag(4281421,302,50,"Not a paragraph node"),
this.uYa[1]=!0),null;if(!Jb.xi(this.b5.Pb))return this.uYa[2]||(O.ULS.sendTraceTag(4281422,302,50,"No ViewElement found for this node"),this.uYa[2]=!0),null;if(!Jb.anchor)return this.uYa[3]||(O.ULS.sendTraceTag(4281423,302,50,"node is not anchored"),this.uYa[3]=!0),null;this.uYa[4]||(O.ULS.sendTraceTag(4564931,302,50,"Valid paragraph node found for rendering ip"),this.uYa[4]=!0);return Jb}QIj(Jb){Jb=this.kOb.u8c(Jb.toString(),-1,-1,!0);if(!df.a.ff(Jb))for(const Wc of Jb)(Jb=this.Xfc.XFi(Wc.user.clientId))&&
Jb.element&&Jb.jrd()}itm(Jb){if(Jb.count){var Wc=new ea.a;for(var Md of Jb)(Jb=this.PPi(Md))?Wc.add(Jb):this.QIj(Md);if(Wc.count){Md=this.Sb.Rb(2);try{Md.set(this.aF);for(const Mb of Wc)this.Xli(Mb)}finally{Md&&Md.dispose()}}}}Xli(Jb){Jb.Nz(this.b5.Pb,32,!0);Jb.Nz(this.HEk,32,!0)}z6o(Jb){this.IOd[Jb.toString()]=null;this.lOh&&!this.t0e&&(Jb=new Za.a(0,1,200,()=>{this.t0e=!1;this.FKj()},70),this.pb.vb(Jb),this.t0e=!0)}zAo(Jb){if(Jb.MJ.selection.lm.shapeId&&!Jb.M_f){var Wc=this.Xfc.HXl[Jb.MJ.selection.lm.shapeId.toString()];
Wc&&Wc.wjb(Jb.MJ.user.clientId)}}stop(){this._started&&(this._started=!1,this.Ha.MIa(this.Eib),Fp.a.instance.qKj(this.Qqj))}start(){if(!this._started){this._started=!0;this.Ha.bE(this.Eib);Fp.a.instance.fXd(this.Qqj);var Jb=this.Nq.qwb();delete Jb[this.hXa.clientId];this.eY(null,new qn.a(Jb,[]));this.TAg()}}Y0j(Jb){if(Jb&&Jb.isValid()&&Jb.selection){var Wc=this.kOb.u8c(Jb.selection.lm.paragraphId.toString(),-1,-1),Md=!1,Mb=null;for(let pe=0;pe<Wc.length;pe++)if(Mb=Wc[pe],Mb.user.clientId===Jb.user.clientId){Md=
Mb.H5a=!0;break}if(Md)if(Wc=Mb.selection.lm.paragraphId,Jb=this.PPi(Wc)){Wc=this.Sb.Rb(2);try{Wc.Oa(Jb),this.Xli(Jb)}finally{Wc&&Wc.dispose()}}else this.QIj(Wc)}}static tXm(Jb){return Jb?Jb?1===Jb?1:2===Jb?2:0:2:0}}Eq.pPd=null;(0,ja.a)(Eq,"PresenceManager",null,[212,33,202,213,214,215]);class Dr{constructor(Jb,Wc,Md,Mb){this.Ibc=null;this._started=this.$Ze=!1;this.qQb=null;this.P3a=(pe,td)=>{if(!ya.AFrameworkApplication.isShuttingDown&&(pe=this.Gdk(td.Zn),this.Ibc&&pe)){pe=this.OSe.u8c(this.Ibc.toString(),
-1,-1,!0);for(td=0;td<pe.length;td++)this.qQb[pe[td].user.clientId]=pe[td];0>=pe.length||(pe=this.OPl(pe),this.Zs.sendNotification(pe,!0))}};this.Csj=(pe,td)=>{this.Ha.za&&!ya.AFrameworkApplication.isShuttingDown&&this.$Ze&&this.Ibc&&this.Ibc.equals(td.paragraphId)&&(pe=null,!td.M_f||td.MJ.user.clientId in this.qQb?td.M_f||(pe=this.lgi(td.MJ.user.userName,!1),delete this.qQb[td.MJ.user.clientId]):(pe=this.lgi(td.MJ.user.userName,!0),this.qQb[td.MJ.user.clientId]=td.MJ),pe&&this.Zs.sendNotification(pe,
!0))};this.Di=Mb;this.Ha=Wc;this.OSe=Jb;this.Zs=Md;this.Di.Sxe(this)}start(){this._started||(this._started=!0,this.qQb={},this.OSe.aWh(this.Csj),this.Ha.bE(this.P3a),this.Gdk(this.Ha.za))}stop(){this._started&&(this._started=!1,this.qQb=null,this.OSe.wKj(this.Csj),this.Ha.MIa(this.P3a))}OPl(Jb){if(1===Jb.length)return String.format(Box4Strings.OtherUsersEditingParagraphSingle,Jb[0].user.userName);const Wc=[],Md=Jb.length;for(let Mb=0;Mb<Md;Mb++)Wc.push(Jb[Mb].user.userName);return String.format(Box4Strings.OtherUsersEditingParagraphMany,
Wc.join(Box4Strings.DisplayNameSeparator))}lgi(Jb,Wc){return String.format(Wc?Box4Strings.UserJoiningParagraph:Box4Strings.UserLeavingParagraph,Jb)}dispose(){this.Di.OOg(this);this.stop()}Gdk(Jb){if(!Jb)return!1;Jb=Jb.currentSelection;if(!Jb)return!1;Jb=Jb.xa;if(!Jb)return!1;this.$Ze=kr.a.We(Jb);Jb=Jb.node.id;if(Jb.equals(this.Ibc)||!this.$Ze)return!1;this.Ibc=Jb;this.qQb={};return!0}}(0,ja.a)(Dr,"PresenceAccessibilityManager",null,[33,202]);class vf{constructor(Jb,Wc){this._started=!1;this.ZO=null;
this.dKd=!1;this.I2b=()=>{this._started&&this.uSj()};this.Di=Jb;Wc&&(this.ZO=Wc,this.ZO.Lab(this.I2b));this.Di.Sxe(this)}start(){this._started||(this._started=!0,this.ZO?this.uSj():this.Di.gH(1,this.Fei()))}uSj(){const Jb=this.dKd;(this.dKd=!!this.ZO.aT)&&!Jb&&this.Di.gH(1,this.Fei())}Fei(){const Jb={};Jb.Id="{"+ya.AFrameworkApplication.userSessionId.toUpperCase()+"}";Jb.HQ=!1;Jb.NT=1;Jb.WEB=!0;return Jb}stop(){this._started&&(this._started=this.dKd=!1)}dispose(){this.Di.OOg(this);this.ZO&&this.ZO.ZJj(this.I2b)}}
(0,ja.a)(vf,"EditorsTableNotifier",null,[33,202]);var $h=v(45502);class $s extends Eq{constructor(Jb,Wc,Md,Mb,pe,td,Xd,jh,Th,he,Id,Xk,mh,Rl,rk,nf,Pf,bi,Bi,Z,$a,zb,Qb,mc,gc,Zc,Yd,fe,Ld,ze,kf){super(Jb,Wc,Md,Mb,pe,td,Xd,jh,Th,he,Id,mh,Rl,rk,nf,Bi,Z,$a,zb,Qb,mc,gc,Zc,Ld);this.Lq=null;this.e9l=mg=>{const Wf=!!this.Lq.mH.m$d(mg);O.ULS.sendTraceTag(579179741,302,50,"ClientId:{0} isPresentAfterPoll:{1}",mg,Wf)};this.d9l=(mg,Wf)=>{O.ULS.sendTraceTag(579179742,302,15,"EditorsReplicator failed with {0} when looking for ClientId {1}",
Wf,mg)};this.hO=()=>{if(2===$s.Di.connectionState&&!jb.a.instance.wqa){const mg={};mg.qs=ya.AFrameworkApplication.Vo;$s.Di.ema(mg)}};Xk.pa(1177859183,1,$s.w8k,64);Xk.pa(3460066539,1,$s.uVo,64);Xk.pa(477883041,1,$s.aGo,96);Xk.pa(761503246,1,$s.qvp,64);this.jP=Pf;this.Ic=bi;this.bYc=Yd;this.hXa.iBc=fe;this.hXa.iBc.lcl($s.Dsj);ze.continueWith(()=>{this.Lq=ze.result});O.ULS.sendTraceTag(4006600,302,50,"WordPresenceManager Initialized");(this.cva=kf)&&this.cva.execute(mg=>{(0,ab.a)()?mg.fEa(this.hO):mg.eEa(this.hO)})}pXb(Jb){if(!Jb||
!Jb.anchor)return null;for(Jb=Jb.anchor.hv;Jb;Jb=Jb.zD)if(Jb.WGa)return Jb.Vs.node;return null}$1h(Jb,Wc,Md,Mb){const pe=Jb?Wc.xa:Wc.$b;var td=pe.node,Xd=pe.cpBegin;this.B8i(Wc)&&(Xd=Jb?pe.Bh:pe.kl);Mb&&Zg.a.Ip(td)&&(td=this.pXb(td));if(!td)return O.ULS.sendTraceTag(51242309,302,15,"selectedNode is null"),null;Wc=this.OWe(td);Mb=pe.node.la(ch.a.kc,0);if(!this.jP)return O.ULS.sendTraceTag(35997152,302,15,"paragraphWordIdMapping is null"),null;td=this.jP.value.T0a(Mb);const jh=$s.VB.Ra(td);if(!jh)return O.ULS.sendTraceTag(16791249,
302,15,"Can't find pid "+td),null;Xd=this.Ic.gIc(this.Ic.d4a(jh.characterData,jh.ma),Xd);Jb=Jb?pe.Ya:pe.mb;Xd.pOa=-1===Jb?0:Jb;return new Bd(this.jP.value,Mb,Wc,Xd,this.Ic,()=>$s.VB,this.bYc,Md)}Z1h(Jb){let Wc=null;const Md=ya.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled");let Mb=0;Md&&Jb.Qhd&&(Mb=this.wZm(Jb));const pe=this.$1h(!0,Jb,Mb,Md);let td;this.C8i&&(Jb.xa.equals(Jb.$b)&&Jb.xa.cpBegin===Jb.xa.cpEnd||(td=this.$1h(!1,Jb,Mb,Md)));pe&&(Wc=new ae(pe,td));return Wc}wZm(Jb){const Wc=
Zg.a.UFa(Jb.xa);return Wc?Wc.properties.la(ch.a.Swa,0):Jb.xa.node.properties.la(ch.a.Swa,0)}LRi(Jb){this.Lq&&this.Lq.B_a&&this.Lq.B_a.VH(this.e9l,this.d9l,Jb)}dispose(){this.cva&&this.cva.execute(Jb=>{(0,ab.a)()?Jb.g5b(this.hO):Jb.f5b(this.hO)});super.dispose()}static get ariaNotifier(){return(0,oa.a)(jm.a)}static vF(){return $s.SPc.task}static get_instance(){return $s.oPd.task}static lUm(){return $s.TGh.task}static get AAa(){return null!=$s.N$g?$s.N$g:$s.N$g=(0,oa.a)(tb)}static init(){$s.oPd||($s.oPd=
new K.a);$s.Jph&&(O.ULS.sendTraceTag(4256585,302,50,"WordPresenceManager Init"),$s.Jph=!1);if(ec.a.ua()){var Jb=ec.a.ua().Ea;Jb?(Jb.sda($s.pmd),$s.FTc=Jb.Mb,Jb.Hqa()?($s.uWa=Jb.nc.Xf,$s.uWa?($s.VB=Jb.nc.ic,$s.VB?$s.AAa.vF().continueWith($s.Vmo):O.ULS.sendTraceTag(4006599,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to content ObjectSpace of the app")):O.ULS.sendTraceTag(4252228,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to the GraphSpaceReplicator object")):
O.ULS.sendTraceTag(4006598,302,50,"PageView doesn't seem to have been initialized yet. Will try again once we know it's initialized")):O.ULS.sendTraceTag(4006597,302,15,"Can't initialize the WordPresenceManager because workspace is not initialized")}else O.ULS.sendTraceTag(4006596,302,15,"Can't initialize the WordPresenceManager because active AppFrame is not initialized")}static Vmo(){$s.Di=$s.AAa.vF().result;if($s.Di){var Jb=[$s.FTc.Znd,$s.FTc.je.Znd],Wc=Kc.a.instance,Md=(0,oa.a)(gg),Mb=new Dr(Md,
Wc,$s.ariaNotifier,$s.Di),pe=new vf($s.Di,Ic.a.Uc().mH),td=(0,oa.g)(io.a),Xd=(0,oa.a)(Hg.a),jh=(0,oa.a)(gj);$s._instance=new $s($s.Di,Jb,$s.VB,Wc,jh,Md,Mb,pe,$s.FTc,$s.FTc.je.Pb,(0,oa.a)(lh),ya.AFrameworkApplication.oa,$s.uWa,ud.a.textLength,ud.a.Uwa,(0,oa.a)(zj),td,Xd,dd.a.Lc.Um,new $h.a,Cc.TaskManager.instance,$m.a.get_instance(),ha.a.Xs((0,oa.f)(z)),ya.AFrameworkApplication.J,ya.AFrameworkApplication.J.$("Box4ThrottleAndBatchPresenceRendering"),ya.AFrameworkApplication.J.$("Box4DoNotRenderPresenceOutOfView"),
(0,oa.a)(Nb),(0,oa.a)(Lk),!dd.a.Iw&&!dd.a.Po,Ic.a.mGa(),(0,oa.f)(gb.a));O.ULS.sendTraceTag(23196878,302,50,"WordPresenceManager instance created");$s.oPd.setResult($s._instance);$s.SPc.setResult($s._instance);$s.TGh.setResult($s._instance);pc.a.instance.ia("WordEditor.Presence.WordPresenceManager",()=>$s._instance).as("Common.IPresenceRemover").as("Common.IPresenceSender").fa();(0,oa.a)($p)}else O.ULS.sendTraceTag(4203468,302,15,"Can't initialize the WordPresenceManager because can't get a handle to RtcProxy")}static pmd(Jb){$s._instance||
(O.ULS.sendTraceTag(4006601,302,50,"WordPresenceManager.OnAppIsInteractive: Trying to initialize again"),(Jb=(0,R.a)(327,Jb))&&Jb.aTa($s.pmd),$s.init())}static Dsj(){$s._instance.TAg()}static w8k(Jb,Wc,Md,Mb,pe){Md=pe.split(",");if(!Md||3!==Md.length)return 8;Jb=Md[0].trim();Wc=Md[1].trim();Md=Number.parseInvariant(Md[2].trim());Jb=new zn(new rc(Jb),new Pl(Wc,Md,-1));if(!$s.SPc.task.isCompleted)return 8;Wc=$s.vF().result;Wc.Dhf(Jb);Wc.Eye();return 32}static uVo(Jb,Wc,Md,Mb,pe){if(!$s.SPc.task.isCompleted)return 8;
Jb=$s.vF().result;Jb.vrd(pe);Jb.Eye();return 32}static qvp(Jb,Wc,Md,Mb,pe){if(!$s.SPc.task.isCompleted)return 8;Jb=$s.vF().result;if(!Jb)return 8;Jb.Y0j(pe);return 32}static aGo(Jb,Wc,Md,Mb,pe){if(1===Md)return 32;if(!$s.AAa.vF().isCompleted)return 8;Jb=$s.AAa.vF().result;if(!Jb)return O.ULS.sendTraceTag(4301136,302,10,"rtcProxy is null when trying to display RTC connection status"),8;pe[Go.a.Value]=2===Jb.connectionState?WacWordeditorStrings.RtcConnected:1===Jb.connectionState?WacWordeditorStrings.RtcConnecting:
"";return 32}}$s._instance=null;$s.Jph=!0;$s.oPd=new K.a;$s.SPc=new K.a;$s.TGh=new K.a;$s.VB=null;$s.FTc=null;$s.uWa=null;$s.Di=null;(0,ja.a)($s,"WordPresenceManager",Eq,[]);class Xj{constructor(Jb){this.lIa=Jb;this.na=new ub.a}lcl(Jb){this.na.addHandler("X",Jb)}pXo(Jb){this.na.removeHandler("X",Jb)}getStatus(){return this.lIa.UIi().toString()}}(0,ja.a)(Xj,"WordPresenceStatusProvider",null,[1798]);class Ql{constructor(Jb,Wc,Md,Mb){this.Di=null;this.Aph=this.b3e=!1;this.Wmo=()=>{this.LR.isCompleted&&
this.LR.result?(this.Di=this.LR.result,this.Di.gEa(this.eY),O.ULS.sendTraceTag(5604372,302,50,"Presence Update Monitor is ready.")):O.ULS.sendTraceTag(5604373,302,15,"RtcTask did not complete successfully. No monitoring")};this.eY=(pe,td)=>{pe=td.fma;for(const Xd in pe)if(td=pe[Xd],!this.b3e&&td.user.dssLineageId&&td.user.dssLineageId!==this.Fua.Daa){this.fxn&&(this.Lq.value.pto(),O.ULS.sendTraceTag(5604375,302,15,"Presence received from different lineage, possibly parallel backend sessions ongoing Mine:{0} Theirs:{1}",
this.Fua.Daa,td.user.dssLineageId),this.b3e=!0);break}this.b3e&&this.Di.S4a(this.eY);this.Aph||(O.ULS.sendTraceTag(5604374,302,50,"First presence received"),this.Aph=!0)};this.Lq=Jb;this.Fua=Wc;this.LR=Md;Md.continueWith(this.Wmo);this.sPk=Mb;this.sPk.qjd=this.Fua}get fxn(){return!!this.Lq&&!!this.Lq.value}}(0,ja.a)(Ql,"WordPresenceUpdateMonitor",null,[]);var ut=v(86407);const lu=(0,oa.d)(G.a);var Nm=v(49142),Mi=v(41085),Qp=v(58115),vs=v(63728),ni=v(79343),nd=v(50511),lr=v(74396),Vq=v(52078);class Wq{constructor(Jb,
Wc,Md,Mb,pe,td,Xd,jh){this.na=new ub.a;this.uwh=this.eyh=this.q1e=this.QAh=!1;this.Hef=this.HUd=0;this.jic=null;this.MF=()=>{this.sk.Rz?this.rk.connect():this.rk.disconnect()};this.hXa=td;this.hXa.clientId=Jb.clientId;this.rk=Jb;this.aha=Wc;this.uua=Mb;this.PGk=pe;this.pb=Md;this.Qnb=new ni.a;this.Jt=Xd;this.aha&&this.aha.continueWith(()=>{this.aha.lp||this.aha.Xi||this.aha.result.bVh((0,ed.a)(this,this.Uoj,"onAmIAloneChanged"))});this.sk=jh;jh.uda(this.MF)}get connectionState(){return this.rk.connectionState}gEa(Jb){this.na.addHandler("PU",
Jb)}S4a(Jb){this.na.removeHandler("PU",Jb)}D5(Jb){this.na.addHandler("CSC",Jb)}LIa(Jb){this.na.removeHandler("CSC",Jb)}qsb(Jb){this.na.addHandler("PSU",Jb)}PDb(Jb){this.na.removeHandler("PSU",Jb)}psb(Jb){this.na.addHandler("PSC",Jb)}ODb(Jb){this.na.removeHandler("PSC",Jb)}gBg(){}get clientId(){return this.rk.clientId}XR(Jb){this.na.addHandler("UN",Jb)}NIa(Jb){this.na.removeHandler("UN",Jb)}Hmn(){this.jic=Array(12);for(let Jb=0;12>Jb;Jb++)this.jic[Jb]=0;this.eyh=this.Jt?this.Jt.$("UpdateNotificationTaskExperimentIsEnabled"):
!0;ya.AFrameworkApplication.jH(()=>{this.e0n()})}init(){this.rk.D5((0,ed.a)(this,this.xM,"onConnectionStateChanged"));this.rk.gEa((0,ed.a)(this,this.eY,"onPresenceUpdated"));this.rk.qsb((0,ed.a)(this,this.Oka,"onPersistentStateUpdated"));this.rk.psb((0,ed.a)(this,this.O3a,"onPersistentStateCleared"));this.rk.XR((0,ed.a)(this,this.LV,"onUpdateNotificationReceived"));this.zai();this.Hmn()}Sxe(Jb){this.Qnb.contains(Jb,(Wc,Md)=>Wc===Md)||(this.Qnb.add(Jb),2===this.connectionState&&Jb.start())}OOg(Jb){for(let Wc=
0;Wc<this.Qnb.length;Wc++)if(this.Qnb.K(Wc)===Jb){this.Qnb.ZL(Wc);break}}connect(){this.q1e||this.rk.connect()}disconnect(){this.rk.disconnect()}get l4o(){return this.rk}jki(Jb){return zn.pTb(Jb)}CBg(Jb,Wc){return(new zn(Jb,Wc)).GRf()}hBg(Jb){Jb&&Jb.isValid()&&!this.uua()?this.rk.gBg(this.CBg(this.hXa.wOm(),Jb)):la.Task.z$(null)}eJa(Jb,Wc){return this.rk.eJa(Jb,Wc)}pwb(Jb){return this.rk.pwb(Jb)}mqc(){return this.rk.mqc()}gH(Jb,Wc,Md=!1){return this.rk.gH(Jb,Wc,Md)}qwb(){return this.uei(this.rk.qwb())}ema(Jb){const Wc=
new K.a;Vq.a.getInstance().kxe(Jb,Wc);return Wc.task}get sfa(){return this.rk.sfa}xM(Jb,Wc){2===Wc.newState&&this.Qnb.forEach(Md=>{Md.start();return!0});Wc.newState||this.Jt.$("SendRTCMessagesWhileDisconnectedIsEnabled")&&!this.q1e||this.Qnb.forEach(Md=>{Md.stop();return!0});this.na.raiseEvent("CSC",Wc)}SGf(Jb){return Jb.toLowerCase()}eY(Jb,Wc){if(!this.uua()){Jb=this.uei(Wc.fma);Wc=this.wei(Wc.x4c);var Md=new qn.a(Jb,Wc);Wc=new Za.a(0,1,0,()=>{this.na.raiseEvent("PU",Md)},57);this.pb.vb(Wc)}}uei(Jb){const Wc=
{};for(const Mb in Jb){var Md=Mb;const pe=this.jki(Jb[Mb]);pe&&pe.isValid()?Wc[this.SGf(Md)]=pe:O.ULS.sendTraceTag(562661590,302,50,"No Valid User {0}",Md)}return Wc}wei(Jb){const Wc=Array(Jb.length);for(let Md=0;Md<Jb.length;Md++)Wc[Md]=this.SGf(Jb[Md]);return Wc}Oka(Jb,Wc){if(!this.uua()){var Md={};Jb=Wc.fma;for(var Mb in Jb)Md[this.SGf(Mb)]=Jb[Mb];Mb=new Za.a(0,1,0,()=>{this.na.raiseEvent("PSU",new nd.a(Wc.type,Md))},80);this.pb.vb(Mb)}}O3a(Jb,Wc){if(!this.uua()){Jb=this.wei(Wc.ztb);var Md=new lr.a(Jb);
Jb=new Za.a(0,1,0,()=>{this.na.raiseEvent("PSC",Md)},81);this.pb.vb(Jb)}}LV(Jb,Wc){this.eyh?this.Juj(Wc):(Jb=new Za.a(0,1,0,()=>{this.Juj(Wc)},58),this.pb.vb(Jb))}Juj(Jb){var Wc=Date.now();this.na.raiseEvent("UN",Jb);Wc=Date.now()-Wc;500<=Wc&&(this.HUd++,O.ULS.sendTraceTag(42563487,302,15,"Update Notification Heuristics: UpdateNotification Type {0} took {1} ms",Jb.type,Wc),this.Mkm(Jb));this.Hef++}Mkm(Jb){0>Jb.type||21<=Jb.type?O.ULS.sendTraceTag(42541602,302,15,"Update Notification Heuristics: UpdateNotification Type out of range {0}",
Jb.type):this.jic[Jb.type]++}e0n(){if(!this.uwh){var Jb={};Jb.TC=this.Hef;Jb.HRC=this.HUd;this.jic&&0<this.HUd&&(Jb.TBC=this.jic);this.HUd=this.Hef=0;this.jic=null;O.ULS.sendTraceTag(42541603,302,50,"UpdateNotificationHeuristics: {0}",Jb);this.uwh=!0}}dispose(){this.Qnb=new ni.a;this.rk.LIa((0,ed.a)(this,this.xM,"onConnectionStateChanged"));this.rk.S4a((0,ed.a)(this,this.eY,"onPresenceUpdated"));this.rk.PDb((0,ed.a)(this,this.Oka,"onPersistentStateUpdated"));this.rk.ODb((0,ed.a)(this,this.O3a,"onPersistentStateCleared"));
this.rk.NIa((0,ed.a)(this,this.LV,"onUpdateNotificationReceived"));this.aha&&this.aha.continueWith(()=>{this.aha.lp||this.aha.Xi||this.aha.result.qWo((0,ed.a)(this,this.Uoj,"onAmIAloneChanged"))});this.rk.disconnect();O.ULS.sendTraceTag(4564935,302,50,"Disposing of rtcProxyCompleted")}Uoj(){this.zai()}zai(){let Jb=!1;this.aha?this.aha.continueWith(()=>{this.aha.lp||this.aha.Xi||(Jb=!this.aha.result.gw);this.rk.connectionState||!Jb&&!this.PGk()?2!==this.rk.connectionState||Jb||(this.disconnect(),O.ULS.sendTraceTag(4564937,
302,50,"Disconnecting because there are no other users in the doc")):(this.connect(),O.ULS.sendTraceTag(4564936,302,15,"Connecting because there are other authors in the doc"));!this.QAh&&Jb&&(O.ULS.sendTraceTag(4203466,302,50,"There are other real-time authors in this session"),this.QAh=!0)}):(this.connect(),O.ULS.sendTraceTag(589321547,302,50,"Connecting to rtc because Rtc Always On is enabled"))}w4c(){this.q1e=!0;this.disconnect();O.ULS.sendTraceTag(4564938,302,50,"DisconnectForever")}}(0,ja.a)(Wq,
"RtcProxy",null,[216,33,217,218]);class oe extends Wq{constructor(Jb,Wc,Md,Mb,pe,td,Xd,jh,Th,he,Id,Xk,mh,Rl){super(Jb,Wc,Md,Mb,pe,td,mh,Rl);this.Ina=null;this.jP=Xd;this.Ic=jh;this.Spb=Th;this.ATc=he;this.Abf=Id;this.bYc=Xk}get WJ(){return this.Ina||(this.Ina=this.Abf())}xM(Jb,Wc){2===Wc.newState&&O.ULS.sendTraceTag(4315102,302,50,"RTC Connected");ya.AFrameworkApplication.UGg&&this.qXp();super.xM(Jb,Wc)}qXp(){this.WJ&&this.WJ.l0("RtcConnectionStatusLabel")}jki(Jb){return qe.ewf(re(Jb),this.jP,this.Ic,
this.Spb,this.bYc)}CBg(Jb,Wc){return(0,kc.a)(ae,Wc)?(Jb=new qe(this.ATc.aIi(),Jb,Wc),yg(Jb.GRf())):super.CBg(Jb,Wc)}}(0,ja.a)(oe,"WordRtcProxy",Wq,[]);class Ji{constructor(Jb,Wc,Md,Mb,pe,td,Xd,jh,Th,he,Id,Xk,mh){this.Su=new K.a;this.HLh=!0;this.vd=Wc;this.pb=Md;this.uua=Mb;this.hXa=pe;this.jP=td;this.VDa=Xd;this.Spb=jh;this.ATc=Th;this.Abf=he;this.cva=Id;this.bYc=Xk;this.ta=mh}vF(){this.lMp();return this.Su.task}TWb(){return Mi.a.then(this.vF(),Jb=>Jb)}lMp(){if(this.HLh)if(this.HLh=!1,dd.a.q5f()&&
dd.a.V2f()){var Jb=ya.AFrameworkApplication.Fd;if(Jb){var Wc="{"+ya.AFrameworkApplication.userSessionId+"}",Md=ya.AFrameworkApplication.userSessionId,Mb=ya.AFrameworkApplication.mzg,pe=this.ta.$("RtcAlwaysOnEnabled"),td=jh=>{const Th=new oe(jh,pe?null:Ic.a.mGa(),this.pb,this.uua,Ji.$nm,this.hXa,this.jP,this.VDa,this.Spb,this.ATc,this.Abf,this.bYc,ya.AFrameworkApplication.J,(0,oa.a)(ut.a));vs.a.$ip(Th);this.GQo(Th);Th.init();Oh.a.R5b=Th;this.cva.execute(he=>{(0,ab.a)()?he.Qab(()=>{Th.w4c()}):he.Pab(()=>
{Th.w4c()})});this.Su.setResult(Th)};if(ya.AFrameworkApplication.J.getBooleanFeatureGate("Microsoft.Office.WordOnline.LoadRtcFrom1JS",!0))v.e(31).then(v.bind(v,30736)).then(jh=>{Xd=jh.Nsk.createInstance(Wc,Md,Mb,Jb,this.cva,1,this.vd,this.ta.ya("RtcEndpointUrl"),void 0,void 0,null,this.ta.$("FindSessionOnBootIsEnabled")?(0,oa.a)(Nm.a):null,this.ta.ya("RtcBootToken"));td(Xd)});else{var Xd=Qp.a.createInstance(Wc,Md,Mb,Jb,this.cva,1,this.vd,this.ta.ya("RtcEndpointUrl"),void 0,void 0,null,this.ta.$("FindSessionOnBootIsEnabled")?
(0,oa.a)(Nm.a):null,this.ta.ya("RtcBootToken"));td(Xd)}}else O.ULS.sendTraceTag(8206365,302,15,"Can't initialize the RtcProxy because ClientRequestManager is null")}else O.ULS.sendTraceTag(8206362,302,10,"Can't initialize the RtcProxy because dependent scripts are not loaded")}GQo(Jb){pc.a.instance.ia("WordEditor.Presence.WordRtcProxy",()=>Jb).as("Box4.Presence.IRtcProxy").as("Common.IRealtimeChannelBasic").fa();(0,oa.a)(lu)}static $nm(){return!1}}(0,ja.a)(Ji,"WordRtcProxyProvider",null,[1800,1801]);
class dp{constructor(){this.ha=null;this.xm=!1}get name(){return"WordEditor.Presence"}init(){O.ULS.sendTraceTag(50995799,302,50,"PresencePackage Init");dd.a.njk&&((0,oa.a)(Wl).vF(),$s.init(),(0,oa.a)(Ae));dd.a.P1c&&Xh.init();(0,oa.a)($g);(0,oa.a)(gj);(0,oa.a)(lg.a).cZc(this.bAc)}dispose(){if(!this.xm){this.xm=!0;$s.vF().continueWith(()=>{wl.a.aG($s.vF().result)});var Jb=(0,oa.a)(zj);Jb&&Jb.iBc&&Jb.iBc.pXo($s.Dsj)}}configure(Jb){this.ha=Jb;this.ha.ia("Box4.Presence.MyPresenceUser",()=>new sb).as("Box4.Presence.IMyPresenceUser").as("Common.IPresenceUser").as("Common.IPresenceConverter").fa();
Jb.ia("WordEditor.Presence.IWordPresenceCpFactory",()=>new ki((0,oa.a)($l.a),(0,oa.a)(ol.a))).fa();Jb.ia("WordEditor.Presence.WordPresenceUpdateMonitor",()=>new Ql(new Pa.a(()=>Ic.a.Uc()),Nh.a.instance,(0,oa.a)(Wl).TWb(),(0,oa.a)(rg))).fa();Jb.ia("WordEditor.Presence.WordRtcProxyProvider",()=>new Ji(ya.AFrameworkApplication.buildVersion,ec.a.ua().Ft,Cc.TaskManager.instance,()=>ya.AFrameworkApplication.isShuttingDown,(0,oa.a)(rg),(0,oa.h)(Db.a),(0,oa.a)(Hg.a),()=>ya.AFrameworkApplication.qa&&ec.a.ua().Ea&&
ec.a.ua().Ea.nc?ec.a.ua().Ea.nc.ic:null,Ep.instance,()=>(0,oa.h)(bb.a),(0,oa.f)(gb.a),(0,oa.a)(Nb),ya.AFrameworkApplication.J)).fa().as("Box4.Presence.IRtcProxyProvider").as("Common.Interface.IRtcBasicProvider");Jb.ia("Box4.Presence.PresenceControlProvider",()=>new Sg(dp.zWl(),Zm.a.instance,(0,oa.f)(jc.a),(0,oa.a)(jd),ha.a.Xs((0,oa.f)(Zi.a)),ya.AFrameworkApplication.J,(0,oa.a)(gj))).fa();Jb.ia("Common.App.Presence.AwayManager",()=>new Dk((0,oa.a)(eg),(0,oa.a)(Wl).TWb(),$s.lUm(),(0,oa.a)(kh),Cc.TaskManager.instance,
ya.AFrameworkApplication.J.$("AwayStatusOneMinuteTimeoutIsEnabled")?6E4:ya.AFrameworkApplication.J.Ab("AwayCoauthorThresholdMs",9E5),(0,ed.a)(ya.AFrameworkApplication.oa,ya.AFrameworkApplication.oa.hb,"processAction"),ec.a.ua().zt,ya.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled"))).fa();Jb.ia("WordEditor.Presence.WordPresenceStatusProvider",()=>new Xj((0,oa.a)(Yi.a))).as("Common.IPresenceStatusProvider").fa();Jb.ia("Common.App.Presence.PeopleInfoProvider",()=>new Eb((0,oa.a)(Wl).TWb(),
Ic.a.mGa().CWR(()=>Ic.a.mGa().result.mH),(0,oa.a)(bj.a),(0,oa.a)(kh),ha.a.Xs((0,oa.f)($f)))).as("Common.IPeopleInfoProvider").fa();Jb.ia("Box4.Presence.WordPresenceDataManager",()=>new Hn(ec.a.ua().Ea.nc.ic)).as("Box4.IPresenceDataManager").fa()}bAc(){dp._pageContent=null}static get ewj(){if(!dp._pageContent){const Jb=Oh.a.An?.RM;Jb&&(dp._pageContent=Jb.getElementsByClassName("PaginatedContentContainerDisplayWrapper")[0])}return dp._pageContent}static zWl(){const Jb=ya.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled"),
Wc=ya.AFrameworkApplication.J.$("PresenceIgnoreEventOnExpandedTooltip"),Md=ya.AFrameworkApplication.J.$("PresenceIpWidthAdjustForFlyout"),Mb=new md;Mb.add(Ec.e$n,Xb.c(ya.AFrameworkApplication.g3,"MoreUsersGlyph16"));Mb.add(Ec.d$n,ya.AFrameworkApplication.Yt);Mb.add(Ec.svo,Xb.c(ya.AFrameworkApplication.g3,Jb?"DoughboyWhiteGlyph_20x20x32":"SingleCollabUserGlyph16"));Mb.add(Ec.tvo,ya.AFrameworkApplication.Yt);Mb.add(Ec.zIndex,1);Mb.add(Ec.rtl,ya.AFrameworkApplication.isRtl);Mb.add(Ec.v1p,dp.j5m);Mb.add(Ec.zjn,
Wc);Mb.add(Ec.Kun,Md);return Jb?new Eh(Mb):new Gh(Mb)}static j5m(){const Jb=dp.ewj;return Jb?Fc.a.getElementBounds(Jb):null}}dp._pageContent=null;(0,ja.a)(dp,"WordPresencePackage",null,[0,1]);var mr=v(31518),Wk=v(82497),vt=v(97938),rn=v(63684),Er=v(47675),Zr=v(54051),aq=v(19536),sm=v(9521),Xq=v(33889),qg=v(38037),pl=v(40647),Ek=v(10325),ws=v(63902);const sl=(0,oa.b)("WordEditor.RealTimeTyping.IRttEditor"),Fr=(0,oa.d)(sl),Pj=(0,oa.b)("WordEditor.IRttPerfCounter"),Aj=(0,oa.d)(Pj);class dl{constructor(Jb,
Wc){this.Fhf=Jb;this.paragraphId=Wc}get opType(){return 2}get operation(){return this.Fhf}}(0,ja.a)(dl,"RttAppliedAddParagraphOp",null,[1805]);class bq{constructor(Jb,Wc){this.BZo=Jb;this.paragraphId=Wc}get opType(){return 6}get operation(){return this.BZo}}(0,ja.a)(bq,"RttAppliedReplaceSymbolRangeOp",null,[1805]);class Zh{constructor(Jb,Wc){this.FZo=Jb;this.paragraphId=Wc}get opType(){return 1}get operation(){return this.FZo}}(0,ja.a)(Zh,"RttAppliedReplaceTextRangeOp",null,[1805]);class bk{constructor(Jb,
Wc,Md){this.a3j=Jb;this.aEe=Wc;this.q3c=Md}get opType(){return 4}get operation(){return this.a3j}get z2k(){return this.a3j.Lmc()?this.q3c:this.aEe}}(0,ja.a)(bk,"RttAppliedSplitParagraphOp",null,[1805]);class $r{constructor(){this.Nmb=new $c.a}W6f(Jb){return Jb.toString()}wYc(Jb,Wc){Jb=this.W6f(Jb);this.Nmb.fb(Jb)||this.Nmb.W(Jb,new ea.a);this.Nmb.K(Jb).add(Wc)}akg(Jb){switch(Jb.opType){case 1:var Wc=(0,R.a)(Zh,Jb);this.wYc(Wc.paragraphId,Jb);break;case 6:Wc=(0,R.a)(bq,Jb);this.wYc(Wc.paragraphId,
Jb);break;case 4:Wc=(0,R.a)(bk,Jb);this.wYc(Wc.aEe,Jb);this.wYc(Wc.q3c,Jb);break;case 2:Wc=(0,R.a)(dl,Jb),this.wYc(Wc.paragraphId,Jb)}}yio(Jb){return this.eCb(Jb)}eCb(Jb){Jb=this.W6f(Jb);if(!this.Nmb.fb(Jb))return new ea.a;const Wc=this.Nmb.K(Jb);this.Nmb.remove(Jb);for(const Md of Wc)Md.operation&&(Md.operation.uia=null);return Wc}DQm(Jb){let Wc;return({value:Wc}=this.Nmb.qc(this.W6f(Jb),Wc)).returnValue?Wc:new ea.a}Urm(Jb){for(const Wc of this.Nmb.values){if(!Wc.count)continue;if(2!==Wc.K(0).opType)continue;
const Md=Wc.K(0);if(Md.Fhf.Ofg===Jb)return Md}return null}}(0,ja.a)($r,"RttAppliedOpTracker",null,[1524]);var Fq=v(20358),jo;(function(Jb){Jb[Jb.Mem=0]="expired";Jb[Jb.uwq=1]="dried"})(jo||(jo={}));(0,ja.b)("RemoveChangeReason",jo);class xs{constructor(){this.hKa=new Fq.a}u4k(Jb){if(!Jb)return O.ULS.sendTraceTag(7685333,355,15,"Cannot add a null change to RTTStore"),!1;const Wc=Jb.kc,Md=Jb.pj;this.hKa.fb(Wc)||this.hKa.add(Wc,new Fq.a);this.hKa.K(Wc).W(Md,Jb);return this.sYl(Wc,Md)?(O.ULS.sendTraceTag(7619921,
355,15,"Detected an infinite loop in paragraph {0}, dropping the last packet!",Wc),this.hKa.K(Wc).remove(Md),!1):!0}sPf(Jb,Wc){if(!this.hKa.fb(Jb))return null;Jb=this.hKa.K(Jb);return Jb.fb(Wc)?Jb.K(Wc):null}Zbe(Jb){const Wc=new ea.a;for(const Md of this.hKa.keys){const Mb=this.hKa.K(Md);for(const pe of Mb.keys){const td=Mb.K(pe);Jb(td)&&Wc.add(td)}}return Wc}$Ij(Jb,Wc){let Md=null;({value:Md}=this.hKa.qc(Jb.kc,Md)).returnValue?(Jb.activity.dig(jo[Wc]),Md.remove(Jb.pj),Md.count||this.hKa.remove(Jb.kc)):
O.ULS.sendTraceTag(50938848,355,15,"Cannot remove an op that not exist in _changes. WordId: {0}; Reason: {1}",Jb.kc,Wc)}tvg(Jb){this.$Ij(Jb,1)}xvg(Jb){this.$Ij(Jb,0)}sYl(Jb,Wc){if(!this.hKa.fb(Jb))return!1;Jb=this.hKa.K(Jb);if(!Jb.fb(Wc))return!1;for(var Md=Jb.K(Wc);Md;){Md=Md.c8;if(Md===Wc)return!0;if(!Jb.fb(Md))break;Md=Jb.K(Md)}return!1}}(0,ja.a)(xs,"RttDataStore",null,[1522,1523]);var qp=v(36284),Yq=v(20884),af=v(41116),Gp=v(79578),cq=v(48280),dq=v(39011),$n=v(64930),an=v(41624),eq=v(13827),Uj=
v(19837),rp=v(20347);class Ih{constructor(Jb,Wc){this.ise=(Md,Mb)=>{4===this.Gs.opType?O.ULS.shipAssertTag(9204866,355,12===Mb.node.type||11===Mb.node.type,"Unexpected graph modification detected during RTT edit"):O.ULS.shipAssertTag(9204867,355,!1,"Unexpected graph modification detected during RTT edit")};this.eCb=()=>{O.ULS.shipAssertTag(9204868,355,!1,"Unexpected graph modification detected during RTT edit")};this.Rqj=()=>{O.ULS.shipAssertTag(9204869,355,!1,"Unexpected graph modification detected during RTT edit")};
this.Gs=Jb;if(this.zc=Wc)Jb=this.zc.fe(12),Jb.Bq(this.ise),Jb.kB(this.eCb),Jb.Qp(this.Rqj)}dispose(){if(this.zc){const Jb=this.zc.fe(12);Jb.DQ(this.ise);Jb.qAa(this.eCb);Jb.PV(this.Rqj)}}}(0,ja.a)(Ih,"GraphChangeValidator",null,[33]);class Ei{constructor(Jb,Wc,Md,Mb){this.id=Jb;this.cpBegin=Wc;this.cpEnd=Md;this.oyl=Mb}d0p(Jb){var Wc=this.id===Jb.id;Wc&&(Wc=this.oyl.replace("\u00a0"," "),Jb=Jb.characterData.substr(this.cpBegin,this.cpEnd-this.cpBegin).replace("\u00a0"," "),Wc=Wc===Jb);return Wc}}
(0,ja.a)(Ei,"RttOpValidator",null,[1973]);class Ho{constructor(Jb,Wc){this.uia=this.PHc=this.activity=null;this.opType=Jb;this.metadata=Wc}HSf(){return""}serialize(){return null}}(0,ja.a)(Ho,"RttOp",null,[1806]);class Rp extends Ho{constructor(Jb,Wc,Md,Mb,pe,td,Xd,jh,Th){super(Th,jh);this.kc=Jb;this.pj=Wc;this.cY=Md;this.A3=Mb;this.c8=pe;this.mGb=td;this.aM=Xd}Lgi(){return this.cY.isEqual(this.A3,!0,!1)?new Xc.a(0,this.kc,this.pj,this.cY,void 0,void 0,void 0,this.aM):new Xc.a(1,this.kc,this.pj,this.cY,
this.kc,this.pj,this.A3,this.aM)}static p$j(Jb){let Wc,Md;var Mb=Jb.IZ;if(1===Mb.oxe&&(Mb.$3a!==Mb.Oza||Mb.blb!==Mb.pGb))return O.ULS.sendTraceTag(8914769,355,15,"We received a ReplaceRange operation spanning multiple paragraphs"),Md=Wc=null,Jb=Mb=-1,{returnValue:!1,cY:Md,A3:Wc,kc:Jb,pj:Mb};if(Mb.aM)return Md=Wc=null,Jb=Mb=-1,{returnValue:!1,cY:Md,A3:Wc,kc:Jb,pj:Mb};Wc=Md=Mb.cY;1===Mb.oxe&&(Wc=Mb.A3);Jb=Mb.$3a;Mb=Mb.blb;return{returnValue:!0,cY:Md,A3:Wc,kc:Jb,pj:Mb}}}(0,ja.a)(Rp,"RttReplaceRangeOp",
Ho,[]);class qk{constructor(Jb,Wc,Md,Mb,pe,td){this.packetId=Jb;this.clientId=Wc;this.clientType=Md;this.O7j=Mb;this.packetVersion=pe;this.strictlySequentialId=td}static create(Jb){let Wc=null;null!=Jb.strictlySequentialId&&(Wc=Jb.strictlySequentialId);return new qk(Jb.packetId,Jb.clientId,Jb.client,Date.now(),Jb.version,Wc)}}(0,ja.a)(qk,"RttOpMetadata",null,[]);class An extends Ho{constructor(Jb,Wc,Md,Mb,pe,td,Xd,jh,Th){super(4,Th);this.c8=0;this.kc=Jb;this.pj=Wc;this.offset=Md;this.aM=Mb;this.ESg=
pe;this.ELg=td;this.qKe=Xd;this.FLg=jh;this.ESg===this.kc?this.c8=this.ELg:this.qKe===this.kc?this.c8=this.FLg:(O.ULS.sendTraceTag(8397766,355,10,"Bad data passed to RttSplitParagraphOp"),this.c8=0)}Lmc(){return this.kc===this.qKe}get TGp(){return this.c8}get L3p(){return this.Lmc()?this.ESg:this.qKe}get $6j(){return this.Lmc()?this.ELg:this.FLg}serialize(){const Jb=new Xc.a(3,this.kc,this.pj,this.offset,null,null,null,this.aM),Wc=new Zf(this.ESg,this.ELg,this.qKe,this.FLg);return new Wi(this.metadata.packetId,
this.metadata.clientId,1,4,Jb,null,void 0,void 0,void 0,void 0,Wc,void 0,void 0,this.metadata.strictlySequentialId)}static create(Jb){const Wc=Jb.IZ,Md=Jb.G7b;return new An(Wc.$3a,Wc.blb,Wc.cY,Wc.aM,Md.gng,Md.DLg,Md.hng,Md.GLg,qk.create(Jb))}static CXm(Jb,Wc,Md){if(1!==Jb.type)return null;const Mb=Md.d4a(Jb.Raa.characterData,Jb.Raa.ma);return new An(Jb.Raa.kc,Jb.Raa.pj,Md.gIc(Mb,Jb.Q2j),Jb.aM,Jb.FQb.kc,Jb.FQb.pj,Jb.j_c.kc,Jb.j_c.pj,Wc)}}(0,ja.a)(An,"RttSplitParagraphOp",Ho,[1525,1806]);class hn{constructor(Jb,
Wc,Md,Mb){this.KKa=Jb;this.IDh=Wc;this.hLb=Md;this.UPb=Mb;hn.Sj=qp.a.getInstance(Yq.a)}Iil(Jb,Wc,Md,Mb=null){if(Wc.isDirty)return Mb&&Mb.properties.W(hn.Swj,"1"),!1;const pe=new Ih(Jb,Wc.sj);try{if(1===Jb.opType||6===Jb.opType){const jh=(0,R.a)(Rp,Jb),Th=this.SJl(jh,Wc);var td=Th.node.characterData;const he=10<=Th.cpBegin?Th.cpBegin-10:0;let Id=Th.cpEnd+10<=td.length?Th.cpEnd+10:td.length;const Xk=td.substr(he,Th.cpBegin-he),mh=td.substr(Th.cpEnd,Id-Th.cpEnd);Id=Id+jh.mGb.length-(Th.cpEnd-Th.cpBegin);
var Xd=new Ei(Th.node.id,he,Id,Xk+jh.mGb+mh);const Rl=6===jh.opType;td="";Rl&&(td=jh.font);if(!this.jZo(Th,jh.mGb,Rl,td,Mb))return!1;let rk;rk=1===Jb.opType?new Zh(jh,Wc.id):new bq(jh,Wc.id);Wc.Uwa=Jb.c8;jh.PHc=Xd;Jb.uia=rk;Md.akg(rk)}else return 4===Jb.opType?this.Hil(Jb,Wc,Md):!1}finally{pe&&pe.dispose()}return!0}Hil(Jb,Wc,Md){const Mb=(0,R.a)(An,Jb);var pe=this.UPb.d4a(Wc.characterData,Wc.ma);pe=this.UPb.lTb(pe,Mb.offset);if(!this.l8i(Tc.a.createTextRange(Wc,0,ud.a.textLength(Wc))))return!1;var td=
(0,Bf.c)(Wc);td.Na(10);if(this.B6i(td))return!1;let Xd;td=this.hLb.Rb(3);try{td.Oa(Wc);const jh=Wc.Z7();try{const Th=(0,Bf.c)(Wc);Th.Na(10);Th.oc(11);let he=Th.currentNode;Mb.Lmc()&&(Th.Aje?he=null:(Th.TK(),he=Th.currentNode));Th.Db();const Id=this.IDh.yTb();Th.VK(Id,he,89);Th.uj(Id);Xd=Wc.clone();const Xk=Xd.Z7();try{Xd.setValue(ch.a.kc,Mb.L3p);Xd.setValue(ch.a.pj,Mb.$6j);Xd.isDirty=!1;Th.ye(Xd,2);Th.uj(Xd);this.fMl(Wc,Xd);const mh=Mb.Lmc()?Xd:Wc,Rl=Mb.Lmc()?Wc:Xd;mh.UL=!0;Rl.UL=!0;this.KKa.mxg(this.b_a(mh,
pe,ud.a.textLength(mh)),"",!1,"");this.KKa.mxg(this.b_a(Rl,0,pe),"",!1,"");Wc.Uwa=Mb.TGp;Xd.Uwa=Mb.$6j}finally{Xk&&Xk.dispose()}}finally{jh&&jh.dispose()}td.xTa()}finally{td&&td.dispose()}Wc=new bk(Mb,Wc.id,Xd.id);Jb.uia=Wc;Md.akg(Wc);return!0}B6i(Jb){const Wc=(0,Bf.c)();Wc.Ac(Jb);Wc.oc(11);return af.a.Cg(Wc)?(O.ULS.sendTraceTag(16868566,355,50,"Blocked RTT para operation: in a list"),!0):!1}Pjm(Jb,Wc,Md){var Mb=Wc.T0a(Jb.kc);if(Mb.equals(ii.a.nil))return null;Mb=Md.Ra(Mb);if(!Mb||!ud.a.gb(Mb)||!Mb.isConnected)return null;
const pe=(0,Bf.c)(Mb);if(!pe.Na(23))return null;if(Jb.DSg){Jb=Wc.T0a(Jb.DSg);if(Jb.equals(ii.a.nil))return null;Md=Md.Ra(Jb);if(!Md||!ud.a.gb(Md)||!Md.isConnected)return null;Md=(0,Bf.c)(Md);if(!Md.Na(23))return null;Md.oc(11);Md.TK();Md.Bd();if(Md.currentNode!==Mb)return null}return this.B6i(pe)?null:pe}eMp(Jb,Wc,Md,Mb){const pe=Wc.currentNode,td=this.hLb.Rb(3);try{td.Oa(pe);Wc.oc(11);const Xd=Wc.currentNode;Wc.Db();const jh=this.IDh.yTb();Wc.VK(jh,Xd,89);Wc.uj(jh);const Th=Gp.a.instance.createInstance(rp.a.paragraphNode),
he=Th.Z7();try{Th.setValue(Uj.a.uo,""),Th.a_b=!0,Mb.WBc(Th),Mb=[0],(0,cq.c)()?(Th.content.sWj(Mb),Th.content.aWj(Mb)):(Th.setValue(ch.a.GQ,Mb),Th.setValue(ch.a.G3,Mb)),Th.a_b=!1,Th.setValue(ch.a.kc,Jb.Ofg),Th.setValue(ch.a.pj,Jb.Nfg),Th.isDirty=!1,Wc.ye(Th,2),Th.UL=!0,Th.Uwa=Jb.Nfg}finally{he&&he.dispose()}td.xTa();Jb.uia=new dl(Jb,Th.id);Md.akg(Jb.uia)}finally{td&&td.dispose()}return!0}b_a(Jb,Wc,Md){return Wc===Md?Tc.a.fc(Jb,Wc):Tc.a.createTextRange(Jb,Wc,Md)}jZo(Jb,Wc,Md,Mb,pe=null){const td=Jb.node;
if(Jb.cpBegin!==Jb.cpEnd&&!this.l8i(Jb))return pe&&pe.properties.W(hn.vbk,"1"),!1;pe=this.hLb.Rb(3);try{pe.Oa(td);const Xd=td.Z7();try{td.UL=!0,this.KKa.mxg(Jb,Wc,Md,Mb)}finally{Xd&&Xd.dispose()}pe.xTa()}finally{pe&&pe.dispose()}return!0}fMl(Jb,Wc){Wc.a_b=!0;Wc.ACc(Jb.characterData);Wc.Uwa=Jb.Uwa;Wc.ma.clear();for(var Md=0;Md<Jb.ma.length;Md++){const Mb=Jb.ma.eb(Md).fwa(Wc);Wc.ma.add(Mb)}Wc.wm();if(!dq.a.qH)if(Wc.Sd.length)for(Jb=0;Jb<Wc.ma.length;Jb++){if((Md=Wc.ma.eb(Jb).formatting)&&-1!==Md.ud)for(;Wc.Sd.length<=
Md.ud;)Wc.Sd.F6(Wc.Sd.length-1,256,1),Wc.Sd.iH(Wc.Sd.length-1)}else O.ULS.sendTraceTag(9204881,355,15,"Cannot update WordRunProperties after splitting paragraph");Wc.a_b=!1}E6f(Jb){Jb=(0,Bf.c)(Jb);Jb.Na(23);Jb.Db();return{returnValue:89===Jb.role,iterator:Jb}}gwg(Jb){const Wc=(0,Bf.c)();Wc.Ac(Jb);Wc.Db();const Md=this.hLb.Rb(3);try{Md.Oa(Wc.currentNode),Jb.Pg()}finally{Md&&Md.dispose()}}pTo(Jb){if(Jb.anchor)if(({iterator:Wc}=this.E6f(Jb)).returnValue)this.gwg(Wc);else{var Wc=Jb.Cb.kk;var Md=this.hLb.Rb(3);
try{Md.Oa(Jb),Jb.Cb.QG?Jb.load((0,$n.d)(Wc).Ra(Jb.id)):Jb.load(Wc.I$(Jb.id).Fc),Jb.anchor.j3(4)}finally{Md&&Md.dispose()}}}Lyg(Jb,Wc,Md){for(let td=Wc.count-1;0<=td;td--){var Mb=Wc.K(td);switch(Mb.opType){case 4:Mb=(0,R.a)(bk,Mb);if(!Jb.id.equals(Mb.aEe)){O.ULS.shipAssertTag(9204885,355,Jb.id.equals(Mb.q3c));continue}Mb=Md.Ra(Mb.q3c);if(!Mb)break;if(!Mb||!ud.a.gb(Mb)){O.ULS.shipAssertTag(9204886,355,!1);break}if(!Mb.isConnected)continue;var pe=({iterator:Mb}=this.E6f(Mb)).returnValue;O.ULS.shipAssertTag(9204887,
355,pe);pe&&this.gwg(Mb);break;case 2:(Mb=(0,R.a)(dl,Mb),Jb.id.equals(Mb.paragraphId))?Jb.isConnected&&(pe=({iterator:Mb}=this.E6f(Jb)).returnValue,O.ULS.shipAssertTag(16820002,355,pe),pe&&this.gwg(Mb)):O.ULS.shipAssertTag(16820001,355,!1)}}}SJl(Jb,Wc){const Md=this.UPb.d4a(Wc.characterData,Wc.ma),Mb=this.UPb.lTb(Md,Jb.cY);Jb=this.UPb.lTb(Md,Jb.A3);return Mb===Jb?Tc.a.fc(Wc,Mb):Tc.a.createTextRange(Wc,Mb,Jb)}l8i(Jb){const Wc=Jb.node.ma,Md=Jb.cpBegin,Mb=Jb.cpEnd;for(let td=0;td<Wc.length;td++){const Xd=
Wc.eb(td);if(Xd.cp>=Mb)break;if(Xd.cp>=Md){if(Xd.pe)return O.ULS.sendTraceTag(8242647,355,15,"Rejected unsafe wet change: range contains comment"),!1;if(Xd.blob)return O.ULS.sendTraceTag(8242648,355,15,"Rejected unsafe wet change: range contains blob"),!1;if(dd.a?.Lc?.tw&&an.a.HO){var pe=(0,eq.e)(Jb.node)?.DG?.$db(Jb.node,Xd.cp);const jh=17===pe?.ug;jh&&!Xd.c2a?(O.ULS.sendTraceTag(506471512,324,10,`WireRangeTree found different result for whether marker at this cp is field end or not. Box4Result: ${Xd.c2a}, WireFieldCollectionResult: ${jh}`),
hn.Sj.yb({kpiName:Yq.b.slc,errorName:"RttEditor_cpIsEndOfFieldMismatch"})):hn.Sj.Jf({kpiName:Yq.b.slc});(pe=15===pe?.ug)&&!Xd.Lgb?(O.ULS.sendTraceTag(506471511,324,10,`WireRangeTree found different result for whether marker at this cp is field start or not. Box4Result: ${Xd.Lgb}, WireFieldCollectionResult: ${pe}`),hn.Sj.yb({kpiName:Yq.b.Y_d,errorName:"RttEditor_cpIsStartOfFieldMismatch"})):hn.Sj.Jf({kpiName:Yq.b.Y_d})}if(Xd.Gb||Xd.Lgb||Xd.c2a)return O.ULS.sendTraceTag(8242649,355,15,"Rejected unsafe wet change: range contains field"),
!1}}return!0}}hn.Swj="ParagraphAlreadyDirty";hn.vbk="UnsafeWetChange";(0,ja.a)(hn,"RttEditor",null,[1527]);var Hf=v(57885),Ve=v(45532),xd=v(15885),qf=v(27224);class Rd{constructor(){this.lCd=new ea.a}add(Jb){this.lCd.add(Jb);return!0}Zbe(Jb){const Wc=new ea.a;for(const Md of this.lCd)Jb(Md)&&Wc.add(Md);return Wc}tvg(Jb){Jb.activity.dig("dried");this.lCd.remove(Jb)}xvg(Jb){Jb.activity.dig("expired");this.lCd.remove(Jb)}}(0,ja.a)(Rd,"RttAddParagraphDataStore",null,[]);class Ie extends Ho{constructor(Jb,
Wc,Md,Mb,pe,td,Xd,jh){super(2,jh);this.kc=Jb;this.pj=Wc;this.c8=Md;this.DSg=Mb;this.Ofg=pe;this.Nfg=td;this.aM=Xd}serialize(){const Jb=new Xc.a(2,this.kc,this.pj,null,this.DSg,null,null,this.aM),Wc=new We(this.c8,this.Ofg,this.Nfg);return new Wi(this.metadata.packetId,this.metadata.clientId,1,3,Jb,null,void 0,void 0,Wc,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Jb){const Wc=Jb.IZ,Md=Jb.ejc;let Mb=null;null!=Jb.IZ.Oza&&(Mb=Jb.IZ.Oza);return new Ie(Wc.$3a,Wc.blb,Md.HLg,
Mb,Md.jng,Md.c8,Wc.aM,qk.create(Jb))}static yXm(Jb,Wc){return 3!==Jb.type?null:new Ie(Jb.Bza.kc,Jb.Bza.pj,Jb.H$n.pj,Jb.E3a?Jb.E3a.kc:null,Jb.PHa.kc,Jb.PHa.pj,Jb.aM,Wc)}}(0,ja.a)(Ie,"RttAddParagraphOp",Ho,[]);class cg{constructor(Jb){this.$0=Jb}zFj(){this.$0&&this.$0.properties.W(cg.Rri,"1")}LKo(Jb){this.$0&&(this.$0.properties.fb(cg.kdg)||this.$0.properties.W(cg.kdg,(Jb-this.$0.startTime).toString()))}dig(Jb){this.$0&&(this.$0.properties.W(cg.AKj,Jb),this.$0.end())}aMo(Jb){this.$0&&this.$0.properties.W(cg.cwj,
Jb.toString())}$Lo(Jb){this.$0&&this.$0.properties.W(cg.zvj,Jb)}static oYf(Jb){Jb.yba(1839802051,cg.Rri,xd.a.d5j);Jb.yba(1839802051,cg.ogm,xd.a.d5j);Jb.yba(1839802051,cg.kdg,xd.a.Jml);Jb.yba(1839802051,cg.AKj,xd.a.WEa);Jb.yba(1839802051,cg.cwj,xd.a.WEa);Jb.yba(1839802051,cg.zvj,xd.a.WEa)}static create(Jb){if(!Jb)return null;Jb=Jb.Ws(1839802051,cg.t2p);return new cg(Jb)}}cg.Rri="FailedToFindInitialParaID";cg.ogm="FailedToFindInitialTextID";cg.kdg="MsecUntilApplied";cg.AKj="RemovedBecause";cg.cwj="PacketVersions";
cg.zvj="OperationType";cg.t2p=48E4;(0,ja.a)(cg,"RttOpActivity",null,[]);var fk;(function(Jb){Jb[Jb.unknown=0]="unknown";Jb[Jb.lYr=1]="replaceTextRangeOp";Jb[Jb.Riq=2]="addParagraphOp";Jb[Jb.Ttq=3]="deleteParagraphOp";Jb[Jb.GSs=4]="splitParagraphOp";Jb[Jb.qMq=5]="mergeParagraphOp";Jb[Jb.kYr=6]="replaceSymbolRangeOp"})(fk||(fk={}));(0,ja.b)("RttOpType",fk);class hj extends Rp{constructor(Jb,Wc,Md,Mb,pe,td,Xd,jh,Th,he,Id){super(Mb,pe,td,Xd,jh,Th,he,Id,6);this.font=Jb;this.e8f=Wc}HSf(){return"OffsetStart: "+
this.cY+"OffsetEnd: "+this.A3}serialize(){const Jb=this.Lgi();return new Wi(this.metadata.packetId,this.metadata.clientId,1,7,Jb,null,this.c8,this.mGb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Jb){let Wc,Md,Mb,pe;if(!({cY:Wc,A3:Md,kc:Mb,pj:pe}=Rp.p$j(Jb)).returnValue)return null;let td,Xd;if(1===Jb.text.length)td=!1,Xd=dq.a.jC;else if(2===Jb.text.length)if(zc.a.s2f(Jb.text,0)&&zc.a.zE(Jb.text,1))td=!0,Xd=Jb.text;else return O.ULS.sendTraceTag(8914772,355,
15,"RTT symbol packet has text length 2 but is not a valid surrogate pair",Jb.operationType),null;else return O.ULS.sendTraceTag(8914773,355,15,"RTT symbol packet text is of unsupported length (length must be 1 or 2)",Jb.operationType),null;const jh=Jb.Pwd,Th=qk.create(Jb);return new hj(jh.gKg,jh.hKg,td,Mb,pe,Wc,Md,Jb.q8b,Xd,Jb.IZ.aM,Th)}}(0,ja.a)(hj,"RttReplaceSymbolRangeOp",Rp,[1525,1806]);class El extends Rp{constructor(Jb,Wc,Md,Mb,pe,td,Xd,jh){super(Jb,Wc,Md,Mb,pe,td,Xd,jh,1)}HSf(){return"OffsetStart: "+
this.cY+"OffsetEnd: "+this.A3+"TextAddedLength: "+this.mGb.length}serialize(){const Jb=this.Lgi();return new Wi(this.metadata.packetId,this.metadata.clientId,1,2,Jb,null,this.c8,this.mGb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Jb){let Wc,Md,Mb,pe;if(!({cY:Wc,A3:Md,kc:Mb,pj:pe}=Rp.p$j(Jb)).returnValue)return null;let td="";Jb.text&&(td=Jb.text);const Xd=qk.create(Jb);return new El(Mb,pe,Wc,Md,Jb.q8b,td,Jb.IZ.aM,Xd)}static oWm(Jb,Wc,Md){if(Jb.type)return null;
const Mb=Md.d4a(Jb.Raa.characterData,Jb.Raa.ma);return new El(Jb.Raa.kc,Jb.Raa.pj,Md.gIc(Mb,Jb.cpBegin),Md.gIc(Mb,Jb.cpEnd),Jb.PHa.pj,Jb.Jka,Jb.aM,Wc)}}(0,ja.a)(El,"RttReplaceTextRangeOp",Rp,[1525,1806]);class Io{constructor(Jb,Wc,Md,Mb,pe,td,Xd,jh,Th,he,Id,Xk,mh,Rl,rk,nf,Pf,bi,Bi,Z,$a){this.vD=Bi;this.EFa=Z;this.rk=null;this.u0e=this.UQh=!1;this.sGd=!0;this.GDh=0;this.zKh=this.W$e=this.BKh=this.yKh=this.AKh=!1;this.Jkg=()=>{O.ULS.sendTraceTag(7685328,355,50,"All prerequisite ready for RttManager");
this.rk=this.LR.result;O.ULS.sendTraceTag(7685330,355,50,"Subscribing to presence updates");this.rk.XR(this.LV)};this.LV=(zb,Qb)=>{if(3===Qb.type||10===Qb.type)if(10===Qb.type)this.GDh="boolean"===typeof Qb.KC?Qb.KC?1:0:Qb.KC;else if(dd.a.Ak&&!dd.a.Ak.dWf)O.ULS.sendTraceTag(508351552,355,15,"RTT channel did not get disconnected on lock release");else if(!Qb.KC)O.ULS.sendTraceTag(7685331,355,15,"RTT packet was empty");else if(!this.EFa||2!==this.vD.sA)if(this.nMo(),(zb=this.x1l(Qb.KC))&&1!==zb.metadata.clientType&&
(this.mMo(),(!this.Nu||this.Nu.mHa||Ve.a.Zyb||Ve.a.afa||Ve.a.Czb||Ve.a.Zyb||Ve.a.afa||Ve.a.Czb)&&!(this.Dmp()&&this.fqj&&2===this.fqj.Fma||2===this.GDh)))switch(this.sGd&&(this.Kgc.GFj(),this.sGd=!1),this.UQh||this.Jmn(),zb.opType){case 1:case 6:case 4:if(!({paraId:zb}=this.v4k(zb)).returnValue)break;this.mOh?this.PQj(zb):this.sak(zb);break;case 2:this.OJc.add(zb),this.qXi(zb),this.mOh?this.PQj(ii.a.nil):this.rak(zb)}};this.Lem=()=>{const zb=this.Ej.value;if(zb){var Qb=this.jK()-Io.DTo,mc=this.IJb.Zbe(Zc=>
Zc.metadata.O7j<Qb);0<mc.count&&this.MKo();var gc=new qf.a;for(const Zc of mc)if(this.IJb.xvg(Zc),Zc.uia)switch(Zc.uia.opType){case 1:gc.add(Zc.uia.paragraphId.toString());break;case 6:gc.add(Zc.uia.paragraphId.toString());break;case 4:gc.add(Zc.uia.aEe.toString()),gc.add(Zc.uia.q3c.toString())}mc=this.OJc.Zbe(Zc=>Zc.metadata.O7j<Qb);for(const Zc of mc)this.OJc.xvg(Zc),Zc.uia&&gc.add(Zc.uia.paragraphId.toString());for(const Zc of gc)(gc=zb.Ra(ii.a.Ed(Zc)))?gc.UL?(this.WOb.pTo(gc),gc.UL||this.BRc.value.UJj(gc)):
O.ULS.sendTraceTag(8765829,355,15,"Expiring wet change from paragraph with no applied changes"):O.ULS.sendTraceTag(8765828,355,15,"Expiring wet change with invalid object ID")}else this.Ej.YTi&&O.ULS.sendTraceTag(7685332,355,10,"Failed to find the IObjectSpace! Wet changes will never expire")};this.WOb=Jb;this.IJb=Wc;this.BRc=Md;this.jP=Mb;this.LR=pe;this.Ej=td;this.pb=Xd;this.jK=jh;this.UPb=Th;this.Tc=he;this.N7e=Xk;this.Sb=mh;this.mOh=Rl;this.Kgc=rk;this.zIb=nf;this.Rff=Pf;this.LTc=new ba.a(ma.a.Xg());
this.OJc=new Rd;Id.execute(Io.oYf);this.Nu=bi;$a.execute(zb=>{this.fqj=zb})}Jmn(){const Jb=new Za.a(3,2,Io.PVo,this.Lem);this.pb.vb(Jb);this.UQh=!0}init(){return this.LR?this.LR.continueWith(this.Jkg):la.Task.z$(!1)}Dmp(){return ya.AFrameworkApplication.J.getBooleanFeatureGate("Microsoft.Office.WordOnline.OcsStateManagerDependencyEnabled",!1)}x1l(Jb){Jb=re(Jb);if(!Jb)return null;switch(Jb.operationType){case 2:return El.create(Jb);case 7:return hj.create(Jb);case 4:return An.create(Jb);case 3:return Ie.create(Jb);
default:return O.ULS.sendTraceTag(8459668,355,50,"RTT packet is of unexpected operationType {0}",Jb.operationType),null}}v4k(Jb){let Wc=ii.a.nil;if(!this.IJb.u4k(Jb))return{returnValue:!1,paraId:Wc};this.qXi(Jb);if(!this.jP)return{returnValue:!1,paraId:Wc};const Md=this.jP.T0a(Jb.kc);if(Md.equals(ii.a.nil)||!this.Ej.value.Ra(Md))return Jb.activity.zFj(),{returnValue:!1,paraId:Wc};this.LFj();return{returnValue:!0,paraId:Md}}PQj(Jb){Jb.equals(ii.a.nil)||this.LTc.add(Jb.toString());this.u0e||(Jb=new Za.a(0,
1,200,()=>{this.fOp();this.u0e=!1},71),this.pb.vb(Jb),this.u0e=!0)}o6o(Jb){Jb=new Za.a(0,1,0,Jb,71);this.pb.vb(Jb)}qXi(Jb){Jb.activity=cg.create(this.Tc);Jb.activity.aMo(Jb.metadata.packetVersion);Jb.activity.$Lo(fk[Jb.opType])}fOp(){var Jb=this.OJc.Zbe(Md=>!Md.uia);for(const Md of Jb)this.rak(Md);if(this.LTc.count){Jb=null;for(var Wc of this.LTc){Wc=ii.a.Ed(Wc);Jb=this.Ej.value.Ra(Wc);break}Wc=this.Sb.Rb(3);try{Wc.Oa(Jb);for(const Md of this.LTc)this.sak(ii.a.Ed(Md))}finally{Wc&&Wc.dispose()}this.LTc.clear()}}sak(Jb){Jb=
this.Ej.value.Ra(Jb);let Wc;const Md=this.Sb.Rb(3);try{Md.Oa(Jb);Wc=this.Tc.Ws(3959281607);const Mb=this.IYh(Jb,Wc);Wc.end();Mb&&this.v8k(Mb)}finally{Md&&Md.dispose(),this.Kgc.Ctg(1),this.sGd=!0}}rak(Jb){var Wc=this.WOb.Pjm(Jb,this.jP,this.Ej.value);Wc&&(this.LFj(),this.WOb.eMp(Jb,Wc,this.zIb,(0,oa.a)(Hf.a))&&(Wc=this.Ej.value.Ra(Jb.uia.paragraphId),this.eZh(Wc,Jb),this.Kgc.Ctg(1),this.sGd=!0))}v8k(Jb){this.N7e.continueWith(()=>{if(1===Jb.opType){var Wc=this.hUm(Jb);Wc&&(this.N7e.result.Dhf(Wc),this.N7e.result.Eye(!0))}})}hUm(Jb){const Wc=
Jb.serialize();if(2!==Wc.operationType||Wc.IZ.Oza&&Wc.IZ.$3a!==Wc.IZ.Oza)return null;const Md=Jb.cY.clone();0<Jb.mGb.length&&(Md.u8h(),Md.cp+=Jb.mGb.length);Wc.operationType=0;Wc.text=null;Wc.IZ.oxe=0;Wc.IZ.cY=Md;Wc.IZ.blb=Wc.q8b;Wc.IZ.Oza=null;Wc.IZ.pGb=null;Wc.IZ.A3=null;Wc.q8b=null;return qe.ewf(Wc,this.jP,this.UPb,()=>this.Ej.value,this.Rff.instance)}eZh(Jb,Wc){return this.BRc.value?this.BRc.value.c3k(Jb,Wc.metadata.clientId).returnValue?!0:(O.ULS.sendTraceTag(7866379,355,15,"Unable to apply a wet change lock"),
!1):(O.ULS.shipAssertTag(7866378,355,!!this.BRc.value,"Unable to apply wet changes as LockManager unavailable"),!1)}HYh(Jb,Wc){this.IYh(Jb,Wc)}IYh(Jb,Wc){if(!Jb)return null;if(!Jb.anchor)return Wc&&Wc.properties.W(Io.Wmj,"1"),null;if(!Jb.hasProperty(ch.a.kc))return O.ULS.sendTraceTag(7619922,355,15,"Paragraph is missing the WordId property"),null;if(!Jb.hasProperty(ch.a.pj))return O.ULS.sendTraceTag(8197722,355,15,"Paragraph is missing the TextId property"),null;if(!ya.AFrameworkApplication.J.isChangeGateEnabled("Microsoft.Office.WordOnline.ChangeGate.OfficeVSO_9082785__StopSettingDisableRTTInParagraph")&&
Jb.hasProperty(ch.a.cli)&&Jb.getValue(ch.a.cli))return O.ULS.sendTraceTag(16815506,355,50,"RTT edit disabled in paragraph"),null;const Md=Jb.getValue(ch.a.kc);var Mb=Jb.Uwa;Wc&&(Wc.properties.W(Io.Mao,Mb.toString()),Wc.properties.W(Io.Oao,Md.toString()));Mb=this.IJb.sPf(Md,Mb);if(!Mb)return Wc&&Wc.properties.W(Io.Qmj,"1"),null;if(!this.eZh(Jb,Mb))return Wc&&Wc.properties.W(Io.ldi,"1"),null;let pe=0,td=null;for(;Mb;){if(!this.WOb.Iil(Mb,Jb,this.zIb,Wc)){Wc&&Wc.properties.W(Io.Nik,"1");break}pe++;Mb.activity.LKo(this.jK());
td=Mb;Mb=Jb.Uwa;Mb=this.IJb.sPf(Md,Mb)}0<pe&&this.oFj();Wc&&Wc.properties.add(Io.Oik,pe.toString());return td}eye(Jb){if(Jb.hasProperty(ch.a.kc)&&Jb.hasProperty(ch.a.pj)){var Wc=Jb.getValue(ch.a.kc),Md=Jb.la(ch.a.pj,0),Mb=this.Tc.Ws(1157520733),pe=this.zIb.yio(Jb.id);0<pe.count&&(this.WOb.Lyg(Jb,pe,this.Ej.value),this.ZTo(Jb,pe,Md));var td=this.zIb.Urm(Wc);if(td&&!Jb.id.equals(td.paragraphId)){const Xd=this.Ej.value;this.o6o(()=>{const jh=this.zIb.eCb(td.paragraphId),Th=Xd.Ra(td.paragraphId);O.ULS.shipAssertTag(16820032,
355,!!Th,"Could not find added graph node");Th&&(this.WOb.Lyg(Th,jh,Xd),this.OJc.tvg(td.Fhf))})}this.IJb.sPf(Wc,Md)||this.BRc.value.UJj(Jb);this.HYh(Jb,Mb);Mb.end()}}ZTo(Jb,Wc,Md){let Mb=!1;for(let td=Wc.count-1;0<=td;td--){var pe=Wc.K(td);switch(pe.opType){case 1:case 6:case 4:pe=(0,R.a)(1525,pe.operation);break;default:continue}pe.c8===Md&&(Mb=!0,pe.PHc&&!pe.PHc.d0p(Jb)&&O.ULS.sendTraceTag(8765831,355,15,"Validating wet change location failed. Type {0} OffsetInfo {1} NodeId {2} ValidatorNodeId {3} ValidatorNodeCpBegin {4} ValidatorNodeCpEnd {5}",
pe.opType,pe.HSf(),Jb.id,pe.PHc.id,pe.PHc.cpBegin,pe.PHc.cpEnd));Mb&&this.IJb.tvg(pe)}Mb&&this.oFj()}knd(Jb){const Wc=this.zIb.eCb(Jb.id);0<Wc.count&&(2===Wc.K(0).opType&&Wc.removeAt(0),this.WOb.Lyg(Jb,Wc,this.Ej.value))}UCe(Jb){var Wc=this.zIb.DQm(Jb.id);for(const Md of Wc)if(4===Md.opType&&(Wc=(0,R.a)(bk,Md),Jb.id.equals(Wc.z2k)))return!0;return!1}nMo(){this.AKh||(O.ULS.sendTraceTag(8704354,355,50,"Received a wet change"),this.AKh=!0)}mMo(){this.yKh||(O.ULS.sendTraceTag(8185606,355,50,"Received a wet change that we could deserialize"),
this.yKh=!0)}LFj(){this.BKh||(O.ULS.sendTraceTag(17147533,355,50,"Received a usable wet change"),this.BKh=!0)}oFj(){this.W$e||(O.ULS.sendTraceTag(8185607,355,50,"Successfully applied a wet change"),this.W$e=!0)}MKo(){this.W$e||this.zKh||(O.ULS.sendTraceTag(8185608,355,15,"Failed to apply any wet changes so far"),this.zKh=!0)}static oYf(Jb){const Wc=[3959281607,1157520733];for(const Md of Wc)Jb.yba(Md,Io.Oik,xd.a.WEa),Jb.yba(Md,Io.Qmj,xd.a.WEa),Jb.yba(Md,Io.Wmj,xd.a.WEa),Jb.yba(Md,Io.ldi,xd.a.WEa),
Jb.yba(Md,Io.Nik,xd.a.WEa),Jb.yba(Md,hn.Swj,xd.a.WEa),Jb.yba(Md,hn.vbk,xd.a.WEa);cg.oYf(Jb)}}Io.PVo=6E4;Io.DTo=18E4;Io.Oik="WetChangeCount";Io.Qmj="NoChangesToApply";Io.Wmj="NodeNotConnected";Io.ldi="CouldNotGetLock";Io.Nik="WetChangeBlocked";Io.Oao="NodeWordId";Io.Mao="NodeTextId";(0,ja.a)(Io,"RttManager",null,[1526]);const ep=(0,oa.b)("WordEditor.RealTimeTyping.RttManager"),gf=(0,oa.d)(ep);class km{constructor(Jb,Wc){this.tPj=0;this.mo=Jb;this.o4o=Wc}GFj(){this.tPj=this.mo()}Ctg(Jb){const Wc=this.mo()-
this.tPj;0<=Wc&&this.o4o.track(Math.round(Wc),0===Jb?"CTB":"RTP")}}(0,ja.a)(km,"RttPerfCounter",null,[1528]);var Jj=v(91328);class el{constructor(){this.kVc=new Jj.a}$8k(Jb,Wc){this.kVc.back()&&Wc&&this.kVc.back().Ubb(Jb)||this.kVc.enqueue(Jb)}ZOm(){return this.kVc.isEmpty?null:this.kVc.dequeue()}}(0,ja.a)(el,"RttSendDataStore",null,[1529]);var lm=v(44353);class Yj extends Ho{constructor(Jb,Wc,Md,Mb){super(3,Mb);this.kc=Jb;this.pj=Wc;this.aM=Md}get c8(){return 0}serialize(){const Jb=new Xc.a(4,this.kc,
this.pj,null,null,null,null,this.aM);return new Wi(this.metadata.packetId,this.metadata.clientId,1,5,Jb,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Jb){const Wc=Jb.IZ;return new Yj(Wc.$3a,Wc.blb,Wc.aM,qk.create(Jb))}static zXm(Jb,Wc){return 4!==Jb.type?null:new Yj(Jb.Enc.kc,Jb.Enc.pj,Jb.aM,Wc)}}(0,ja.a)(Yj,"RttDeleteParagraphOp",Ho,[1525,1806]);class am extends Ho{constructor(Jb,Wc,Md,Mb,pe,td,Xd,jh){super(5,jh);this.CSg=Jb;this.Z6j=Wc;this.K3p=
Md;this.UGp=Mb;this.aM=pe;this.qjk=td;this.jGc=Xd}get kc(){return this.CSg}get pj(){return this.Z6j}get c8(){return this.CSg===this.qjk?this.jGc:0}serialize(){const Jb=new Xc.a(5,this.CSg,this.Z6j,null,this.K3p,this.UGp,null,this.aM),Wc=new zf(this.qjk,this.jGc);return new Wi(this.metadata.packetId,this.metadata.clientId,1,6,Jb,null,void 0,void 0,void 0,Wc,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Jb){const Wc=Jb.IZ,Md=Jb.Nkd;return new am(Wc.$3a,Wc.blb,Wc.Oza,Wc.pGb,
Wc.aM,Md.ing,Md.jGc,qk.create(Jb))}static AXm(Jb,Wc){return 2!==Jb.type?null:new am(Jb.Bza.kc,Jb.Bza.pj,Jb.E3a.kc,Jb.E3a.pj,Jb.aM,Jb.ype.kc,Jb.ype.pj,Wc)}}(0,ja.a)(am,"RttMergeParagraphOp",Ho,[1525,1806]);const lj={vo:"RttSendManagerFeatureUsage",featureName:"RttSendManager",Bj:"wordfx",vr:null,ru:Ca.a[Ca.a.RealTimeCoauth]};class ko{constructor(Jb,Wc,Md,Mb,pe,td){this.NVc=this.Di=null;this.hna=!1;this.Ddf=this.JOh=0;this.SSd=this.UPh=!1;this.$9e=0;this.fnb=null;this.Xb=Object.assign({},{extendedProperties:new Map});
this.Jkg=()=>{O.ULS.sendTraceTag(8245954,355,50,"All prerequisites ready for RttSendManager");this.Di=this.LR.result;this.Di.Sxe(this)};this.ssj=(Xd,jh)=>{if(this.Di&&!this.lvn()&&2===this.Di.connectionState&&(Xd=jh.KG,Xd.length))if(jh.Hda)100>this.Ddf&&(this.Ddf++,O.ULS.sendTraceTag(8270467,355,50,"Blocking send. Reason: {0} OverallSends: {1} OverallBlocked: {2}",jh.wol,this.JOh,this.Ddf));else{for(jh=0;jh<Xd.length;jh++)if(!this.vMn(Xd[jh]))return;for(jh=0;jh<Xd.length;jh++){const Th=Xd[jh];this.GJh.$8k(Th,
!Th.type&&!jh)}this.NVc||this.Xrj(this.NVc,this.Di)}};this.LR=Jb;this.GJh=Wc;this.Oec=Md;this.vz=Mb;this.VDa=pe;this.Kgc=td;this.Fb=qp.a.getInstance(lj)}get i8i(){return!!ya.AFrameworkApplication.J?.$("RttSendManagerKpiLoggingIsEnabled")||!1}get Cm(){return this.Oec.value}init(){this.i8i&&this.Fb.od({kpiName:"Initialization",Jh:Q.b.FailureBased});if(this.LR)return this.LR.continueWith(this.Jkg);this.i8i&&(this.fnb=lm.a.Aea(16,20),this.Xb.extendedProperties.set("RttSendManagerInitializationCallStack",
this.fnb),this.Fb.yb({kpiName:"Initialization",errorName:"FailedToInitialize",Eb:{Xb:this.Xb}}));return la.Task.z$(!1)}start(){this.hna||(this.vz.nc?(this.vz.nc.KG.fcl(this.ssj),this.hna=!0):O.ULS.sendTraceTag(522740420,355,10,"No activePage, RttSendManager not started"))}stop(){this.hna&&(this.hna=!1,this.vz.nc.KG.lXo(this.ssj))}lvn(){return this.Cm&&this.Cm.mH.Ugb?!0:!1}vMn(Jb){return Jb&&-1!==Jb.aM?Jb.type&&3!==Jb.type&&1!==Jb.type?!1:!0:!1}g_n(){this.SSd||(this.UPh||(O.ULS.sendTraceTag(8270468,
355,50,"Preparing to send RTT change"),this.UPh=!0),!this.SSd&&5>=this.$9e&&this.$9e++)}t_n(){!this.SSd&&5>=this.$9e&&(O.ULS.sendTraceTag(8270469,355,50,"Sent Rtt Message"),this.SSd=!0)}Xrj(Jb,Wc){this.g_n();Jb&&(Jb.Xi||Jb.lp)&&O.ULS.sendTraceTag(8245956,355,15,"Task is faulted or cancelled with exception {0}",Jb.exception);this.Kgc.GFj();(Jb=this.BXm(this.GJh.ZOm()))?(this.JOh++,this.NVc=Wc.gH(3,yg(Jb.serialize())),this.t_n(),this.Kgc.Ctg(0),this.NVc.continueWith(Md=>{this.Xrj(Md,Wc)})):this.NVc=
null}BXm(Jb){if(!Jb)return null;if(!this.Cm)return O.ULS.sendTraceTag(8245957,355,15,"GetParagraphAnchoredOpFromGraphTransactionOperation: CoAuth manager is null"),null;const Wc=new qk(Ep.instance.aIi(),this.Cm.Rk,1,0,0,uc.instance.mPm());let Md=null;switch(Jb.type){case 0:Md=El.oWm(Jb,Wc,this.VDa);break;case 4:Md=Yj.zXm(Jb,Wc);break;case 3:Md=Ie.yXm(Jb,Wc);break;case 2:Md=am.AXm(Jb,Wc);break;case 1:Md=An.CXm(Jb,Wc,this.VDa)}return Md}}(0,ja.a)(ko,"RttSendManager",null,[202]);const Is=(0,oa.b)("WordEditor.RealTimeTyping.RttSendManager"),
Tn=(0,oa.d)(Is);var Ta=v(42982);class Ib{constructor(){this.FMm=()=>Ic.a.Uc()&&Ic.a.Uc().Ak?Ic.a.Uc().Ak:(O.ULS.sendTraceTag(7866377,304,15,"Unable to get the lock manager"),null)}get name(){return"WordEditor.RealTimeTyping"}configure(Jb){const Wc=ha.a.Xs((0,oa.f)(Zr.a)),Md=ha.a.Xs((0,oa.f)(aq.a)),Mb=ha.a.Xs((0,oa.f)(mr.a)),pe=ha.a.Xs((0,oa.f)(ob.a)),td=ha.a.Xs((0,oa.f)(sm.a)),Xd=new $h.a;la.Task.WAA.call(null,Wc,Md,Mb,pe,td).continueWith(()=>{Jb.ia("WordEditor.RealTimeTyping.IRttEditor",()=>new hn((0,oa.a)(Xq.a),
(0,oa.a)(qg.a),Xd,(0,oa.a)(Hg.a))).fa();Jb.register(km,"WordEditor.RttPerfCounter").as("WordEditor.IRttPerfCounter").fa().jd(()=>new km(Fc.a.Pd,Wk.a.QP(17,1,new vt.a(new rn.a(.25)))));Jb.ia("WordEditor.RealTimeTyping.RttManager",()=>new Io((0,oa.a)(Fr),new xs(Er.a.instance),new Pa.a(this.FMm),(0,oa.a)(ws.a),(0,oa.a)(tb).vF(),new Pa.a(()=>ec.a.ua().Ea&&ec.a.ua().Ea.nc?ec.a.ua().Ea.nc.ic:(O.ULS.sendTraceTag(522740419,304,10,"No activePage or workspace."),null)),Cc.TaskManager.instance,()=>Date.now(),
(0,oa.a)(Hg.a),Er.a.instance,(0,oa.f)(mr.a),$s.vF(),Xd,ya.AFrameworkApplication.J.$("WordEditorThrottleAndBatchRTTRendering"),(0,oa.a)(Aj),new $r,(0,oa.f)(ac),(0,oa.a)(pl.a),(0,oa.a)(lg.a),(0,oa.a)(Ek.a).EFa,(0,oa.f)(Ta.a))).as("WordEditor.RealTimeTyping.IRttManager").fa();Jb.ia("WordEditor.RealTimeTyping.RttSendManager",()=>new ko((0,oa.a)(tb).vF(),new el,new Pa.a(()=>Ic.a.Uc()),ec.a.ua().Ea,(0,oa.a)(Hg.a),(0,oa.a)(Aj))).fa();this.dka()})}dka(){(0,oa.a)(gf).init();(0,oa.a)(Tn).init()}init(){}dispose(){}static main(){sa.a.instance.Wc(new Ib)}}
(0,ja.a)(Ib,"WordEditorRealTimeTypingPackage",null,[0,1]);Type.registerNamespace("BPr");Type.registerNamespace("Box4.Presence");Type.registerNamespace("RealtimePresenceUI");Type.registerNamespace("WERTT");Type.registerNamespace("WordEditor.PeoplesWellControl");Type.registerNamespace("WordEditor.Presence");null!=ya.AFrameworkApplication.J&&ya.AFrameworkApplication.J.getBooleanFeatureGate("Microsoft.Office.WordOnline.LoadRtcFrom1JS",!1)?v.e(31).then(v.bind(v,30736)).then(Jb=>Jb.qmn()):Type.registerNamespace("AppRealtimeChannel");
Type.registerNamespace("Common.App.CoauthTelemetry");mb.main();Type.registerNamespace("Common.App.CollabControls");rc.prototype.toString=hb.a.prototype.toString;sb.prototype.toString=hb.a.prototype.toString;sa.a.instance.Wc(new dp);Ib.main();Type.registerNamespace("RealtimePresenceUI");sa.a.instance.Wc(new ng);Type.registerNamespace("Common.App.RtcHostNotificationSubscription");kb.main()},80293:function(ia,Ua,v){v.d(Ua,{a:function(){return ya}});ia=v(34622);class ya extends Sys.EventArgs{constructor(ja,
oa){super();this.newState=ja;this.oldState=oa}}(0,ia.a)(ya,"ChangedConnectionStateEventArgs",Sys.EventArgs,[])},56059:function(ia,Ua,v){v.d(Ua,{a:function(){return ya}});ia=v(34622);class ya extends Sys.EventArgs{constructor(ja,oa){super();this.clientInfo=ja;this.k6a=oa}}(0,ia.a)(ya,"ClientInfoEventArgs",Sys.EventArgs,[])},74948:function(ia,Ua,v){v.d(Ua,{a:function(){return ya}});ia=v(34622);class ya extends Sys.EventArgs{constructor(ja){super();this.MJ=ja}}(0,ia.a)(ya,"MyPresenceUpdatedEventArgs",
Sys.EventArgs,[])},74396:function(ia,Ua,v){v.d(Ua,{a:function(){return ya}});ia=v(34622);class ya extends Sys.EventArgs{constructor(ja){super();this.ztb=ja}}(0,ia.a)(ya,"PersistentStateClearedEventArgs",Sys.EventArgs,[])},50511:function(ia,Ua,v){v.d(Ua,{a:function(){return ya}});ia=v(34622);class ya extends Sys.EventArgs{constructor(ja,oa){super();this.type=ja;this.fma=oa}}(0,ia.a)(ya,"PersistentStateUpdateEventArgs",Sys.EventArgs,[])},47454:function(ia,Ua,v){v.d(Ua,{a:function(){return ya}});ia=
v(34622);class ya{constructor(){this.Presence=null;this.TimeStamp=0}}(0,ia.a)(ya,"PresenceDataEntryForClients",null,[])},38146:function(ia,Ua,v){v.d(Ua,{a:function(){return ya}});ia=v(34622);class ya extends Sys.EventArgs{constructor(ja,oa){super();this.fma=ja;this.x4c=oa}}(0,ia.a)(ya,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},43520:function(ia,Ua,v){v.d(Ua,{a:function(){return ya}});ia=v(34622);class ya extends Sys.EventArgs{constructor(ja,oa=null){super();this.yl=ja;this.Q0k=oa}get type(){return this.yl}get KC(){return this.Q0k}}
(0,ia.a)(ya,"UpdateNotificationEventArgs",Sys.EventArgs,[])},88442:function(ia,Ua,v){v.d(Ua,{a:function(){return ya}});ia=v(34622);class ya{constructor(ja,oa){this.status=ja;this.fxc=oa}}(0,ia.a)(ya,"UserStatusInfo",null,[])},22800:function(ia,Ua,v){v.d(Ua,{a:function(){return J}});ia=v(34622);var ya=v(23335),ja=v(67795),oa=v(6439),z=v(97815),D=v(59529),d=v(25651),t=v(54952),k=v(80070),r=v(50612),x=v(33703),u=v(41370);class w{constructor(){this.fbd=this.qkd=this.rkd=this.ukd=0;this.Egb=!1;this.correlationId=
this.oA=this.p0=this.XSb=this.errorMessage=null}get rtf(){return this.XSb+"?"+this.p0}}(0,ia.a)(w,"FindSessionResponse",null,[]);class C{constructor(O,K,R,E,X,U){this.q9=null;this.s8e=O;O=String.format("{0}={1}","ClientId",x.a.Ti(E));O=String.format("{0}&{1}={2}",O,"usid",x.a.Ti(X));O=String.format("{0}&{1}={2}",O,"UserApp",x.a.Ti(R.toString()));O=String.format("{0}&{1}={2}",O,"UserType",x.a.Ti("1"));O=String.format("{0}&{1}={2}",O,"UserVersion",x.a.Ti(K));O=String.format("{0}&{1}={2}",O,"clientProtocol",
x.a.Ti(C.ZCl));(K=C.A8c(R,U))&&(O=String.format("{0}&{1}",O,K));this.vRe=O}K4b(){this.q9=this.s8e()}generate(){this.q9&&""!==this.q9||(this.K4b(),ya.ULS.sendTraceTag(575784194,500,this.q9&&""!==this.q9?50:15,"Query signature delegate called for refresh returned: {0} ",this.q9));var O=this.q9;D.AFrameworkApplication.J?.getBooleanFeatureGate("Microsoft.Office.WordOnline.ShouldTrimWdtfFromFindSession",!1)&&(O=d.a.removeParameter("?"+O,"wdtf").slice(1));O=String.format("{0}={1}","qs",x.a.Ti(O));return String.format("{0}&{1}",
O,this.vRe)}static A8c(O,K){return 4===O?String.format("{0}={1}","NoAuth","1"):K?K.sTf():null}}C.ZCl="1.0";(0,ia.a)(C,"FindSessionQueryStringGenerator",null,[]);var B=v(39018),G=v(10528),H=v(35531),I=v(93311),M=v(76701);class J{constructor(O,K,R,E,X,U,Q,la,h,W,ba,ma,qa=null){this.bRc=(new Date(0)).getTime();this.PRc=0;this.y9a=!1;this.QVc=null;this.J4b=36E5;this.Kta=J.Jdd;this.wLa=0;this.lla=null;this.yY=0;this.BAa=this.A1c=null;this.n9e="enabled errorMessage url connectionString queryString throttling_globalMaxNumberOfOutstandingMessages throttling_maxNumberOfOutstandingMessages throttling_timeToWaitForResponse throttling_messageDelay".split(" ");
this.m9e=["enabled","errorMessage"];this.oA=this.sfa=null;this.HKb=new C(ba?ba:()=>D.AFrameworkApplication.Hj,X,U,Q,O,K);this.JKa=ma;this.vd=E;this.mg=K;this.gOc=R;this.Yj=la;this.Kd=h;this.xCa=qa;this.hOc=!1;this.ydb=9E4;W&&W.execute(ea=>{(0,M.a)()?ea.fEa(()=>{ya.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",this.Yj);this.HKb.K4b()}):ea.eEa(()=>{ya.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",this.Yj);this.HKb.K4b()})});
2>=100*Math.random()&&(this.J4b=3E5);B.a.instance&&(B.a.instance.Y7c=this.J4b)}HDg(O){this.BAa=O}init(){this.Kd.cjf((0,ja.a)(this,this.Pxg,"resetGetMachineIdDelay"));this.Kd.D5((0,ja.a)(this,this.xM,"onConnectionStateChanged"))}xM(O,K){this.yY=K.newState;2===K.newState&&(this.wLa=0)}K9c(){const O=this.lla.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.lla.p0,J.vmc,x.a.Ti(O)),correlationId:O}}vRf(O,K,R,E,X){this.WAg(()=>{E(X,"GetMachineIdSuccess")&&(ya.ULS.sendTraceTag(17956951,
500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",this.oA,this.Yj),O(this.QVc),R(this.RSf()))},U=>{E(X,"GetMachineIdFailure")&&(ya.ULS.sendTraceTag(4060129,500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.Yj),K(U))},E,X)}UAf(){this.M0c();this.jYf()}WAg(O,K,R,E){ya.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",this.oA);if(this.oA)O();else{var X=this.zpf();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(O,
K,R,E)},X)}}sendFindSessionRequestToServerInternal(O,K,R,E){R(E,"RequestMachineId")&&(this.bRc=(new Date).getTime(),R=t.a.Pd(),this.IWb(X=>{const U=t.a.Pd();this.tod(X);this.C6b();O();X=t.a.Pd()-U;ya.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",X)},X=>{const U=t.a.Pd();this.M0c();B.a.instance&&B.a.instance.zu(2,3);K(X);X=t.a.Pd()-U;ya.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",X)},!1),R=t.a.Pd()-R,ya.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",
R))}jYf(){this.Kta+=J.YOf;this.Kta=Math.min(this.Kta,J.Cbg)}zpf(){var O=(new Date).getTime();O=this.bRc+this.Kta-O;0>O&&(O=0);return O}tod(O){try{this.lla=O,this.sfa=O.rtf,this.oA=O.oA,this.A1c=O.p0,this.QVc=O.XSb}catch(K){ya.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",K.toString())}}M0c(){this.oA=null;this.N0c()}C6b(){this.N0c();this.y9a=!0;this.PRc=window.setTimeout((0,ja.a)(this,this.bug,"refreshMachineId"),this.J4b)}N0c(){this.y9a&&
(window.clearTimeout(this.PRc),this.y9a=!1)}bug(){this.y9a=!1;this.IWb(O=>{const K=this.A1c!==O.p0,R=this.oA!==O.oA,E=this.oA;this.tod(O);0!==this.yY&&(R?(ya.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",E||"null",O.oA),this.Kd.ojb()):(this.Kd.Wsg(K,R),this.C6b()))},()=>{B.a.instance&&B.a.instance.zu(2,3);this.C6b()},!0)}Pxg(){this.Kta=J.Jdd}RSf(){return new I.a(this.lla.ukd,this.lla.rkd,this.lla.qkd,this.lla.fbd)}oNg(O){if(Object.getType(O)!==
Object)return null;for(const K in O);return this.awf(O)}awf(O){if(!("enabled"in O))return null;const K=O.enabled;var R=K?this.n9e:this.m9e;for(const E of R)if(!(E in O))return null;R=Object.assign(new w,{Egb:O.enabled,errorMessage:O.errorMessage,correlationId:u.a.create().toString()});K&&(R.XSb=O.url,R.p0=O.queryString,R.oA=O.connectionString,R.fbd=O.throttling_globalMaxNumberOfOutstandingMessages,R.qkd=O.throttling_maxNumberOfOutstandingMessages,R.rkd=O.throttling_timeToWaitForResponse,R.ukd=O.throttling_messageDelay);
return R}VMf(O,K){ya.ULS.sendTraceTag(50448152,500,50,"Using FindSessionUtils find session response");this.xCa.s8d.continueWith(()=>{this.xCa.s8d.result?(ya.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),O(this.xCa.t8d)):(ya.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),K(this.xCa.t8d))})}esd(O,K,R,E,X=!1){return U=>{G.a.instance.VSa(0,1);O&&O.stop();this.JKa=this.BAa=null;this.Fjd(U.data,!0,K);var Q=H.a.deserialize(U.data.responseData,
"FindSession",null);if(Q)if(Q=this.oNg(Q)){if(Q.Egb&&Q.p0&&Q.oA){ya.ULS.sendTraceTag(4317446,500,50,"Successfully retrieved MachineId from server for [{0}]",this.Yj);this.g$f(U.data);R(Q);return}K.FindSessionFailureReason="FindSessionInvalidResponse";K.IsRtcEnabled=Q.Egb;K.IsQueryStringEmpty=!Q.p0;K.IsConnectionStringEmpty=!Q.oA;ya.ULS.sendTraceTag(4290720,500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",
this.Yj,Q.Egb,!Q.p0,!Q.oA)}else K.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",ya.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.Yj);else K.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",ya.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",this.Yj);this.bqd(K,X);E(null)}}asd(O,K,R,E=!1){return X=>{G.a.instance.VSa(0,1);O&&O.stop();this.JKa=this.BAa=null;this.Fjd(X.data,
!1,K);let U=null;var Q="unknown";let la="unknown";X.data&&((Q=X.data.pk)&&J.zAa in Q&&null!=Q[J.zAa]&&(U=Q[J.zAa].toString()),Q=k.a[X.data.status],la=X.data.vf.toString());K.FindSessionFailureReason="FindSessionRequestFailed";K.HttpErrorCode=la;K.HttpErrorStatus=Q;K[J.zAa]=U;ya.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",Q,la,this.Yj,U,E);this.bqd(K,E);R(la)}}IWb(O,K,R=!1){let E=null;ya.ULS.sendTraceTag(4317445,
500,50,"Getting MachineId from server for [{0}]",this.Yj);const X={};var U=this.HKb.generate();X["X-CorrelationId"]=u.a.create().toString();this.BAa&&""!==this.BAa?U=String.format("{0}&{1}={2}",U,"rr",this.BAa):this.JKa&&""!==this.JKa&&(U=String.format("{0}&{1}={2}",U,"rr",this.JKa),X["RTC-TokenProofkey"]="True",X["RTC-IsWacJsBootFsRequest"]="True");U=this.gOc+"?"+U;R&&(X.FSType="polling");const Q={};Q.IsNetworkOfflineBeforeSendRequest=this.mg.fHa;Q.HasAvailableConnectionsBeforeSendRequest=this.mg.JVf;
Q.MaxConnectionsAllowed=this.mg.maxConnections;Q.IsRefreshMachineId=R;this.xCa&&!this.hOc?(this.VMf(this.esd(null,Q,O,K,R),this.asd(null,Q,K,R)),this.hOc=!0):(this.vd&&(E=this.vd.Df("WebServiceCall","GetMachineIdFromTheServer")),B.a.instance&&B.a.instance.zu(2,0),0>this.mg.PYa(U,1,null,X,[J.ncb,J.zAa,J.cSa,J.Q5b,J.msEdgeRef,J.officeFE,J.$ld],1,this.esd(E,Q,O,K,R),this.asd(E,Q,K,R),null,!1,null,this.ydb,"3",null,!0)&&(5<this.wLa&&200>this.wLa&&ya.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",
this.wLa),window.setTimeout(()=>{this.wLa++;K("-1")},1E3)))}Fjd(O,K,R){R||(R={});R.IsNetworkOfflineAfterRequestComplete=this.mg.fHa;R.IsRequestSucceeded=K;O&&(R.EnqueueTime=O.AFa,R.InvokedTime=O.ES,R.CompletedTime=O.TZ,O.pk&&(J.ncb in O.pk&&(R.CorrelationId=O.pk[J.ncb]),J.cSa in O.pk&&(R[J.cSa]=O.pk[J.cSa])));ya.ULS.sendTraceTag(38633565,500,K?50:15,H.a.lra(R))}bqd(O,K){O||(O={});O.ConnectionState=z.a[this.yY];K||this.Kd.aqd(1,O)}g$f(O){try{var K=!1,R=!1,E=O.pk,X=d.a.v_(O.request.get_url());if(E&&
J.Q5b in E){const W=E[J.Q5b].toString().toLocaleLowerCase();R="true"===W;K="false"===W}E=!1;const h=0<=X.toLocaleLowerCase().indexOf("collab");R&&!h?E=!0:K&&h&&(E=!0);if(E){K={HostName:X};K.Status=k.a[O.status];K.HttpStatus=O.vf.toString();var U=O.request.get_headers();for(const W in U){var Q=U[W];(R=W)&&0<R.length&&(X=0,Q&&(X=Q.toString().length),K["r_"+R]=X)}if(O.pk){const W=new oa.a;W.add(J.ncb);W.add(J.cSa);W.add(J.zAa);W.add(J.officeFE);W.add(J.$ld);W.add(J.msEdgeRef);J.Uhf(K,O.pk,W)}J.Ohf(O.request.get_url(),
K);var la=r.a.toJSON(K);ya.ULS.sendTraceTag(559437006,500,15,la)}}catch(h){ya.ULS.sendTraceTag(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",h.toString())}}static createInstance(O,K,R,E,X,U,Q,la,h,W,ba,ma=null){return J.uwf(O,K,R,E,X,U,Q,la,h,W,null,ba,ma)}static uwf(O,K,R,E,X,U,Q,la,h,W,ba,ma,qa=null){O=O||u.a.create().toString();O=new J(O,K,R,E,X,U,Q,la,h,W,ba,ma,qa);O.init();return O}static Uhf(O,K,R){for(const E of R)E in K&&(O[E]=K[E])}static Ohf(O,K){if(O){var R=O.indexOf("?");if(-1!==
R)for(O=O.substr(R+1).split("&"),R=0;R<O.length;++R){var E=O[R].split("=");if(2===E.length){const X=E[0];if(X&&0<X.length){let U=0;if(E=E[1])U=E.length;K["q_"+X]=U}}}}}}J.YOf=3E3;J.Cbg=3E5;J.Jdd=1E3;J.ncb="X-CorrelationId";J.vmc="corrid";J.zAa="RtcErrorCode";J.cSa="X-OfficeCluster";J.Q5b="X-NewEnv";J.msEdgeRef="X-MSEdge-Ref";J.$ld="X-OFFICEFD";J.officeFE="X-OfficeFE";(0,ia.a)(J,"FindSessionStrategy",null,[1096])},39018:function(ia,Ua,v){v.d(Ua,{a:function(){return t}});ia=v(34622);var ya=v(23335),
ja=v(67795),oa=v(50612),z;(function(k){k[k.SendNotification=0]="SendNotification";k[k.SendPersistentState=1]="SendPersistentState";k[k.FindSession=2]="FindSession";k[k.WebSocket=3]="WebSocket";k[k.Oru=4]="ServerSent";k[k.LongPolling=5]="LongPolling";k[k.Nru=6]="ForeverFrame";k[k.Last=7]="Last"})(z||(z={}));(0,ia.b)("ApiType",z);var D;(function(k){k[k.AttemptCount=0]="AttemptCount";k[k.SuccessCount=1]="SuccessCount";k[k.DropCount=2]="DropCount";k[k.FailedCount=3]="FailedCount";k[k.LatencyOverThresholdCount=
4]="LatencyOverThresholdCount";k[k.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";k[k.ThrottledCount=6]="ThrottledCount";k[k.Last=7]="Last"})(D||(D={}));(0,ia.b)("EventCountType",D);var d=v(10528);class t{constructor(k){this.y1c=this.o7c=null;this.skd=this.Y7c=0;this.Dk=null;this.JRc=this.UMb=0;this.mg=k;this.LYf();this.zKb=this.jOc=this.cNb=!1;this.v9a=0}get YEf(){return this.zKb}qIg(k){this.JRc=k;window.setInterval((0,ja.a)(this,this.j1b,"logMetricsBatchAndReset"),k);this.UMb=(new Date).getTime()}zu(k,
r){this.eFg(k)&&!this.jOc||this.YEf||!window.navigator.onLine||this.mg.fHa||(this.Dk[k][r]++,this.cNb=!0,2!=k&&this.Dk[this.Kru][r]++)}LYf(){this.Dk=Array(7);for(let k=0;7>k;k++){this.Dk[k]=Array(7);for(let r=0;7>r;r++)this.Dk[k][r]=0}}Nof(){const k={};for(let r=0;7>r;r++)for(let x=0;7>x;x++)this.t6f(r,x)&&(k[z[r]+D[x]]=this.Dk[r][x]);k.FSDomain=this.o7c;k.ConnectionDomain=this.y1c;k.FSRetryInterval=this.Y7c;k.MaxPayloadSize=this.skd;k.LogNumber=this.v9a;1===this.v9a&&(k.FSLatencies=d.a.instance.UMf(),
k.ConLatencies=d.a.instance.eLf());return k}t6f(k,r){return 2===k&&3!==r&&0!==r?!1:!0}eFg(k){return 2===k?!1:!0}j1b(){if(this.cNb){this.v9a++;if((new Date).getTime()-this.UMb<5E3+this.JRc){var k=oa.a.toJSON(this.Nof());ya.ULS.sendTraceTag(50644352,500,15,k)}this.UMb=(new Date).getTime();for(k=0;7>k;k++)for(let r=0;7>r;r++)this.Dk[k][r]=0;this.cNb=!1}}ibg(){this.jOc=!0}static get instance(){return t._instance}static create(k){t.instance||(t._instance=new t(k));return t.instance}}t._instance=null;(0,ia.a)(t,
"FrequentLoggingMetrics",null,[1095])},10528:function(ia,Ua,v){v.d(Ua,{a:function(){return ya}});ia=v(34622);class ya{constructor(){this.IWc=!1;this.AMa=null;this.iMc=0;this.GKb=this.p3c(6);this.F7a=this.p3c(6);this.dha=this.bua=0;this.getCurrentTime=()=>new Date}get AJg(){return this.IWc}p3c(ja){ja=Array(ja);for(let oa=0;oa<ja.length;oa++)ja[oa]=0;return ja}UMf(){return this.GKb.toString()}eLf(){return this.F7a.toString()}rIg(){this.AMa=this.getCurrentTime()}VSa(ja,oa,z=!1){this.AJg||(z&&(this.IWc=
!0),z=this.getCurrentTime(),0===ja&&5<this.bua||1===ja&&5<this.dha||(this.iMc<ja?(1===this.bua%2&&(this.GKb[this.bua]=-1,this.bua++),this.iMc=ja,1===oa&&(this.F7a[this.dha]=-1,this.dha++),this.F7a[this.dha]=this.M7b(z),this.dha++):0===ja?(this.GKb[this.bua]=this.M7b(z),this.bua++):(this.F7a[this.dha]=this.M7b(z),this.dha++)))}M7b(ja){const oa=ja.getTime()-this.AMa.getTime();this.AMa=ja;return oa}static get instance(){ya._instance||(ya._instance=new ya);return ya._instance}static set instance(ja){ya._instance=
ja}}ya._instance=null;(0,ia.a)(ya,"LatencyMetrics",null,[])},58115:function(ia,Ua,v){v.d(Ua,{a:function(){return sa}});ia=v(34622);var ya=v(23335),ja=v(67795),oa=v(37307),z=v(28569),D=v(97815),d=v(29550),t=v(59529),k=v(88442),r=v(25651),x=v(10528);class u{constructor(Aa,ka){this.data=Aa;this.timeStamp=ka}}(0,ia.a)(u,"PresenceData",null,[]);var w=v(39610),C=v(13116);class B{constructor(){this.CIb=this.uKc=!1;this.BIb=0;this.WIb=this.pPb=this.oPb=this.uIb=!1;this.IKb=0;this.jVc=!1;this.iVc=this.hVc=
0;this.QOb=!1;this.UOb=this.SOb=this.VOb=this.ROb=0;this.TOb=!1}get Cmf(){return this.CIb}get Bmf(){return this.BIb}get YWh(){return this.uIb}get xFg(){return this.oPb}get yFg(){return this.pPb}get Trf(){return this.WIb}get ydb(){return this.IKb}get kzg(){return this.jVc}get Lsd(){return this.hVc}get jzg(){return this.iVc}get hzg(){return this.QOb}get izg(){return this.ROb}get Qsd(){return this.VOb}get Msd(){return this.SOb}get Osd(){return this.UOb}get Nsd(){return this.TOb}static createInstance(Aa){return Aa?
Object.assign(new B,{uKc:Aa.$("AwayStatusManagerIsEnabled"),CIb:Aa.$("AwayStatusOneMinuteTimeoutIsEnabled"),BIb:Aa.Ab("AwayCoauthorThresholdMs",9E5),uIb:Aa.$("RtcAllowCrossDomainAccessEnabled"),oPb:Aa.$("ShouldLogOnContentNotification"),pPb:Aa.$("ShouldLogOnHostSubscriptionNotification"),WIb:Aa.$("RtcClientMetricsEnabled"),IKb:Aa.Ab("RtcFindSessionRequestTimeoutInMS",6E4),jVc:Aa.$("RtcJsClientFrequentlyLogsMetrics"),hVc:Aa.Ab("RtcJsClientFrequentMetricsLatencyThresholdInMS",1E3),iVc:Aa.Ab("RtcJsClientFrequentMetricsLogIntervalInMS",
3E5),QOb:Aa.$("RtcClientMessageTelemetryEnabled"),ROb:Aa.Ab("RtcClientMessageTelemetrySampleSize",5),VOb:Aa.Ab("RtcSendTelemetryMessageIntervalInMS",3E5),SOb:Aa.Ab("RtcLogClientMessageMetricsTimeOutInMs",2E4),UOb:Aa.Ab("RtcMaxPayloadSizeInCharactersOverride",C.a.E1b),TOb:Aa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RTCLogSignalrHeartBeatMessages",!1)}):Object.assign(new B,{uKc:!1,CIb:!1,BIb:9E5,uIb:!1,oPb:!1,pPb:!0,WIb:!1,IKb:9E4,QOb:!1,ROb:5,VOb:3E5,SOb:2E4,UOb:C.a.E1b,TOb:!1})}}(0,ia.a)(B,
"RealtimeChannelSettings",null,[1087]);var G=v(52172),H=v(93311);class I{constructor(Aa,ka=""){this.oLa=this.dNa=0;this.YLb=!1;this.sva=this.eab=null;this.yua=!1;this.LVc=Aa;this.lxd=ka;this.setTimeout=I.dUb;this.Yha=this.dNa=this.oLa=0}C4b(){0<this.Yha&&0<this.oLa&&ya.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.lxd,this.oLa,this.Yha);0<this.Yha&&0<this.dNa&&ya.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",
this.lxd,this.dNa,this.Yha)}get Lya(){return this.YLb}qkb(Aa,ka){this.dNa++;this.fOa(!0);this.YLb=!0;this.eab=Aa;this.sva=ka}fOa(Aa){this.YLb=!1;this.sva&&Aa&&(this.oLa++,this.sva.markAsCancelled());this.sva=this.eab=null}static dUb(Aa,ka){return window.setTimeout(Aa,ka)}}(0,ia.a)(I,"ThrottlerBase",null,[]);class M{constructor(){this.VKc=this.fJb=!1;this.callback=null}ZBb(Aa){this.callback=Aa;this.Vxd()}jkd(Aa){this.fJb||(this.fJb=!0,this.mRe=Aa,this.Vxd())}Vxd(){this.fJb&&this.callback&&!this.VKc&&
(this.VKc=!0,this.callback(this.mRe))}}(0,ia.a)(M,"CompletionTask",null,[]);class J{constructor(){this.lSc=new M;this.jSc=new M}wib(Aa){this.lSc.ZBb(Aa)}vib(Aa){this.jSc.ZBb(Aa)}MRa(Aa){this.lSc.jkd(Aa)}Kaa(Aa){this.jSc.jkd(Aa)}markAsCancelled(){this.MRa(2);this.Kaa(2)}}(0,ia.a)(J,"MessageStatus",null,[1349]);class O extends I{constructor(Aa,ka=""){super(Aa,ka);this.v3a=0;this.pBg=()=>{if(this.Lya){const ha=this.eab,mb=this.sva;this.fOa(!1);this.uTa(ha,mb)}};this.XLa=(new Date(0)).getTime();this.currentTime=
()=>(new Date).getTime()}init(Aa){this.yua||(this.v3a=Aa,this.yua=!0)}add(Aa){this.yua||this.init(O.T3c);this.Yha++;const ka=this.currentTime(),ha=new J;this.XLa>ka&&(this.XLa=ka);this.Lya?(this.fOa(!0),this.qkb(Aa,ha)):this.XLa+this.v3a<=ka?this.uTa(Aa,ha):(this.qkb(Aa,ha),this.setTimeout(this.pBg,this.XLa+this.v3a-ka));return ha}uTa(Aa,ka){this.XLa=this.currentTime();Aa=this.LVc(Aa);Aa.wib(ha=>{ka.MRa(ha)});Aa.vib(ha=>{ka.Kaa(ha)})}static createInstance(Aa,ka=""){return new O(Aa,ka)}}O.T3c=200;
(0,ia.a)(O,"MaxRateThrottler",I,[1348,1347]);class K extends I{constructor(Aa,ka=""){super(Aa,ka);this.s3a=this.Psa=0;this.na=new G.a;this.xua=!1;this.Q7a=this.G7a=this.XPb=0;this.rBg=()=>{this.xua=!1;if(this.Lya){const ha=this.eab,mb=this.sva;this.fOa(!1);this.uTa(ha,mb)}};this.Pjg=()=>{++this.Q7a;this.Q7a>Math.floor(this.s3a/2)&&(this.Q7a=-1E9,this.na.raiseEvent("TMUDM"))};this.H9a=0;this.hU=[];this.clearTimeout=K.bUb}add(Aa){this.yua||this.init(K.Z3c,K.W3c);this.Yha++;const ka=new J;this.Lya?this.qkb(Aa,
ka):this.H9a<this.s3a?this.uTa(Aa,ka):(this.qkb(Aa,ka),this.xua=!1);return ka}uTa(Aa,ka){Aa=this.LVc(Aa);const ha=this.setTimeout(this.Pjg,this.Psa);++this.H9a;Array.add(this.hU,ha);const mb=this.G7a;Aa.wib(na=>{ka.MRa(na)});Aa.vib(na=>{this.G7a===mb&&(this.Ojg(mb,ha),ka.Kaa(na))})}Ojg(Aa,ka){this.G7a===Aa&&(--this.H9a,this.clearTimeout(ka),Array.remove(this.hU,ka),this.Lya&&this.qBg())}qBg(){this.Lya&&!this.xua&&(this.XPb=this.setTimeout(this.rBg,0),this.xua=!0)}Sab(Aa){this.na.addHandler("TMUDM",
Aa)}Brd(Aa){this.na.removeHandler("TMUDM",Aa)}reset(){this.Yha=this.dNa=this.oLa=this.Q7a=0;++this.G7a;for(const Aa of this.hU)this.clearTimeout(Aa);this.H9a=0;this.hU=[];this.fOa(!0);this.xua&&(this.clearTimeout(this.XPb),this.XPb=0,this.xua=!1)}init(Aa,ka){this.yua||(this.Psa=Aa,this.s3a=ka,this.yua=!0)}static createInstance(Aa,ka=""){return new K(Aa,ka)}static bUb(Aa){window.clearTimeout(Aa)}}K.Z3c=15E3;K.W3c=5;(0,ia.a)(K,"MaxOutstandingThrottler",I,[1346,1347]);class R{constructor(Aa){this.Zd=
null;this.eh=!1;this.na=new G.a;this.$Mb=new d.a;this.ZMb=new d.a;this.YPb=Aa;this.gua=this.YPb.Y2c(ka=>ka.send(),"GlobalMaxOustandingThrottler");this.gua.Sab(()=>{this.na.raiseEvent("TMUDM")})}init(Aa){this.eh||(this.Zd=Aa,this.gua.init(this.Zd.Psa,this.Zd.KTf),this.eh=!0)}PSf(Aa){this.eh||this.init(new H.a(O.T3c,K.Z3c,K.W3c,R.Ibg));if(!({value:ka}=this.$Mb.qc(Aa)).returnValue){if(!({value:ka}=this.ZMb.qc(Aa)).returnValue){var ka="MaxOutstandingThrottler-"+Aa;ka=this.YPb.Y2c((0,ja.a)(this.gua,this.gua.add,
"add"),ka);ka.init(this.Zd.Psa,this.Zd.Hbg);ka.Sab(()=>{this.na.raiseEvent("TMUDM")});this.ZMb.add(Aa,ka)}const ha="MaxRateThrottler-"+Aa;ka=this.YPb.Cwf((0,ja.a)(ka,ka.add,"add"),ha);ka.init(this.Zd.ncg);this.$Mb.add(Aa,ka)}return ka}reset(){for(const Aa of this.$Mb)Aa.value.C4b();for(const Aa of this.ZMb)Aa.value.C4b(),Aa.value.reset();this.gua.C4b();this.gua.reset()}Sab(Aa){this.na.addHandler("TMUDM",Aa)}Brd(Aa){this.na.removeHandler("TMUDM",Aa)}}R.Ibg=1E3;(0,ia.a)(R,"ThrottlerManager",null,[1093]);
class E{constructor(Aa){this.E9=!1;this.eNa=0;this.iJb=!1;this.L$f=()=>{ya.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",this.Yj)};this.setTimeout=E.dUb;this.clearTimeout=E.bUb;this.$$f=this.L$f;this.Yj=Aa}uig(){this.E9||(this.eNa=this.setTimeout(()=>{this.E9=!1;this.Gjd()},8E3),this.E9=!0,this.iJb=!1)}Fig(){this.K5()}blg(){this.Gjd()}Gjd(){this.K5();this.iJb||(this.iJb=!0,this.$$f())}K5(){this.E9&&this.clearTimeout(this.eNa);this.eNa=0;this.E9=!1}static dUb(Aa,
ka){return window.setTimeout(Aa,ka)}static bUb(Aa){window.clearTimeout(Aa)}}(0,ia.a)(E,"ConnectedUsageKpiLogger",null,[1092]);class X{constructor(){this.wqd=this.t4b;this.zqd=this.w4b;this.yqd=this.v4b;this.Bqd=this.y4b;this.Aqd=this.x4b;this.D4b=this.E4b;this.sjb=this.B4b;this.dla=this.z4b;this.kAa=this.A4b;this.xqd=this.u4b;this.YRa=this.W1b;this.$hb=this.X1b}t4b(){}w4b(){}v4b(){}y4b(){}x4b(){}B4b(){}A4b(){}z4b(){}E4b(){}u4b(){}W1b(){}X1b(){}}(0,ia.a)(X,"NoopRealtimeChannelMetrics",null,[1088,511]);
class U{constructor(Aa){this.Nq=Aa}Lug(Aa){this.Nq.on("presenceUpdated",Aa)}Sug(Aa){this.Nq.on("updateNotification",Aa)}Kug(Aa){this.Nq.on("persistentStateUpdated",Aa)}Jug(Aa){this.Nq.on("persistentStateCleared",Aa)}NOg(Aa){this.Nq.off("presenceUpdated",Aa)}ROg(Aa){this.Nq.off("updateNotification",Aa)}MOg(Aa){this.Nq.off("persistentStateUpdated",Aa)}LOg(Aa){this.Nq.off("persistentStateCleared",Aa)}xHc(Aa){return this.Nq.invoke("UpdatePresence",Aa)}ema(Aa){return this.Nq.invoke("UpdateClientInfo",
Aa)}gH(Aa,ka){return this.Nq.invoke("SendUpdateNotification",Aa,ka)}g9c(Aa){return this.Nq.invoke("GetCompletePersistentStateWithMetadata",Aa)}updatePersistentState(Aa,ka){return this.Nq.invoke("UpdatePersistentState",Aa,ka)}}(0,ia.a)(U,"RealtimeChannelProxy",null,[1089,1090,1091]);var Q=v(52078),la=v(8693);class h{constructor(Aa){this.Xha=null;this.yY=0;this.oja=!1;this.Kd=Aa;this.Kd.D5((0,ja.a)(this,this.xM,"onConnectionStateChanged"))}xM(Aa,ka){this.yY=ka.newState}Knd(){ya.ULS.sendTraceTag(18637070,
500,15,"Too many undelivered messages. Restarting RTC connection.");this.Kd.ojb()}uYf(Aa){this.Xha.init(Aa)}}(0,ia.a)(h,"ARtcMessageHandler",null,[]);var W=v(36284),ba=v(47454),ma=v(50612);class qa{constructor(Aa,ka=""){this.fPb=Aa;this.J1=ka}send(){return this.fPb()}get messageId(){return this.J1}}(0,ia.a)(qa,"MessageHandler",null,[1350]);class ea extends Sys.EventArgs{constructor(Aa,ka,ha,mb){super();this.j5b=Aa;this.reconnectDelay=ka;this.reason=ha;this.wtd=mb}}(0,ia.a)(ea,"RefreshConnectionReconnectArgs",
Sys.EventArgs,[]);var Ga=v(41541);class da{constructor(){this.CPb=this.ki=null}get jj(){return this.ki?this.CPb?this.CPb.getTime()-this.ki.getTime():(new Date).getTime()-this.ki.getTime():0}start(){this.ki=new Date}stop(){this.CPb=new Date}}(0,ia.a)(da,"SimpleStopwatch",null,[]);var ra=v(3739),Ka=v(21513),Pa=v(87488),Da=v(35531);class Ra extends h{constructor(Aa,ka,ha,mb,na,va,Cb,wb,gb,Wa){super(Cb);this.Nq=null;this.THh=this.dDd=this.FRc=!1;this.J1=0;this.bOb=new w.a;this.C1e=Ra.rLf();this.MNb=t.AFrameworkApplication.J.ya("OwningFeatureCrewForRtcNotificationKpis");
this.Zd=Aa;this.NSc=this.MSc=0;this.Xha=ka;this.Xha.Sab((0,ja.a)(this,this.Knd,"onTooManyUndeliveredMessages"));this._clientId=ha;this.p8e=na;this.Kd.bjf((0,ja.a)(this,this.ynd,"onRefreshProxyRequired"));this.Kd.$if((0,ja.a)(this,this.xnd,"onRefreshAllPersistentStateRequest"));this.Kd.fjf((0,ja.a)(this,this.gH,"sendUpdateNotification"));this.Kd.Fif((0,ja.a)(this,this.Xmd,"onInternalPresenceUpdated"));this.Kd.Gif((0,ja.a)(this,this.Ymd,"onInternalUpdateNotificationReceived"));this.Kd.Eif((0,ja.a)(this,
this.Wmd,"onInternalPersistentStateUpdated"));this.Kd.Dif((0,ja.a)(this,this.Vmd,"onInternalPersistentStateCleared"));this.Kd.ejf((0,ja.a)(this,this.eJa,"sendPersistentState"));this.Kd.ljf((0,ja.a)(this,this.ema,"updateClientInfo"));this.vd=va;this.Yj=mb;this.Dk=wb;this.Mx=gb;this.cMa=Wa;this.oca=(0,la.a)(String,t.AFrameworkApplication.Hc.Application)||""}ynd(Aa,ka){this.Nq=this.p8e(ka.hubConnection);this.Xha.reset();this.Nq.Lug((0,ja.a)(this,this.eY,"onPresenceUpdated"));this.Nq.Kug((0,ja.a)(this,
this.Oka,"onPersistentStateUpdated"));this.Nq.Jug((0,ja.a)(this,this.O3a,"onPersistentStateCleared"));this.Nq.Sug((0,ja.a)(this,this.LV,"onUpdateNotificationReceived"))}xM(Aa,ka){this.yY=ka.newState;2===ka.newState&&this.eBg()}eBg(){for(const Aa of this.bOb)this.gH(null,new Ga.a(Aa.key,Aa.value,!1,new oa.a));this.bOb=new w.a}xnd(Aa,ka){ka.HSb();for(Aa=0;3>Aa;++Aa)this.XAg(Aa,ka)}XAg(Aa,ka){try{this.Nq.g9c(Aa).done(ha=>{ka.KBa(ka.connectionToken,"GetCompletePresenceSuccess")&&(ka.Xtf.blg(),ya.ULS.sendTraceTag(3249540,
500,50,"Successfully retrieved complete session state for [{0}] of type [{1}]",this.Yj,Aa),this.Kd.Vsg(),this.qkg(Aa,ha),this.Kd.Jsg(ha),ka.F6c.fb(Aa)&&this.Kd.cqd(Aa,ka.F6c.K(Aa),new oa.a))}).fail(ha=>{ka.KBa(ka.connectionToken,"GetCompletePresenceFail")&&(ya.ULS.sendTraceTag(3249541,500,15,"Failed to retrieve complete session state : {0} for [{1}] of type [{2}]",Da.a.lra(ha),this.Yj,Aa),this.Kd.ojb())}).always(()=>{ka.XA&&ka.XA.stop()})}catch(ha){ya.ULS.sendTraceTag(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",
ka.connectionToken,ha.message)}}eJa(Aa,ka){Aa=ka.MJ;let ha;const mb=ka.k6a;this.Mx.zu(1,0);try{ha=Da.a.ASb(Aa,this.cMa)}catch(Cb){this.Mx.zu(1,3);ya.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",Cb.message);mb.setException(Cb);return}const na=new d.a;na.W(this._clientId,Object.assign(new ba.a,{Presence:Aa,TimeStamp:(new Date).getTime()}));this.Kd.eqd(ka.type,na);if(2!==this.yY)this.Dk.dla(),this.Mx.zu(1,2),mb.setResult(null);else{var va=
this.J1.toString();++this.J1;Aa=new qa(()=>this.fBg(ka.type,ha,va),va);Aa=this.kxd(0,ka.type).add(Aa);Aa.wib(Cb=>{2===Cb&&(this.Mx.zu(1,6),this.dDd||2!==ka.type||ya.ULS.sendTraceTag(508651234,500,15,"First persistent state update of type LiveMeeting for [{0}] was throttled",this.Yj));mb.setResult(null)});Aa.vib(()=>{})}}fBg(Aa,ka,ha){let mb=null;const na=new da,va=new J;ya.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}] of type [{1}]",this.Yj,Aa);if(2!==this.yY)return this.Dk.dla(),
this.Mx.zu(1,2),ya.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}] of type [{1}]",this.Yj,Aa),va.markAsCancelled(),va;this.vd&&20>this.MSc&&(mb=this.vd.Df("WebServiceCall","Send Presence Message"),this.MSc++);na.start();va.MRa(1);try{this.Nq.updatePersistentState(Aa,ka).done(()=>{this.Dk.sjb();this.Mx.zu(1,1);ya.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}] of type [{2}]",ha,this.Yj,Aa);2===Aa&&(this.dDd=
!0);va.Kaa(1);na&&(na.stop(),na.jj>this.Zd.Lsd?this.Mx.zu(1,4):this.Mx.zu(1,5))}).fail(Cb=>{this.oja||(this.Dk.dla(),this.Mx.zu(1,3),this.dDd||2!==Aa||ya.ULS.sendTraceTag(508651233,500,15,"First persistent state update of type LiveMeeting for [{0}] failed",this.Yj),ya.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",ha,Da.a.lra(Cb),this.Yj));va.Kaa(2)}).always(()=>{mb&&mb.stop()})}catch(Cb){ya.ULS.sendTraceTag(593072906,500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",
Cb.message),this.Mx.zu(1,3),this.dDd||2!==Aa||ya.ULS.sendTraceTag(508651232,500,15,"First persistent state update of type LiveMeeting for [{0}] hit an exception",this.Yj),va.Kaa(2)}return va}ema(Aa,ka){Aa=ka.clientInfo;const ha=ka.k6a;let mb;try{mb=Da.a.ASb(Aa,this.cMa)}catch(na){ya.ULS.sendTraceTag(544318999,500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",na.message);ha.setException(na);return}try{this.Nq.ema(mb).done(()=>{ya.ULS.sendTraceTag(544319E3,500,50,
"Successfully delivered clientInfo.")}).fail(na=>{this.oja||ya.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",Da.a.lra(na));ha.setResult(null)})}catch(na){ya.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",na.message),ha.setResult(null)}}gH(Aa,ka){const ha=ka.type;Aa=ka.KC;const mb=ka.Dzf,na=ka.k6a;let va;16!==ha&&17!==ha&&this.Mx.zu(0,0);try{va=Da.a.ASb(Aa,this.cMa)}catch(wb){16!==ha&&17!==ha&&this.Mx.zu(0,
3);ya.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",wb.message);na.setException(wb);return}if(2!==this.yY)mb?this.bOb.W(ha,Aa):(this.Dk.dla(),16!==ha&&17!==ha&&this.Mx.zu(0,2)),na.setResult(null);else{var Cb=this.J1.toString();++this.J1;ka=new qa(()=>this.vBg(ha,va,Cb),Cb);ka=this.kxd(1,ha).add(ka);ka.wib(wb=>{2===wb&&16!==ha&&17!==ha&&this.Mx.zu(0,6);na.setResult(null)});ka.vib(()=>{})}}vBg(Aa,ka,ha){let mb=null;const na=new da,
va=new J;ya.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}] of type [{1}]",this.Yj,Aa);if(2!==this.yY)return this.Dk.dla(),this.Mx.zu(0,2),ya.ULS.sendTraceTag(7934172,500,15,"Connection is lost - unable to send the message for [{0}]",this.Yj),va.markAsCancelled(),va;this.vd&&3===Aa&&20>this.NSc&&(mb=this.vd.Df("WebServiceCall","Send WetContent Update"),this.NSc++);na.start();va.MRa(1);this.Nq.gH(Aa,ka).done(()=>{this.Dk.sjb();this.Mx.zu(0,1);ya.ULS.sendTraceTag(3249506,500,
50,"Successfully delivered update notification message [{0}] for [{1}] of type [{2}]",ha,this.Yj,Aa);va.Kaa(1);na&&(na.stop(),na.jj>this.Zd.Lsd?this.Mx.zu(0,4):this.Mx.zu(0,5))}).fail(Cb=>{this.oja||(this.Dk.dla(),this.Mx.zu(0,3),ya.ULS.sendTraceTag(3249507,500,15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",ha,Da.a.lra(Cb),this.Yj));va.Kaa(2)}).always(()=>{mb&&mb.stop()});return va}ZQ(){this.Nq.NOg((0,ja.a)(this,this.eY,"onPresenceUpdated"));this.Nq.MOg((0,ja.a)(this,
this.Oka,"onPersistentStateUpdated"));this.Nq.LOg((0,ja.a)(this,this.O3a,"onPersistentStateCleared"));this.Nq.ROg((0,ja.a)(this,this.LV,"onUpdateNotificationReceived"))}Vzf(){this.Mxg();this.Kd.LIa((0,ja.a)(this,this.xM,"onConnectionStateChanged"));this.Kd.zwg((0,ja.a)(this,this.ynd,"onRefreshProxyRequired"));this.Kd.xwg((0,ja.a)(this,this.xnd,"onRefreshAllPersistentStateRequest"));this.Kd.Dwg((0,ja.a)(this,this.gH,"sendUpdateNotification"));this.Kd.kwg((0,ja.a)(this,this.Xmd,"onInternalPresenceUpdated"));
this.Kd.lwg((0,ja.a)(this,this.Ymd,"onInternalUpdateNotificationReceived"));this.Kd.jwg((0,ja.a)(this,this.Wmd,"onInternalPersistentStateUpdated"));this.Kd.iwg((0,ja.a)(this,this.Vmd,"onInternalPersistentStateCleared"));this.Kd.Cwg((0,ja.a)(this,this.eJa,"sendPersistentState"));this.Kd.Fwg((0,ja.a)(this,this.ema,"updateClientInfo"))}Xmd(Aa,ka){this.eY(ka.fma,ka.x4c)}eY(Aa){this.Dk.kAa();this.Oka(0,Aa)}Wmd(Aa,ka){this.Oka(ka.type,ka.fma)}qkg(Aa,ka){const ha={};for(const mb in ka)ha[mb]=ka[mb].Presence;
this.ond(Aa,ha,ka)}Oka(Aa,ka){this.Dk.kAa();this.ond(Aa,ka)}ond(Aa,ka,ha=null){if(ya.ULS.Q7(500,100))for(var mb in ka);delete ka[this._clientId];if(!ma.a.isEmpty(ka)){for(var na in ka)mb=na,ka[mb]=Da.a.deserialize(ka[na],"Presence",mb,!1,this.cMa);na=new d.a;mb=(new Date).getTime();for(const Cb in ka){var va=ka[Cb];const wb=Cb;let gb;ha?(gb=ha[wb],gb.Presence=va):gb=Object.assign(new ba.a,{Presence:va,TimeStamp:mb});na.W(wb,gb)}this.Kd.eqd(Aa,na);switch(Aa){case 0:this.FRc||(ya.ULS.sendTraceTag(4539734,
500,50,"Raising first presence update notification for [{0}]",this.Yj),this.FRc=!0,t.AFrameworkApplication.Rf&&t.AFrameworkApplication.Rf.kij());this.Kd.$pd(ka,[]);break;case 2:this.THh||(ya.ULS.sendTraceTag(508867081,500,50,"Raising first live meeting update notification for [{0}]",this.Yj),this.THh=!0);this.Kd.hxe(Aa,ka);break;default:this.Kd.hxe(Aa,ka)}}}Vmd(Aa,ka){this.O3a(ka.ztb)}O3a(Aa){this.Dk.kAa();if(ya.ULS.Q7(500,100))for(let ka=0;ka<Aa.length;++ka);Aa.length&&(this.Kd.Ysg(Aa),this.Kd.Ssg(Aa),
this.Kd.$pd({},Aa))}Ymd(Aa,ka){this.LV(ka.type,ka.KC)}LV(Aa,ka=null){this.Zd.xFg&&0===Aa&&ya.ULS.sendTraceTag(40128990,500,50,"Received ContentUpdate notification from the server");if(0===Aa&&this.MNb&&0<this.MNb.length){const ha=W.a.getInstance({vo:"ContentUpdateNotificationReceived",featureName:"RtcNotification",Bj:this.MNb,vr:Pa.a[Pa.a.RealTimeCoauth]});ha&&ha.od(this.C1e)}this.Zd.yFg&&13===Aa&&ya.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",
ka||"<none>"));this.Dk.kAa();5===Aa?(ka=(Aa=this.Nng(ka))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",Aa.reason,Aa.reconnectDelay):"Received client reconnection request from the server without params.",ya.ULS.sendTraceTag(18637071,500,50,ka),this.Kd.ojb(Aa)):(ka=Da.a.deserialize(ka,String.format("UpdateNotification-{0}",ra.a[Aa]),null,!1,this.cMa),this.Kd.Xsg(Aa,ka))}Nng(Aa){try{if(!Aa||""===Aa)return null;const ka=JSON.parse(Aa);return new ea(ka.rr,
ka.rbp,ka.rd,ka.sa)}catch(ka){return ya.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",ka.message),null}}kxd(Aa,ka){return this.Xha.PSf(this.QSf(Aa,ka))}QSf(Aa,ka){return Aa+","+ka}Mxg(){this.Xha.reset();this.Xha.Brd((0,ja.a)(this,this.Knd,"onTooManyUndeliveredMessages"))}static rLf(){var Aa=new Map;Aa.set("SkipAria","True");Aa=Object.assign({},{extendedProperties:Aa});return{kpiName:"ContentUpdateNotificationReceived",Jh:Ka.b.FailureBased,Eb:Aa,Chm:3E5}}}(0,ia.a)(Ra,"RtcMessageHandler",
h,[]);class Ba{Y2c(Aa,ka=""){return K.createInstance(Aa,ka)}Cwf(Aa,ka=""){return O.createInstance(Aa,ka)}}(0,ia.a)(Ba,"ThrottlerFactory",null,[1094]);var Ia=v(39018),ta=v(59385),Ca=v(6439);class za{constructor(Aa){this.messageId=Aa;this.sBg=(new Date).getTime();this.K0b=new Ca.a}}(0,ia.a)(za,"MessageLatencyDetails",null,[]);class pa{constructor(Aa,ka,ha){this.xW=null;this.VMb=this.gPb=0;this.sendMessage=()=>{if(this.UMa){const mb=ta.a.create().toString();this.xW=new za(mb);this.Kd.l4b(16,mb,!1,new oa.a);
window.setTimeout(()=>{this.A$f(mb)},this.VMb)}};this.rtg=(mb,na)=>{16===na.type?this.Kd.l4b(17,na.KC,!1,new oa.a):17===na.type&&this.UMa&&na.KC&&this.processMessage(na.KC)};this.Zd=ka;this.mSc=ha;this.UMa=!1;this.Kd=Aa;this.Kd.XR(this.rtg)}start(){if(this.mSc&&!this.UMa){const Aa=this.Zd.Qsd;this.VMb=this.Zd.Msd;Aa<=this.VMb?(ya.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",
this.Zd.Qsd,this.Zd.Msd),this.mSc=!1):(this.UMa=!0,this.gPb=window.setInterval(this.sendMessage,Aa))}}A$f(Aa){this.xW&&this.xW.messageId===Aa&&(0<this.xW.K0b.count?(Aa=this.xW.K0b.toArray().join(","),ya.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",Aa)):ya.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),this.xW=null)}stop(){this.gPb&&(window.clearInterval(this.gPb),this.UMa=!1)}processMessage(Aa){Aa&&this.xW&&Aa.toString()===this.xW.messageId&&(Aa=(new Date).getTime()-
this.xW.sBg,this.xW.K0b.add(Aa))}static get instance(){return pa._instance}static gxb(Aa,ka,ha){return pa.instance||(pa._instance=new pa(Aa,ka,ha))}}pa._instance=null;(0,ia.a)(pa,"ClientToClientMessageTelemetry",null,[]);class sa{constructor(Aa,ka,ha,mb,na,va,Cb,wb,gb,Wa,vb,Za){this.BPb=!1;this.eK=null;this.gB=new d.a;this.aCa=1;this.Gma=null;this.xm=!1;this.Fec=(new Date(0)).getTime();this.mrb=0;this.fwd=()=>{const Sa=this.aCa;this.BPb=!1;this.Dk.wqd();this.sca.vRf(this.Vtf,this.Imd,(0,ja.a)(this.V3,
this.V3.uYf,"initThrottlerManager"),(0,ja.a)(this,this.KBa,"verifyConnectionToken"),Sa)};this.Imd=(Sa=null)=>{this.Dk.yqd();let ub=null;!Sa||"documentsessiondeleted"!==(ub=Sa.toLowerCase())&&"documentsessionexpired"!==ub?this.WOa():(ya.ULS.sendTraceTag(508396225,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",this.Yj,Sa),this.disconnect())};this.WOa=(Sa,ub=null)=>{ya.ULS.sendTraceTag(508396224,500,50,"Disconnecting the connection [{0}]",
this.eK);Sa=(Sa=2===this.Zj||1===this.Zj)&&!this.V3.oja;let ab=!0,Ya=0;ub&&Object.getType(ub)!==Object.getType(Sys.EventArgs.Empty)&&ub.j5b&&""!==ub.j5b&&(Sa=!0,this.sca.HDg(ub.j5b),ab=ub.wtd,Ya=ub.reconnectDelay);this.mg.fHa&&(ab=!1);Sa&&this.xM(1,this.Zj);++this.aCa;this.V3.ZQ();this.PIg(ab);this.sca.UAf();this.c3c();Sa&&window.setTimeout(this.fwd,Math.min(Ya,3E4))};this.Byd=()=>{let Sa=null;const ub=({correlationId:Sa}=this.sca.K9c()).returnValue;this.Gma.qs=ub;ya.ULS.sendTraceTag(40768457,500,
50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.Yj,Sa)};this.Vtf=Sa=>{this.Fec=(new Date).getTime();let ub=null;this.Gma.qs=({correlationId:ub}=this.sca.K9c()).returnValue;this.Zd.YWh&&(this.Gma.url=Sa,Ia.a.instance&&(Ia.a.instance.y1c=r.a.v_(Sa)));let ab=null;this.vd&&(ab=this.vd.Df("WebServiceCall","ConnectToServer"));ya.ULS.sendTraceTag(3290048,500,50,"Connecting to server for client [{0}]",this.Yj);Sa={};this.sXc&&(Sa.transport=1===this.sXc.length?this.sXc[0]:
this.sXc);Sa.pingInterval=null;x.a.instance.VSa(1,0);Sa.waitForPageLoad=!1;this.Gma.start(Sa,null).done(Ya=>{this.Dk.zqd();x.a.instance.VSa(1,1,!0);ya.ULS.sendTraceTag(508396195,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",Ya.id,ub)}).fail(Ya=>{ya.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1},  ClientDetails: [{2}]",this.sca.oA,ub,this.Yj);this.Imd();this.Dk.xqd(Ya);x.a.instance.VSa(1,1,!1);this.Kd.aqd(0,
{CorrelationId:ub,ErrorDetails:Ya,ConnectionState:D.a[this.Zj]})}).always(()=>{ab&&ab.stop();Ia.a.instance&&(Ia.a.instance.zKb=!1)})};this.Nnd=(Sa,ub)=>{for(const ab of ub.xQg)this.gB.fb(ab.key)||this.gB.W(ab.key,new w.a),Sa=ab.value,this.gB.K(ab.key).W(ub.type,new u(Sa.Presence,new Date(Sa.TimeStamp))),ab.key===this._clientId&&0===ub.type&&this.Kd.Osg(Sa.Presence)};this.Mnd=(Sa,ub)=>{for(const ab of ub.ztb)this.gB.remove(ab)};this.HSb=()=>{let Sa;const ub=[];({value:Sa}=this.gB.qc(this._clientId)).returnValue&&
this.gB.remove(this._clientId);for(const ab of this.gB.keys)Array.add(ub,ab);for(const ab of ub)this.gB.remove(ab);Sa&&this.gB.W(this._clientId,Sa);this.Kd.Lsg(ub)};this._clientId=Aa;this.sXc=ka;this.Zj=0;this.vd=mb;this.hJb=wb;this.Y9e=Cb;this.eNe=gb;this.tRe=na;this.sca=va;this.Yj=ha;this.Dk=Wa;this.Zd=vb;this.mg=Za;this.jWc=1>100*Math.random()}get sfa(){return this.sca.sfa}set sfa(Aa){this.sca.sfa=Aa}get V3(){return this.Y9e}get Kd(){return this.eNe}init(){this.Kd.ajf(this.WOa);this.Kd.njf(this.Nnd);
this.Kd.mjf(this.Mnd);this.mg.jsb(this.Dk);t.AFrameworkApplication.jH(()=>{this.Dk.D4b();Ia.a.instance&&Ia.a.instance.j1b()});this.c3c();this.K3l();this.Kd.ijf(this.Byd)}K3l(){try{const ha=$.signalR;if(!ha)throw Error.invalidOperation("Failed to retrieve Signalr object");const mb=ha.version;if(!mb)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===mb){var Aa=ha.transports;if(!Aa)throw Error.invalidOperation("Failed to retrieve transports object");var ka=Aa.longPolling;
if(!ka)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!ka.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");ka.supportsKeepAlive=this.pVl()}}catch(ha){ya.ULS.sendTraceTag(508396227,500,15,"Failed to disable longPolling KeepAlives: {0}",ha.message)}}pVl(){return()=>!1}c3c(){const Aa=++this.aCa;this.Fec=(new Date(0)).getTime();this.Gma=this.tRe();this.Kd.ixe(this.Gma);this.Gma.stateChanged(ka=>{this.Opj(ka,Aa)});
this.Gma.connectionSlow((0,ja.a)(this,this.Wkg,"onSlowConnection"));this.Gma.error((0,ja.a)(this,this.Tkg,"onSignalRError"));this.Gma.log=(0,ja.a)(this,this.Ukg,"onSignalRLog")}KBa(Aa,ka){return Aa!==this.aCa?(ya.ULS.sendTraceTag(508396226,500,50,"ConnectionToken verification failed for {0}",ka),!1):!0}connect(){2!==this.Zj&&1!==this.Zj&&(ya.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",this.Yj),this.hJb.uig(),x.a.instance.rIg(),this.xM(1,this.Zj),this.fwd())}disconnect(){0===
this.Zj?ya.ULS.sendTraceTag(508396194,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.Yj):(this.Dk.Aqd(),Ia.a.instance&&(Ia.a.instance.zKb=!0),ya.ULS.sendTraceTag(508396193,500,50,"Starting explicit disconnect for [{0}]",this.Yj),this.V3.oja=!0,this.hJb.Fig(),this.xM(0,this.Zj),this.WOa(),this.V3.oja=!1)}PIg(Aa){const ka=this.Fpf(),ha=this.Gma,mb=this.eK,na=()=>{if(this.BPb)ya.ULS.sendTraceTag(508396191,500,15,"Stop connection was called twice, possibly on the same connection.");
else try{this.BPb=!0,ha.stop(!0,Aa)}catch(va){ya.ULS.sendTraceTag(508396192,500,15,"Stopping connection failed: {0}",va.message)}};0<ka?(ya.ULS.sendTraceTag(508396190,500,50,"Waiting to stop connection [{0}]: [{1}] ms.",mb,ka),window.setTimeout(na,ka)):(ya.ULS.sendTraceTag(508396189,500,50,"Stopping connection [{0}].",mb),na())}Fpf(){let Aa=0;0===this.Gma.state&&(Aa=this.Fec+sa.vik-(new Date).getTime(),0>Aa&&(Aa=0));return Aa}get connectionState(){return this.Zj}D5(Aa){this.Kd.D5(Aa)}LIa(Aa){this.Kd.LIa(Aa)}gBg(Aa){this.eJa(0,
Aa)}eJa(Aa,ka){const ha=new oa.a;this.Kd.cqd(Aa,ka,ha);return ha.task}gEa(Aa){this.Kd.gEa(Aa)}S4a(Aa){this.Kd.S4a(Aa)}qsb(Aa){this.Kd.qsb(Aa)}PDb(Aa){this.Kd.PDb(Aa)}psb(Aa){this.Kd.psb(Aa)}ODb(Aa){this.Kd.ODb(Aa)}VXb(Aa){return this.qTf(Aa,0)}qwb(){return this.pwb(0)}pwb(Aa){const ka={};for(const ha of this.gB)ha.value.fb(Aa)&&(ka[ha.key]=ha.value.K(Aa).data);return ka}qTf(Aa,ka){return this.gB.fb(Aa)&&this.gB.K(Aa).fb(ka)?this.gB.K(Aa).K(ka).data:null}AJf(){const Aa=new w.a;if(!this.gB.fb(this._clientId))return Aa;
for(const ka of this.gB.K(this._clientId))Aa.W(ka.key,ka.value.data);return Aa}gH(Aa,ka=null,ha=!1){const mb=new oa.a;this.Kd.l4b(Aa,ka,ha,mb);return mb.task}XR(Aa){this.Kd.XR(Aa)}NIa(Aa){this.Kd.NIa(Aa)}gQa(Aa){let ka,ha;return({value:ka}=this.gB.qc(Aa)).returnValue&&({value:ha}=ka.qc(0)).returnValue?new k.a(this.rTf(ha),ha.timeStamp):null}mqc(){const Aa={};for(const ka of this.gB)ka.value.qc(0).returnValue&&(Aa[ka.key]=this.gQa(ka.key));return Aa}ema(Aa){const ka=new oa.a;this.Kd.kxe(Aa,ka);return ka.task}get clientId(){return this._clientId}get hHg(){return this.jWc}dispose(){this.xm||
(t.AFrameworkApplication.J?.$("DetachRtcEventHandlerOnDispose")&&(this.Uzf(),this.V3.Vzf()),this.V3.ZQ(),this.mg.$Bc(this.Dk),this.Dk.D4b(),Ia.a.instance&&Ia.a.instance.j1b(),this.xm=!0)}Opj(Aa,ka){this.KBa(ka,"StateChangedSignalR")&&this.xM(this.f2c(Aa.newState),this.f2c(Aa.oldState))}xM(Aa,ka){if((1!==this.Zj||0!==ka||1!==Aa)&&this.Zj!==ka){var ha=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.Zj,
ka,Aa]));ya.ULS.sendTraceTag(508396188,500,10,ha)}if(this.Zj!==Aa){switch(Aa){case 2:Ia.a.instance&&Ia.a.instance.ibg();this.eK=this.Gma.id;ya.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.eK,this.Yj);this.W$f(this.Gma);ya.ULS.sendTraceTag(508396186,500,50,"Retrieving complete session state");ha=null;this.vd&&(ha=this.vd.Df("WebServiceCall","Receive First Presence"));const mb=this.aCa;this.Kd.Usg((0,ja.a)(this,this.KBa,"verifyConnectionToken"),mb,this.hJb,this.HSb,
this.AJf(),ha);this.Zd.hzg&&pa.gxb(this.Kd,this.Zd,100*Math.random()<=this.Zd.izg).start();break;case 1:2===ka&&ya.ULS.sendTraceTag(508396185,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.eK);break;case 0:if(pa.instance&&pa.instance.stop(),this.V3.oja)ya.ULS.sendTraceTag(508396182,500,50,"Connection [{0}] has been explicitly closed",this.eK);else{1===ka&&(ya.ULS.sendTraceTag(508396184,500,50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",
this.eK),this.Dk.Bqd());2===ka&&ya.ULS.sendTraceTag(508396183,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.eK);this.WOa();return}}this.Zj=Aa;this.Kd.Fsg(Aa,ka)}}Uzf(){this.Kd.ywg(this.WOa);this.Kd.Hwg(this.Nnd);this.Kd.Gwg(this.Mnd);this.Kd.Ewg(this.Byd)}W$f(Aa){if(Aa&&Aa.transport&&Aa.transport.name){Aa=Aa.transport.name;var ka=Aa.toLowerCase();"websockets"===ka?(Ia.a.instance&&(Ia.a.instance.Kru=
3),ya.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",Aa,this.Yj)):"serversentevents"===ka?(Ia.a.instance&&(Ia.a.instance.Kru=4),ya.ULS.sendTraceTag(4290752,500,50,"Transport name - {0} for [{1}]",Aa,this.Yj)):"foreverframe"===ka?(Ia.a.instance&&(Ia.a.instance.Kru=6),ya.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",Aa,this.Yj)):"longpolling"===ka?(Ia.a.instance&&(Ia.a.instance.Kru=5),ya.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",Aa,this.Yj)):
"mocktransport"!==ka&&ya.ULS.sendTraceTag(508396180,500,15,"Unknown transport protocol encountered - '{0}'",Aa)}else ya.ULS.sendTraceTag(508396181,500,10,"Transport protocol name is missing")}Wkg(){if(this.Zd.Nsd){const Aa=r.a.QK(this.sfa,"mid");ya.ULS.sendTraceTag(508396178,500,15,"Detected that the connection [{0}] is slow for target machine [{1}]",this.eK,Aa)}else ya.ULS.sendTraceTag(508396177,500,50,"Detected that the connection [{0}] is slow",this.eK)}Tkg(){ya.ULS.sendTraceTag(508396176,600,
15,"SignalR ERROR for connection [{0}];",this.eK)}Ukg(Aa){Aa=v(35531).a.lra(Aa);if(this.Zd.Nsd&&Aa.startsWith("Keep alive timed out.")){const ka=r.a.QK(this.sfa,"mid");ya.ULS.sendTraceTag(508396175,500,15,"SignalR lib: {0}. Target Machine: {1}",Aa,ka)}else this.hHg&&2E3>this.mrb&&!Aa.startsWith("Invok")&&!Aa.startsWith("Trigger")&&(ya.ULS.sendTraceTag(508396174,500,50,"SignalR lib: {0}",Aa),this.mrb++)}f2c(Aa){switch(Aa){case 0:return 1;case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",
Aa,"Unknown SignalR state");}}rTf(Aa){return Aa&&Aa.timeStamp?(new Date).getTime()-Aa.timeStamp.getTime()>(this.Zd.Cmf?6E4:this.Zd.Bmf)?2:1:1}static createInstance(Aa,ka,ha,mb,na,va,Cb,wb=null,gb=null,Wa=null,vb,Za=null,Sa=null){return sa.ZPl(Aa,ka,ha,Sa,mb,na,va,Cb,wb,gb,Wa,Za)}static ZPl(Aa,ka,ha,mb,na,va,Cb,wb,gb=null,Wa=null,vb=null,Za=null){const Sa=B.createInstance(t.AFrameworkApplication.J),ub=t.AFrameworkApplication.buildVersion?t.AFrameworkApplication.buildVersion:"1.0",ab=sa.OIf(Aa,ka,Cb),
Ya=Sa.Trf?v(58638).a.createInstance(ab):new X;var jb=Ia.a.create(na);Sa.kzg&&jb.qIg(Sa.jzg);var kb="";kb=gb&&""!==gb?gb:"/rtc2/";jb.o7c=r.a.v_(kb);const hb=kb+"signalr";gb=kb+"findsession";kb=new Ba;vb=vb||Q.a.getInstance();ya.ULS.shipAssertTag(508396228,500,Sa.Osd<=C.a.tkd,"Client attempting to override max payload size beyond absolute limit");const Bb=Math.min(Sa.Osd,C.a.tkd);jb.skd=Bb;jb=new Ra(Sa,new R(kb),Aa,ab,cc=>new U(cc.createHubProxy("realtimeChannelHub")),wb,vb,Ya,jb,Bb);Wa||(Wa=v(22800).a.createInstance(ka,
na,gb,wb,ub,Cb,Aa,ab,vb,va,mb,Za));Wa.ydb=Sa.ydb;ka=new E(ab);ha=ha?ha.split(","):null;Aa=new (v(58115).a)(Aa,ha,ab,wb,()=>$.hubConnection(hb),Wa,jb,ka,vb,Ya,Sa,na);Aa.init();return Aa}static OIf(Aa,ka,ha){return String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",Aa,this.sSb(z.a[ha]),this.sSb("browser"),ka)}static sSb(Aa){return Aa?Aa.charAt(0).toLocaleUpperCase()+Aa.substring(1,Aa.length):Aa}}sa.vik=15E3;(0,ia.a)(sa,"RealtimeChannel",null,[638,217])},58638:function(ia,Ua,v){v.d(Ua,
{a:function(){return t}});ia=v(34622);var ya=v(23335),ja=v(5982),oa=v(50612),z=v(35531),D=v(16149),d=v(59529);class t{constructor(){this.SSc=this.TSc=this.USc=this.PSc=this.OSc=this.QSc=this.mMa=this.sNb=0;this.nha=this.BMb=this.YLa=this.wMb=this.Bua=this.uMb=this.j9=this.ULa=this.Aua=this.tMb=this.C8a=this.Yta=null;this.YMb=this.bMa=this.PVc=this.pLc=0;this.UMj=this.oSc=!1;this.wqd=this.t4b;this.zqd=this.w4b;this.yqd=this.v4b;this.Bqd=this.y4b;this.Aqd=this.x4b;this.D4b=this.E4b;this.sjb=this.B4b;
this.dla=this.z4b;this.kAa=this.A4b;this.xqd=this.u4b;this.YRa=this.W1b;this.$hb=this.X1b}t4b(){this.sNb++;this.tMb=new Date;this.Yta||(this.Yta=new Date)}w4b(){this.mMa++;this.j9=new Date;this.C8a||(this.C8a=this.j9);this.YLa=this.j9;this.Dtf()}v4b(){this.QSc++;this.uMb=new Date}y4b(){this.OSc++;this.Aua=new Date}x4b(){this.PSc++;this.ULa=new Date}B4b(){this.Bua=new Date;this.USc++}A4b(){this.nha||(this.nha=new Date);this.TSc++}z4b(){this.wMb=new Date;this.SSc++}E4b(){if(!this.oSc&&this.sNb){ya.ULS.sendTraceTag(39321871,
500,15,oa.a.toJSON(this.vsf()));this.UMj=d.AFrameworkApplication.J.$("ExcelRtcSetupConnectionAttemptFailedQosError");var k=new Date;this.UMj&&0<this.sNb&&0===this.mMa&&this.Yta&&10<(k.getTime()-this.Yta.getTime())/1E3&&D.Health.instance.recordQosError("XLRtcSetupConnectionAttemptFailed",["Veto_XL_RtcSetup"],!1,!0,!0,!0,null);this.oSc=!0}}u4b(k){const {Jcd:r,Kcd:x,exception:u}=z.a.lFf(k);r&&r!==ja.a.VE&&(ya.ULS.sendTraceTag(40157596,500,15,oa.a.toJSON({HttpErrorCode:r,HttpErrorStatus:x,Exception:u})),
ja.a.t0f(r)&&this.pLc++,ja.a.Ele(r)&&this.PVc++)}W1b(){this.BMb=new Date}X1b(){this.Aua=this.YLa=new Date}vsf(){return{numberOfConnectionAttempts:this.sNb,numberOfSuccessfulConnections:this.mMa,numberOfFailedConnections:this.QSc,numberOfDisconnectedConnections:this.OSc,numberOfExplicitDisconnectedConnections:this.PSc,numberOfSentMessages:this.USc,numberOfReceivedMessages:this.TSc,numberOfLostMessages:this.SSc,firstConnectionAttempt:this.Yta?this.Yta:null,firstMessageReceived:this.nha?this.nha:null,
firstConnectionSuccess:this.C8a?this.C8a:null,lastConnectionAttempt:this.tMb?this.tMb:null,lastConnectionSuccess:this.j9?this.j9:null,lastConnectionFailure:this.uMb?this.uMb:null,lastMessageSent:this.Bua?this.Bua:null,lastMessageLost:this.wMb?this.wMb:null,lastDisconnect:this.Aua?this.Aua:null,lastExplicitDisconnect:this.ULa?this.ULa:null,lastTimeOnline:this.YLa?this.YLa:null,lastTimeOffline:this.BMb?this.BMb:null,maxDisconnectedTimeMs:this.bMa,maxExplicitDisconnectedTimeMs:this.YMb,clientConnectionErrors:this.pLc,
serverConnectionErrors:this.PVc}}Dtf(){this.Yta&&1===this.mMa&&(this.bMa=Math.max(this.bMa,this.j9.getTime()-this.Yta.getTime()));this.Aua&&1<this.mMa&&(this.bMa=Math.max(this.bMa,this.j9.getTime()-this.Aua.getTime()));this.ULa&&1<this.mMa&&(this.YMb=Math.max(this.YMb,this.j9.getTime()-this.ULa.getTime()))}static createInstance(k){t._instance||(t._instance=new t,ya.ULS.sendTraceTag(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",k));return t._instance}}t._instance=null;(0,ia.a)(t,
"RealtimeChannelMetrics",null,[1088,511])},13116:function(ia,Ua,v){v.d(Ua,{a:function(){return ya}});ia=v(34622);class ya{}ya.tkd=31E3;ya.E1b=8E3;(0,ia.a)(ya,"RealtimeChannelStaticConstants",null,[])},52078:function(ia,Ua,v){v.d(Ua,{a:function(){return M}});ia=v(34622);var ya=v(80293),ja=v(56059),oa=v(74948),z=v(74396),D=v(50511),d=v(38146),t=v(43520);class k extends Sys.EventArgs{constructor(){super()}}(0,ia.a)(k,"GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);class r extends Sys.EventArgs{constructor(J,
O,K,R,E,X){super();this.KBa=J;this.connectionToken=O;this.Xtf=K;this.F6c=E;this.HSb=R;this.XA=X}}(0,ia.a)(r,"RefreshAllPersistentStateEventArgs",Sys.EventArgs,[]);class x extends Sys.EventArgs{constructor(J){super();this.hubConnection=J}}(0,ia.a)(x,"RefreshProxyEventArgs",Sys.EventArgs,[]);class u extends Sys.EventArgs{constructor(J,O){super();this.vea=J;this.errorMessage=O}}(0,ia.a)(u,"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class w extends Sys.EventArgs{constructor(J,O,K){super();this.type=
J;this.MJ=O;this.k6a=K}}(0,ia.a)(w,"SendPersistentStateEventArgs",Sys.EventArgs,[]);var C=v(41541);class B extends Sys.EventArgs{constructor(){super()}}(0,ia.a)(B,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class G extends Sys.EventArgs{constructor(J){super();this.ztb=J}}(0,ia.a)(G,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class H extends Sys.EventArgs{constructor(J,O){super();this.type=J;this.xQg=O}}(0,ia.a)(H,"UpdatePersistentStateRequestEventArgs",Sys.EventArgs,
[]);var I=v(52172);class M{constructor(){this.na=new I.a}Fsg(J,O){this.na.raiseEvent("CSC",new ya.a(J,O))}ixe(J){this.na.raiseEvent("RP",new x(J))}ojb(J){this.na.raiseEvent("RC",J)}Vsg(){this.na.raiseEvent("RMID")}Usg(J,O,K,R,E,X){this.na.raiseEvent("RPS",new r(J,O,K,R,E,X))}eqd(J,O){this.na.raiseEvent("UPSR",new H(J,O))}$pd(J,O){this.na.raiseEvent("PU",new d.a(J,O))}Osg(J){this.na.raiseEvent("MPU",new oa.a(J))}l4b(J,O,K,R){this.na.raiseEvent("SUN",new C.a(J,O,K,R))}Xsg(J,O){this.na.raiseEvent("UNR",
new t.a(J,O))}cqd(J,O,K){this.na.raiseEvent("SP",new w(J,O,K))}hxe(J,O){this.na.raiseEvent("PSU",new D.a(J,O))}Ssg(J){this.na.raiseEvent("PSC",new z.a(J))}Lsg(J){this.na.raiseEvent("IPSC",new z.a(J))}Ysg(J){this.na.raiseEvent("UPSC",new G(J))}Wsg(J,O){this.na.raiseEvent("SPC",new B(J,O))}aqd(J,O){this.na.raiseEvent("RCF",new u(J,O))}Jsg(J){this.na.raiseEvent("CPSWM",new k(J))}kxe(J,O){this.na.raiseEvent("UCI",new ja.a(J,O))}D5(J){this.na.addHandler("CSC",J)}LIa(J){this.na.removeHandler("CSC",J)}bjf(J){this.na.addHandler("RP",
J)}zwg(J){this.na.removeHandler("RP",J)}ajf(J){this.na.addHandler("RC",J)}ywg(J){this.na.removeHandler("RC",J)}cjf(J){this.na.addHandler("RMID",J)}$if(J){this.na.addHandler("RPS",J)}xwg(J){this.na.removeHandler("RPS",J)}njf(J){this.na.addHandler("UPSR",J)}Hwg(J){this.na.removeHandler("UPSR",J)}gEa(J){this.na.addHandler("PU",J)}S4a(J){this.na.removeHandler("PU",J)}Fif(J){this.na.addHandler("IPU",J)}kwg(J){this.na.removeHandler("IPU",J)}ljf(J){this.na.addHandler("UCI",J)}Fwg(J){this.na.removeHandler("UCI",
J)}fjf(J){this.na.addHandler("SUN",J)}Dwg(J){this.na.removeHandler("SUN",J)}Gif(J){this.na.addHandler("IUNR",J)}lwg(J){this.na.removeHandler("IUNR",J)}XR(J){this.na.addHandler("UNR",J)}NIa(J){this.na.removeHandler("UNR",J)}qsb(J){this.na.addHandler("PSU",J)}PDb(J){this.na.removeHandler("PSU",J)}Eif(J){this.na.addHandler("IPSU",J)}jwg(J){this.na.removeHandler("IPSU",J)}psb(J){this.na.addHandler("PSC",J)}ODb(J){this.na.removeHandler("PSC",J)}Dif(J){this.na.addHandler("IPSC",J)}iwg(J){this.na.removeHandler("IPSC",
J)}mjf(J){this.na.addHandler("UPSC",J)}Gwg(J){this.na.removeHandler("UPSC",J)}ejf(J){this.na.addHandler("SP",J)}Cwg(J){this.na.removeHandler("SP",J)}ijf(J){this.na.addHandler("SPC",J)}Ewg(J){this.na.removeHandler("SPC",J)}static getInstance(){return M._instance||(M._instance=new M)}}M._instance=null;(0,ia.a)(M,"RtcEventHub",null,[863])},35531:function(ia,Ua,v){v.d(Ua,{a:function(){return z}});ia=v(34622);var ya=v(23335),ja=v(6855),oa=v(13116);class z{static ASb(D,d=oa.a.E1b){let t;try{t=ja.c(D)}catch(k){throw D=
String.format("Failed to JSON-serialize payload : {0}",k),ya.ULS.sendTraceTag(508396173,500,10,D),Error.argument("payload",D);}if(t.length>d)throw D=String.format("Payload exceeds maximum length: {0} > {1}.",t.length,d),ya.ULS.sendTraceTag(508396171,500,10,D),Error.argument("payload",D);return t}static deserialize(D,d,t){if(!D)return null;if(Object.getType(D)!==String){var k=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}].",
d,Object.getType(D).getName(),t);ya.ULS.sendTraceTag(508396170,500,10,k);return null}k=null;try{k=ja.a(D)}catch(r){D=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}].",d,r,t),ya.ULS.sendTraceTag(508396168,500,10,D)}return k}static lra(D){if(!D)return"";if("string"===typeof D)return D.toString();try{return ja.c(D)}catch(d){return D.toString()}}static lFf(D){let d,t,k;d=0;k=t=null;if(!D)return{Jcd:d,Kcd:t,exception:k};try{const r=D.source;r&&Object.getType(r)===
String&&(k=r);const x=D.context;x&&(D=x,d=D.status?D.status:0,t=D.statusText?D.statusText:null)}catch(r){}return{Jcd:d,Kcd:t,exception:k}}}(0,ia.a)(z,"RtcUtils",null,[])},41541:function(ia,Ua,v){v.d(Ua,{a:function(){return ya}});ia=v(34622);class ya extends Sys.EventArgs{constructor(ja,oa,z,D){super();this.type=ja;this.KC=oa;this.Dzf=z;this.k6a=D}}(0,ia.a)(ya,"SendUpdateNotificationEventArgs",Sys.EventArgs,[])},93311:function(ia,Ua,v){v.d(Ua,{a:function(){return ya}});ia=v(34622);class ya{constructor(ja,
oa,z,D){this.ncg=ja;this.Psa=oa;this.Hbg=z;this.KTf=D}}(0,ia.a)(ya,"ThrottlerManagerSettings",null,[])},28569:function(ia,Ua,v){v.d(Ua,{a:function(){return ya}});ia=v(34622);var ya;(function(ja){ja[ja.unspecified=0]="unspecified";ja[ja.T9b=1]="word";ja[ja.xdm=2]="excel";ja[ja.iAj=3]="powerPoint";ja[ja.test=4]="test";ja[ja.wacFrontEnd=5]="wacFrontEnd";ja[ja.Xuj=6]="oneNote";ja[ja.E1p=7]="visio";ja[ja.nVq=8]="officeMobile";ja[ja.Brq=9]="cosmosDBChangefeed";ja[ja.last=10]="last"})(ya||(ya={}));(0,ia.b)("RtcClientAppName",
ya)},3739:function(ia,Ua,v){v.d(Ua,{a:function(){return ya}});ia=v(34622);var ya;(function(ja){ja[ja.Obi=0]="contentUpdate";ja[ja.hxq=1]="editorsTableUpdate";ja[ja.sVb=2]="fileNameUpdate";ja[ja.u2p=3]="wetContentUpdate";ja[ja.Bvr=4]="persistedContentUpdate";ja[ja.dDl=5]="clientRtcReconnectRequest";ja[ja.nYr=6]="replicationTelemetry";ja[ja.bLq=7]="lockUpdate";ja[ja.spq=8]="collabServiceContentUpdate";ja[ja.Sdu=9]="trackChangeSettingUpdate";ja[ja.g_r=10]="saveTargetUpdate";ja[ja.Ffu=11]="uploadToOcsUpdate";
ja[ja.jJq=12]="labelUpdate";ja[ja.yin=13]="hostNotificationSubscriptionStatus";ja[ja.sTs=14]="subscribeOrExtend";ja[ja.lxq=15]="elapsedBootTelemetry";ja[ja.Flc=16]="clientToClientTelemetryMessage";ja[ja.Elc=17]="clientToClientResponseMessage";ja[ja.jgu=18]="verifyNotificationPipeline";ja[ja.vEq=19]="hostNotificationHeartbeat";ja[ja.AIs=20]="secondaryMetadataUpdate";ja[ja.last=21]="last"})(ya||(ya={}));(0,ia.b)("UpdateNotificationType",ya)}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/WordEditorDS.collab.js.map/429ef24f7c70243afdd7e8019d6fcd0e/WordEditorDS.collab.js.map